(function(Me,Ce){typeof exports=="object"&&typeof module<"u"?Ce(exports):typeof define=="function"&&define.amd?define(["exports"],Ce):(Me=typeof globalThis<"u"?globalThis:Me||self,Ce(Me.JmonStudio={}))})(this,(function(Me){"use strict";function Ce(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Le={exports:{}},zt={},$e={},ke={},Vt={},Ft={},Lt={},ur;function Ue(){return ur||(ur=1,(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.regexpCode=o.getEsmExportName=o.getProperty=o.safeStringify=o.stringify=o.strConcat=o.addCodeArg=o.str=o._=o.nil=o._Code=o.Name=o.IDENTIFIER=o._CodeOrName=void 0;class e{}o._CodeOrName=e,o.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class t extends e{constructor(l){if(super(),!o.IDENTIFIER.test(l))throw new Error("CodeGen: name must be a valid identifier");this.str=l}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}o.Name=t;class r extends e{constructor(l){super(),this._items=typeof l=="string"?[l]:l}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const l=this._items[0];return l===""||l==='""'}get str(){var l;return(l=this._str)!==null&&l!==void 0?l:this._str=this._items.reduce((f,m)=>`${f}${m}`,"")}get names(){var l;return(l=this._names)!==null&&l!==void 0?l:this._names=this._items.reduce((f,m)=>(m instanceof t&&(f[m.str]=(f[m.str]||0)+1),f),{})}}o._Code=r,o.nil=new r("");function n(h,...l){const f=[h[0]];let m=0;for(;m<l.length;)a(f,l[m]),f.push(h[++m]);return new r(f)}o._=n;const i=new r("+");function s(h,...l){const f=[P(h[0])];let m=0;for(;m<l.length;)f.push(i),a(f,l[m]),f.push(i,P(h[++m]));return c(f),new r(f)}o.str=s;function a(h,l){l instanceof r?h.push(...l._items):l instanceof t?h.push(l):h.push(g(l))}o.addCodeArg=a;function c(h){let l=1;for(;l<h.length-1;){if(h[l]===i){const f=u(h[l-1],h[l+1]);if(f!==void 0){h.splice(l-1,3,f);continue}h[l++]="+"}l++}}function u(h,l){if(l==='""')return h;if(h==='""')return l;if(typeof h=="string")return l instanceof t||h[h.length-1]!=='"'?void 0:typeof l!="string"?`${h.slice(0,-1)}${l}"`:l[0]==='"'?h.slice(0,-1)+l.slice(1):void 0;if(typeof l=="string"&&l[0]==='"'&&!(h instanceof t))return`"${h}${l.slice(1)}`}function d(h,l){return l.emptyStr()?h:h.emptyStr()?l:s`${h}${l}`}o.strConcat=d;function g(h){return typeof h=="number"||typeof h=="boolean"||h===null?h:P(Array.isArray(h)?h.join(","):h)}function $(h){return new r(P(h))}o.stringify=$;function P(h){return JSON.stringify(h).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}o.safeStringify=P;function E(h){return typeof h=="string"&&o.IDENTIFIER.test(h)?new r(`.${h}`):n`[${h}]`}o.getProperty=E;function w(h){if(typeof h=="string"&&o.IDENTIFIER.test(h))return new r(`${h}`);throw new Error(`CodeGen: invalid export name: ${h}, use explicit $id name mapping`)}o.getEsmExportName=w;function p(h){return new r(h.toString())}o.regexpCode=p})(Lt)),Lt}var Ut={},dr;function hr(){return dr||(dr=1,(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.ValueScope=o.ValueScopeName=o.Scope=o.varKinds=o.UsedValueState=void 0;const e=Ue();class t extends Error{constructor(u){super(`CodeGen: "code" for ${u} not defined`),this.value=u.value}}var r;(function(c){c[c.Started=0]="Started",c[c.Completed=1]="Completed"})(r||(o.UsedValueState=r={})),o.varKinds={const:new e.Name("const"),let:new e.Name("let"),var:new e.Name("var")};class n{constructor({prefixes:u,parent:d}={}){this._names={},this._prefixes=u,this._parent=d}toName(u){return u instanceof e.Name?u:this.name(u)}name(u){return new e.Name(this._newName(u))}_newName(u){const d=this._names[u]||this._nameGroup(u);return`${u}${d.index++}`}_nameGroup(u){var d,g;if(!((g=(d=this._parent)===null||d===void 0?void 0:d._prefixes)===null||g===void 0)&&g.has(u)||this._prefixes&&!this._prefixes.has(u))throw new Error(`CodeGen: prefix "${u}" is not allowed in this scope`);return this._names[u]={prefix:u,index:0}}}o.Scope=n;class i extends e.Name{constructor(u,d){super(d),this.prefix=u}setValue(u,{property:d,itemIndex:g}){this.value=u,this.scopePath=(0,e._)`.${new e.Name(d)}[${g}]`}}o.ValueScopeName=i;const s=(0,e._)`\n`;class a extends n{constructor(u){super(u),this._values={},this._scope=u.scope,this.opts={...u,_n:u.lines?s:e.nil}}get(){return this._scope}name(u){return new i(u,this._newName(u))}value(u,d){var g;if(d.ref===void 0)throw new Error("CodeGen: ref must be passed in value");const $=this.toName(u),{prefix:P}=$,E=(g=d.key)!==null&&g!==void 0?g:d.ref;let w=this._values[P];if(w){const l=w.get(E);if(l)return l}else w=this._values[P]=new Map;w.set(E,$);const p=this._scope[P]||(this._scope[P]=[]),h=p.length;return p[h]=d.ref,$.setValue(d,{property:P,itemIndex:h}),$}getValue(u,d){const g=this._values[u];if(g)return g.get(d)}scopeRefs(u,d=this._values){return this._reduceValues(d,g=>{if(g.scopePath===void 0)throw new Error(`CodeGen: name "${g}" has no value`);return(0,e._)`${u}${g.scopePath}`})}scopeCode(u=this._values,d,g){return this._reduceValues(u,$=>{if($.value===void 0)throw new Error(`CodeGen: name "${$}" has no value`);return $.value.code},d,g)}_reduceValues(u,d,g={},$){let P=e.nil;for(const E in u){const w=u[E];if(!w)continue;const p=g[E]=g[E]||new Map;w.forEach(h=>{if(p.has(h))return;p.set(h,r.Started);let l=d(h);if(l){const f=this.opts.es5?o.varKinds.var:o.varKinds.const;P=(0,e._)`${P}${f} ${h} = ${l};${this.opts._n}`}else if(l=$?.(h))P=(0,e._)`${P}${l}${this.opts._n}`;else throw new t(h);p.set(h,r.Completed)})}return P}}o.ValueScope=a})(Ut)),Ut}var fr;function W(){return fr||(fr=1,(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.or=o.and=o.not=o.CodeGen=o.operators=o.varKinds=o.ValueScopeName=o.ValueScope=o.Scope=o.Name=o.regexpCode=o.stringify=o.getProperty=o.nil=o.strConcat=o.str=o._=void 0;const e=Ue(),t=hr();var r=Ue();Object.defineProperty(o,"_",{enumerable:!0,get:function(){return r._}}),Object.defineProperty(o,"str",{enumerable:!0,get:function(){return r.str}}),Object.defineProperty(o,"strConcat",{enumerable:!0,get:function(){return r.strConcat}}),Object.defineProperty(o,"nil",{enumerable:!0,get:function(){return r.nil}}),Object.defineProperty(o,"getProperty",{enumerable:!0,get:function(){return r.getProperty}}),Object.defineProperty(o,"stringify",{enumerable:!0,get:function(){return r.stringify}}),Object.defineProperty(o,"regexpCode",{enumerable:!0,get:function(){return r.regexpCode}}),Object.defineProperty(o,"Name",{enumerable:!0,get:function(){return r.Name}});var n=hr();Object.defineProperty(o,"Scope",{enumerable:!0,get:function(){return n.Scope}}),Object.defineProperty(o,"ValueScope",{enumerable:!0,get:function(){return n.ValueScope}}),Object.defineProperty(o,"ValueScopeName",{enumerable:!0,get:function(){return n.ValueScopeName}}),Object.defineProperty(o,"varKinds",{enumerable:!0,get:function(){return n.varKinds}}),o.operators={GT:new e._Code(">"),GTE:new e._Code(">="),LT:new e._Code("<"),LTE:new e._Code("<="),EQ:new e._Code("==="),NEQ:new e._Code("!=="),NOT:new e._Code("!"),OR:new e._Code("||"),AND:new e._Code("&&"),ADD:new e._Code("+")};class i{optimizeNodes(){return this}optimizeNames(y,T){return this}}class s extends i{constructor(y,T,R){super(),this.varKind=y,this.name=T,this.rhs=R}render({es5:y,_n:T}){const R=y?t.varKinds.var:this.varKind,F=this.rhs===void 0?"":` = ${this.rhs}`;return`${R} ${this.name}${F};`+T}optimizeNames(y,T){if(y[this.name.str])return this.rhs&&(this.rhs=H(this.rhs,y,T)),this}get names(){return this.rhs instanceof e._CodeOrName?this.rhs.names:{}}}class a extends i{constructor(y,T,R){super(),this.lhs=y,this.rhs=T,this.sideEffects=R}render({_n:y}){return`${this.lhs} = ${this.rhs};`+y}optimizeNames(y,T){if(!(this.lhs instanceof e.Name&&!y[this.lhs.str]&&!this.sideEffects))return this.rhs=H(this.rhs,y,T),this}get names(){const y=this.lhs instanceof e.Name?{}:{...this.lhs.names};return L(y,this.rhs)}}class c extends a{constructor(y,T,R,F){super(y,R,F),this.op=T}render({_n:y}){return`${this.lhs} ${this.op}= ${this.rhs};`+y}}class u extends i{constructor(y){super(),this.label=y,this.names={}}render({_n:y}){return`${this.label}:`+y}}class d extends i{constructor(y){super(),this.label=y,this.names={}}render({_n:y}){return`break${this.label?` ${this.label}`:""};`+y}}class g extends i{constructor(y){super(),this.error=y}render({_n:y}){return`throw ${this.error};`+y}get names(){return this.error.names}}class $ extends i{constructor(y){super(),this.code=y}render({_n:y}){return`${this.code};`+y}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(y,T){return this.code=H(this.code,y,T),this}get names(){return this.code instanceof e._CodeOrName?this.code.names:{}}}class P extends i{constructor(y=[]){super(),this.nodes=y}render(y){return this.nodes.reduce((T,R)=>T+R.render(y),"")}optimizeNodes(){const{nodes:y}=this;let T=y.length;for(;T--;){const R=y[T].optimizeNodes();Array.isArray(R)?y.splice(T,1,...R):R?y[T]=R:y.splice(T,1)}return y.length>0?this:void 0}optimizeNames(y,T){const{nodes:R}=this;let F=R.length;for(;F--;){const B=R[F];B.optimizeNames(y,T)||(ce(y,B.names),R.splice(F,1))}return R.length>0?this:void 0}get names(){return this.nodes.reduce((y,T)=>G(y,T.names),{})}}class E extends P{render(y){return"{"+y._n+super.render(y)+"}"+y._n}}class w extends P{}class p extends E{}p.kind="else";class h extends E{constructor(y,T){super(T),this.condition=y}render(y){let T=`if(${this.condition})`+super.render(y);return this.else&&(T+="else "+this.else.render(y)),T}optimizeNodes(){super.optimizeNodes();const y=this.condition;if(y===!0)return this.nodes;let T=this.else;if(T){const R=T.optimizeNodes();T=this.else=Array.isArray(R)?new p(R):R}if(T)return y===!1?T instanceof h?T:T.nodes:this.nodes.length?this:new h(me(y),T instanceof h?[T]:T.nodes);if(!(y===!1||!this.nodes.length))return this}optimizeNames(y,T){var R;if(this.else=(R=this.else)===null||R===void 0?void 0:R.optimizeNames(y,T),!!(super.optimizeNames(y,T)||this.else))return this.condition=H(this.condition,y,T),this}get names(){const y=super.names;return L(y,this.condition),this.else&&G(y,this.else.names),y}}h.kind="if";class l extends E{}l.kind="for";class f extends l{constructor(y){super(),this.iteration=y}render(y){return`for(${this.iteration})`+super.render(y)}optimizeNames(y,T){if(super.optimizeNames(y,T))return this.iteration=H(this.iteration,y,T),this}get names(){return G(super.names,this.iteration.names)}}class m extends l{constructor(y,T,R,F){super(),this.varKind=y,this.name=T,this.from=R,this.to=F}render(y){const T=y.es5?t.varKinds.var:this.varKind,{name:R,from:F,to:B}=this;return`for(${T} ${R}=${F}; ${R}<${B}; ${R}++)`+super.render(y)}get names(){const y=L(super.names,this.from);return L(y,this.to)}}class b extends l{constructor(y,T,R,F){super(),this.loop=y,this.varKind=T,this.name=R,this.iterable=F}render(y){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(y)}optimizeNames(y,T){if(super.optimizeNames(y,T))return this.iterable=H(this.iterable,y,T),this}get names(){return G(super.names,this.iterable.names)}}class v extends E{constructor(y,T,R){super(),this.name=y,this.args=T,this.async=R}render(y){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(y)}}v.kind="func";class _ extends P{render(y){return"return "+super.render(y)}}_.kind="return";class M extends E{render(y){let T="try"+super.render(y);return this.catch&&(T+=this.catch.render(y)),this.finally&&(T+=this.finally.render(y)),T}optimizeNodes(){var y,T;return super.optimizeNodes(),(y=this.catch)===null||y===void 0||y.optimizeNodes(),(T=this.finally)===null||T===void 0||T.optimizeNodes(),this}optimizeNames(y,T){var R,F;return super.optimizeNames(y,T),(R=this.catch)===null||R===void 0||R.optimizeNames(y,T),(F=this.finally)===null||F===void 0||F.optimizeNames(y,T),this}get names(){const y=super.names;return this.catch&&G(y,this.catch.names),this.finally&&G(y,this.finally.names),y}}class N extends E{constructor(y){super(),this.error=y}render(y){return`catch(${this.error})`+super.render(y)}}N.kind="catch";class q extends E{render(y){return"finally"+super.render(y)}}q.kind="finally";class z{constructor(y,T={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...T,_n:T.lines?`
`:""},this._extScope=y,this._scope=new t.Scope({parent:y}),this._nodes=[new w]}toString(){return this._root.render(this.opts)}name(y){return this._scope.name(y)}scopeName(y){return this._extScope.name(y)}scopeValue(y,T){const R=this._extScope.value(y,T);return(this._values[R.prefix]||(this._values[R.prefix]=new Set)).add(R),R}getScopeValue(y,T){return this._extScope.getValue(y,T)}scopeRefs(y){return this._extScope.scopeRefs(y,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(y,T,R,F){const B=this._scope.toName(T);return R!==void 0&&F&&(this._constants[B.str]=R),this._leafNode(new s(y,B,R)),B}const(y,T,R){return this._def(t.varKinds.const,y,T,R)}let(y,T,R){return this._def(t.varKinds.let,y,T,R)}var(y,T,R){return this._def(t.varKinds.var,y,T,R)}assign(y,T,R){return this._leafNode(new a(y,T,R))}add(y,T){return this._leafNode(new c(y,o.operators.ADD,T))}code(y){return typeof y=="function"?y():y!==e.nil&&this._leafNode(new $(y)),this}object(...y){const T=["{"];for(const[R,F]of y)T.length>1&&T.push(","),T.push(R),(R!==F||this.opts.es5)&&(T.push(":"),(0,e.addCodeArg)(T,F));return T.push("}"),new e._Code(T)}if(y,T,R){if(this._blockNode(new h(y)),T&&R)this.code(T).else().code(R).endIf();else if(T)this.code(T).endIf();else if(R)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(y){return this._elseNode(new h(y))}else(){return this._elseNode(new p)}endIf(){return this._endBlockNode(h,p)}_for(y,T){return this._blockNode(y),T&&this.code(T).endFor(),this}for(y,T){return this._for(new f(y),T)}forRange(y,T,R,F,B=this.opts.es5?t.varKinds.var:t.varKinds.let){const X=this._scope.toName(y);return this._for(new m(B,X,T,R),()=>F(X))}forOf(y,T,R,F=t.varKinds.const){const B=this._scope.toName(y);if(this.opts.es5){const X=T instanceof e.Name?T:this.var("_arr",T);return this.forRange("_i",0,(0,e._)`${X}.length`,Y=>{this.var(B,(0,e._)`${X}[${Y}]`),R(B)})}return this._for(new b("of",F,B,T),()=>R(B))}forIn(y,T,R,F=this.opts.es5?t.varKinds.var:t.varKinds.const){if(this.opts.ownProperties)return this.forOf(y,(0,e._)`Object.keys(${T})`,R);const B=this._scope.toName(y);return this._for(new b("in",F,B,T),()=>R(B))}endFor(){return this._endBlockNode(l)}label(y){return this._leafNode(new u(y))}break(y){return this._leafNode(new d(y))}return(y){const T=new _;if(this._blockNode(T),this.code(y),T.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(_)}try(y,T,R){if(!T&&!R)throw new Error('CodeGen: "try" without "catch" and "finally"');const F=new M;if(this._blockNode(F),this.code(y),T){const B=this.name("e");this._currNode=F.catch=new N(B),T(B)}return R&&(this._currNode=F.finally=new q,this.code(R)),this._endBlockNode(N,q)}throw(y){return this._leafNode(new g(y))}block(y,T){return this._blockStarts.push(this._nodes.length),y&&this.code(y).endBlock(T),this}endBlock(y){const T=this._blockStarts.pop();if(T===void 0)throw new Error("CodeGen: not in self-balancing block");const R=this._nodes.length-T;if(R<0||y!==void 0&&R!==y)throw new Error(`CodeGen: wrong number of nodes: ${R} vs ${y} expected`);return this._nodes.length=T,this}func(y,T=e.nil,R,F){return this._blockNode(new v(y,T,R)),F&&this.code(F).endFunc(),this}endFunc(){return this._endBlockNode(v)}optimize(y=1){for(;y-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(y){return this._currNode.nodes.push(y),this}_blockNode(y){this._currNode.nodes.push(y),this._nodes.push(y)}_endBlockNode(y,T){const R=this._currNode;if(R instanceof y||T&&R instanceof T)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${T?`${y.kind}/${T.kind}`:y.kind}"`)}_elseNode(y){const T=this._currNode;if(!(T instanceof h))throw new Error('CodeGen: "else" without "if"');return this._currNode=T.else=y,this}get _root(){return this._nodes[0]}get _currNode(){const y=this._nodes;return y[y.length-1]}set _currNode(y){const T=this._nodes;T[T.length-1]=y}}o.CodeGen=z;function G(A,y){for(const T in y)A[T]=(A[T]||0)+(y[T]||0);return A}function L(A,y){return y instanceof e._CodeOrName?G(A,y.names):A}function H(A,y,T){if(A instanceof e.Name)return R(A);if(!F(A))return A;return new e._Code(A._items.reduce((B,X)=>(X instanceof e.Name&&(X=R(X)),X instanceof e._Code?B.push(...X._items):B.push(X),B),[]));function R(B){const X=T[B.str];return X===void 0||y[B.str]!==1?B:(delete y[B.str],X)}function F(B){return B instanceof e._Code&&B._items.some(X=>X instanceof e.Name&&y[X.str]===1&&T[X.str]!==void 0)}}function ce(A,y){for(const T in y)A[T]=(A[T]||0)-(y[T]||0)}function me(A){return typeof A=="boolean"||typeof A=="number"||A===null?!A:(0,e._)`!${C(A)}`}o.not=me;const ye=x(o.operators.AND);function ee(...A){return A.reduce(ye)}o.and=ee;const V=x(o.operators.OR);function I(...A){return A.reduce(V)}o.or=I;function x(A){return(y,T)=>y===e.nil?T:T===e.nil?y:(0,e._)`${C(y)} ${A} ${C(T)}`}function C(A){return A instanceof e.Name?A:(0,e._)`(${A})`}})(Ft)),Ft}var J={},pr;function Q(){if(pr)return J;pr=1,Object.defineProperty(J,"__esModule",{value:!0}),J.checkStrictMode=J.getErrorPath=J.Type=J.useFunc=J.setEvaluated=J.evaluatedPropsToName=J.mergeEvaluated=J.eachItem=J.unescapeJsonPointer=J.escapeJsonPointer=J.escapeFragment=J.unescapeFragment=J.schemaRefOrVal=J.schemaHasRulesButRef=J.schemaHasRules=J.checkUnknownRules=J.alwaysValidSchema=J.toHash=void 0;const o=W(),e=Ue();function t(b){const v={};for(const _ of b)v[_]=!0;return v}J.toHash=t;function r(b,v){return typeof v=="boolean"?v:Object.keys(v).length===0?!0:(n(b,v),!i(v,b.self.RULES.all))}J.alwaysValidSchema=r;function n(b,v=b.schema){const{opts:_,self:M}=b;if(!_.strictSchema||typeof v=="boolean")return;const N=M.RULES.keywords;for(const q in v)N[q]||m(b,`unknown keyword: "${q}"`)}J.checkUnknownRules=n;function i(b,v){if(typeof b=="boolean")return!b;for(const _ in b)if(v[_])return!0;return!1}J.schemaHasRules=i;function s(b,v){if(typeof b=="boolean")return!b;for(const _ in b)if(_!=="$ref"&&v.all[_])return!0;return!1}J.schemaHasRulesButRef=s;function a({topSchemaRef:b,schemaPath:v},_,M,N){if(!N){if(typeof _=="number"||typeof _=="boolean")return _;if(typeof _=="string")return(0,o._)`${_}`}return(0,o._)`${b}${v}${(0,o.getProperty)(M)}`}J.schemaRefOrVal=a;function c(b){return g(decodeURIComponent(b))}J.unescapeFragment=c;function u(b){return encodeURIComponent(d(b))}J.escapeFragment=u;function d(b){return typeof b=="number"?`${b}`:b.replace(/~/g,"~0").replace(/\//g,"~1")}J.escapeJsonPointer=d;function g(b){return b.replace(/~1/g,"/").replace(/~0/g,"~")}J.unescapeJsonPointer=g;function $(b,v){if(Array.isArray(b))for(const _ of b)v(_);else v(b)}J.eachItem=$;function P({mergeNames:b,mergeToName:v,mergeValues:_,resultToName:M}){return(N,q,z,G)=>{const L=z===void 0?q:z instanceof o.Name?(q instanceof o.Name?b(N,q,z):v(N,q,z),z):q instanceof o.Name?(v(N,z,q),q):_(q,z);return G===o.Name&&!(L instanceof o.Name)?M(N,L):L}}J.mergeEvaluated={props:P({mergeNames:(b,v,_)=>b.if((0,o._)`${_} !== true && ${v} !== undefined`,()=>{b.if((0,o._)`${v} === true`,()=>b.assign(_,!0),()=>b.assign(_,(0,o._)`${_} || {}`).code((0,o._)`Object.assign(${_}, ${v})`))}),mergeToName:(b,v,_)=>b.if((0,o._)`${_} !== true`,()=>{v===!0?b.assign(_,!0):(b.assign(_,(0,o._)`${_} || {}`),w(b,_,v))}),mergeValues:(b,v)=>b===!0?!0:{...b,...v},resultToName:E}),items:P({mergeNames:(b,v,_)=>b.if((0,o._)`${_} !== true && ${v} !== undefined`,()=>b.assign(_,(0,o._)`${v} === true ? true : ${_} > ${v} ? ${_} : ${v}`)),mergeToName:(b,v,_)=>b.if((0,o._)`${_} !== true`,()=>b.assign(_,v===!0?!0:(0,o._)`${_} > ${v} ? ${_} : ${v}`)),mergeValues:(b,v)=>b===!0?!0:Math.max(b,v),resultToName:(b,v)=>b.var("items",v)})};function E(b,v){if(v===!0)return b.var("props",!0);const _=b.var("props",(0,o._)`{}`);return v!==void 0&&w(b,_,v),_}J.evaluatedPropsToName=E;function w(b,v,_){Object.keys(_).forEach(M=>b.assign((0,o._)`${v}${(0,o.getProperty)(M)}`,!0))}J.setEvaluated=w;const p={};function h(b,v){return b.scopeValue("func",{ref:v,code:p[v.code]||(p[v.code]=new e._Code(v.code))})}J.useFunc=h;var l;(function(b){b[b.Num=0]="Num",b[b.Str=1]="Str"})(l||(J.Type=l={}));function f(b,v,_){if(b instanceof o.Name){const M=v===l.Num;return _?M?(0,o._)`"[" + ${b} + "]"`:(0,o._)`"['" + ${b} + "']"`:M?(0,o._)`"/" + ${b}`:(0,o._)`"/" + ${b}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return _?(0,o.getProperty)(b).toString():"/"+d(b)}J.getErrorPath=f;function m(b,v,_=b.opts.strictSchema){if(_){if(v=`strict mode: ${v}`,_===!0)throw new Error(v);b.self.logger.warn(v)}}return J.checkStrictMode=m,J}var Ge={},mr;function Se(){if(mr)return Ge;mr=1,Object.defineProperty(Ge,"__esModule",{value:!0});const o=W(),e={data:new o.Name("data"),valCxt:new o.Name("valCxt"),instancePath:new o.Name("instancePath"),parentData:new o.Name("parentData"),parentDataProperty:new o.Name("parentDataProperty"),rootData:new o.Name("rootData"),dynamicAnchors:new o.Name("dynamicAnchors"),vErrors:new o.Name("vErrors"),errors:new o.Name("errors"),this:new o.Name("this"),self:new o.Name("self"),scope:new o.Name("scope"),json:new o.Name("json"),jsonPos:new o.Name("jsonPos"),jsonLen:new o.Name("jsonLen"),jsonPart:new o.Name("jsonPart")};return Ge.default=e,Ge}var yr;function Be(){return yr||(yr=1,(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.extendErrors=o.resetErrorsCount=o.reportExtraError=o.reportError=o.keyword$DataError=o.keywordError=void 0;const e=W(),t=Q(),r=Se();o.keywordError={message:({keyword:p})=>(0,e.str)`must pass "${p}" keyword validation`},o.keyword$DataError={message:({keyword:p,schemaType:h})=>h?(0,e.str)`"${p}" keyword must be ${h} ($data)`:(0,e.str)`"${p}" keyword is invalid ($data)`};function n(p,h=o.keywordError,l,f){const{it:m}=p,{gen:b,compositeRule:v,allErrors:_}=m,M=g(p,h,l);f??(v||_)?c(b,M):u(m,(0,e._)`[${M}]`)}o.reportError=n;function i(p,h=o.keywordError,l){const{it:f}=p,{gen:m,compositeRule:b,allErrors:v}=f,_=g(p,h,l);c(m,_),b||v||u(f,r.default.vErrors)}o.reportExtraError=i;function s(p,h){p.assign(r.default.errors,h),p.if((0,e._)`${r.default.vErrors} !== null`,()=>p.if(h,()=>p.assign((0,e._)`${r.default.vErrors}.length`,h),()=>p.assign(r.default.vErrors,null)))}o.resetErrorsCount=s;function a({gen:p,keyword:h,schemaValue:l,data:f,errsCount:m,it:b}){if(m===void 0)throw new Error("ajv implementation error");const v=p.name("err");p.forRange("i",m,r.default.errors,_=>{p.const(v,(0,e._)`${r.default.vErrors}[${_}]`),p.if((0,e._)`${v}.instancePath === undefined`,()=>p.assign((0,e._)`${v}.instancePath`,(0,e.strConcat)(r.default.instancePath,b.errorPath))),p.assign((0,e._)`${v}.schemaPath`,(0,e.str)`${b.errSchemaPath}/${h}`),b.opts.verbose&&(p.assign((0,e._)`${v}.schema`,l),p.assign((0,e._)`${v}.data`,f))})}o.extendErrors=a;function c(p,h){const l=p.const("err",h);p.if((0,e._)`${r.default.vErrors} === null`,()=>p.assign(r.default.vErrors,(0,e._)`[${l}]`),(0,e._)`${r.default.vErrors}.push(${l})`),p.code((0,e._)`${r.default.errors}++`)}function u(p,h){const{gen:l,validateName:f,schemaEnv:m}=p;m.$async?l.throw((0,e._)`new ${p.ValidationError}(${h})`):(l.assign((0,e._)`${f}.errors`,h),l.return(!1))}const d={keyword:new e.Name("keyword"),schemaPath:new e.Name("schemaPath"),params:new e.Name("params"),propertyName:new e.Name("propertyName"),message:new e.Name("message"),schema:new e.Name("schema"),parentSchema:new e.Name("parentSchema")};function g(p,h,l){const{createErrors:f}=p.it;return f===!1?(0,e._)`{}`:$(p,h,l)}function $(p,h,l={}){const{gen:f,it:m}=p,b=[P(m,l),E(p,l)];return w(p,h,b),f.object(...b)}function P({errorPath:p},{instancePath:h}){const l=h?(0,e.str)`${p}${(0,t.getErrorPath)(h,t.Type.Str)}`:p;return[r.default.instancePath,(0,e.strConcat)(r.default.instancePath,l)]}function E({keyword:p,it:{errSchemaPath:h}},{schemaPath:l,parentSchema:f}){let m=f?h:(0,e.str)`${h}/${p}`;return l&&(m=(0,e.str)`${m}${(0,t.getErrorPath)(l,t.Type.Str)}`),[d.schemaPath,m]}function w(p,{params:h,message:l},f){const{keyword:m,data:b,schemaValue:v,it:_}=p,{opts:M,propertyName:N,topSchemaRef:q,schemaPath:z}=_;f.push([d.keyword,m],[d.params,typeof h=="function"?h(p):h||(0,e._)`{}`]),M.messages&&f.push([d.message,typeof l=="function"?l(p):l]),M.verbose&&f.push([d.schema,v],[d.parentSchema,(0,e._)`${q}${z}`],[r.default.data,b]),N&&f.push([d.propertyName,N])}})(Vt)),Vt}var gr;function Qn(){if(gr)return ke;gr=1,Object.defineProperty(ke,"__esModule",{value:!0}),ke.boolOrEmptySchema=ke.topBoolOrEmptySchema=void 0;const o=Be(),e=W(),t=Se(),r={message:"boolean schema is false"};function n(a){const{gen:c,schema:u,validateName:d}=a;u===!1?s(a,!1):typeof u=="object"&&u.$async===!0?c.return(t.default.data):(c.assign((0,e._)`${d}.errors`,null),c.return(!0))}ke.topBoolOrEmptySchema=n;function i(a,c){const{gen:u,schema:d}=a;d===!1?(u.var(c,!1),s(a)):u.var(c,!0)}ke.boolOrEmptySchema=i;function s(a,c){const{gen:u,data:d}=a,g={gen:u,keyword:"false schema",data:d,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:a};(0,o.reportError)(g,r,void 0,c)}return ke}var he={},xe={},vr;function br(){if(vr)return xe;vr=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.getRules=xe.isJSONType=void 0;const o=["string","number","integer","boolean","null","object","array"],e=new Set(o);function t(n){return typeof n=="string"&&e.has(n)}xe.isJSONType=t;function r(){const n={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...n,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},n.number,n.string,n.array,n.object],post:{rules:[]},all:{},keywords:{}}}return xe.getRules=r,xe}var _e={},wr;function $r(){if(wr)return _e;wr=1,Object.defineProperty(_e,"__esModule",{value:!0}),_e.shouldUseRule=_e.shouldUseGroup=_e.schemaHasRulesForType=void 0;function o({schema:r,self:n},i){const s=n.RULES.types[i];return s&&s!==!0&&e(r,s)}_e.schemaHasRulesForType=o;function e(r,n){return n.rules.some(i=>t(r,i))}_e.shouldUseGroup=e;function t(r,n){var i;return r[n.keyword]!==void 0||((i=n.definition.implements)===null||i===void 0?void 0:i.some(s=>r[s]!==void 0))}return _e.shouldUseRule=t,_e}var _r;function Ke(){if(_r)return he;_r=1,Object.defineProperty(he,"__esModule",{value:!0}),he.reportTypeError=he.checkDataTypes=he.checkDataType=he.coerceAndCheckDataType=he.getJSONTypes=he.getSchemaTypes=he.DataType=void 0;const o=br(),e=$r(),t=Be(),r=W(),n=Q();var i;(function(l){l[l.Correct=0]="Correct",l[l.Wrong=1]="Wrong"})(i||(he.DataType=i={}));function s(l){const f=a(l.type);if(f.includes("null")){if(l.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!f.length&&l.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');l.nullable===!0&&f.push("null")}return f}he.getSchemaTypes=s;function a(l){const f=Array.isArray(l)?l:l?[l]:[];if(f.every(o.isJSONType))return f;throw new Error("type must be JSONType or JSONType[]: "+f.join(","))}he.getJSONTypes=a;function c(l,f){const{gen:m,data:b,opts:v}=l,_=d(f,v.coerceTypes),M=f.length>0&&!(_.length===0&&f.length===1&&(0,e.schemaHasRulesForType)(l,f[0]));if(M){const N=E(f,b,v.strictNumbers,i.Wrong);m.if(N,()=>{_.length?g(l,f,_):p(l)})}return M}he.coerceAndCheckDataType=c;const u=new Set(["string","number","integer","boolean","null"]);function d(l,f){return f?l.filter(m=>u.has(m)||f==="array"&&m==="array"):[]}function g(l,f,m){const{gen:b,data:v,opts:_}=l,M=b.let("dataType",(0,r._)`typeof ${v}`),N=b.let("coerced",(0,r._)`undefined`);_.coerceTypes==="array"&&b.if((0,r._)`${M} == 'object' && Array.isArray(${v}) && ${v}.length == 1`,()=>b.assign(v,(0,r._)`${v}[0]`).assign(M,(0,r._)`typeof ${v}`).if(E(f,v,_.strictNumbers),()=>b.assign(N,v))),b.if((0,r._)`${N} !== undefined`);for(const z of m)(u.has(z)||z==="array"&&_.coerceTypes==="array")&&q(z);b.else(),p(l),b.endIf(),b.if((0,r._)`${N} !== undefined`,()=>{b.assign(v,N),$(l,N)});function q(z){switch(z){case"string":b.elseIf((0,r._)`${M} == "number" || ${M} == "boolean"`).assign(N,(0,r._)`"" + ${v}`).elseIf((0,r._)`${v} === null`).assign(N,(0,r._)`""`);return;case"number":b.elseIf((0,r._)`${M} == "boolean" || ${v} === null
              || (${M} == "string" && ${v} && ${v} == +${v})`).assign(N,(0,r._)`+${v}`);return;case"integer":b.elseIf((0,r._)`${M} === "boolean" || ${v} === null
              || (${M} === "string" && ${v} && ${v} == +${v} && !(${v} % 1))`).assign(N,(0,r._)`+${v}`);return;case"boolean":b.elseIf((0,r._)`${v} === "false" || ${v} === 0 || ${v} === null`).assign(N,!1).elseIf((0,r._)`${v} === "true" || ${v} === 1`).assign(N,!0);return;case"null":b.elseIf((0,r._)`${v} === "" || ${v} === 0 || ${v} === false`),b.assign(N,null);return;case"array":b.elseIf((0,r._)`${M} === "string" || ${M} === "number"
              || ${M} === "boolean" || ${v} === null`).assign(N,(0,r._)`[${v}]`)}}}function $({gen:l,parentData:f,parentDataProperty:m},b){l.if((0,r._)`${f} !== undefined`,()=>l.assign((0,r._)`${f}[${m}]`,b))}function P(l,f,m,b=i.Correct){const v=b===i.Correct?r.operators.EQ:r.operators.NEQ;let _;switch(l){case"null":return(0,r._)`${f} ${v} null`;case"array":_=(0,r._)`Array.isArray(${f})`;break;case"object":_=(0,r._)`${f} && typeof ${f} == "object" && !Array.isArray(${f})`;break;case"integer":_=M((0,r._)`!(${f} % 1) && !isNaN(${f})`);break;case"number":_=M();break;default:return(0,r._)`typeof ${f} ${v} ${l}`}return b===i.Correct?_:(0,r.not)(_);function M(N=r.nil){return(0,r.and)((0,r._)`typeof ${f} == "number"`,N,m?(0,r._)`isFinite(${f})`:r.nil)}}he.checkDataType=P;function E(l,f,m,b){if(l.length===1)return P(l[0],f,m,b);let v;const _=(0,n.toHash)(l);if(_.array&&_.object){const M=(0,r._)`typeof ${f} != "object"`;v=_.null?M:(0,r._)`!${f} || ${M}`,delete _.null,delete _.array,delete _.object}else v=r.nil;_.number&&delete _.integer;for(const M in _)v=(0,r.and)(v,P(M,f,m,b));return v}he.checkDataTypes=E;const w={message:({schema:l})=>`must be ${l}`,params:({schema:l,schemaValue:f})=>typeof l=="string"?(0,r._)`{type: ${l}}`:(0,r._)`{type: ${f}}`};function p(l){const f=h(l);(0,t.reportError)(f,w)}he.reportTypeError=p;function h(l){const{gen:f,data:m,schema:b}=l,v=(0,n.schemaRefOrVal)(l,b,"type");return{gen:f,keyword:"type",data:m,schema:b.type,schemaCode:v,schemaValue:v,parentSchema:b,params:{},it:l}}return he}var Oe={},Pr;function Zn(){if(Pr)return Oe;Pr=1,Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.assignDefaults=void 0;const o=W(),e=Q();function t(n,i){const{properties:s,items:a}=n.schema;if(i==="object"&&s)for(const c in s)r(n,c,s[c].default);else i==="array"&&Array.isArray(a)&&a.forEach((c,u)=>r(n,u,c.default))}Oe.assignDefaults=t;function r(n,i,s){const{gen:a,compositeRule:c,data:u,opts:d}=n;if(s===void 0)return;const g=(0,o._)`${u}${(0,o.getProperty)(i)}`;if(c){(0,e.checkStrictMode)(n,`default is ignored for: ${g}`);return}let $=(0,o._)`${g} === undefined`;d.useDefaults==="empty"&&($=(0,o._)`${$} || ${g} === null || ${g} === ""`),a.if($,(0,o._)`${g} = ${(0,o.stringify)(s)}`)}return Oe}var be={},ne={},Sr;function we(){if(Sr)return ne;Sr=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.validateUnion=ne.validateArray=ne.usePattern=ne.callValidateCode=ne.schemaProperties=ne.allSchemaProperties=ne.noPropertyInData=ne.propertyInData=ne.isOwnProperty=ne.hasPropFunc=ne.reportMissingProp=ne.checkMissingProp=ne.checkReportMissingProp=void 0;const o=W(),e=Q(),t=Se(),r=Q();function n(l,f){const{gen:m,data:b,it:v}=l;m.if(d(m,b,f,v.opts.ownProperties),()=>{l.setParams({missingProperty:(0,o._)`${f}`},!0),l.error()})}ne.checkReportMissingProp=n;function i({gen:l,data:f,it:{opts:m}},b,v){return(0,o.or)(...b.map(_=>(0,o.and)(d(l,f,_,m.ownProperties),(0,o._)`${v} = ${_}`)))}ne.checkMissingProp=i;function s(l,f){l.setParams({missingProperty:f},!0),l.error()}ne.reportMissingProp=s;function a(l){return l.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,o._)`Object.prototype.hasOwnProperty`})}ne.hasPropFunc=a;function c(l,f,m){return(0,o._)`${a(l)}.call(${f}, ${m})`}ne.isOwnProperty=c;function u(l,f,m,b){const v=(0,o._)`${f}${(0,o.getProperty)(m)} !== undefined`;return b?(0,o._)`${v} && ${c(l,f,m)}`:v}ne.propertyInData=u;function d(l,f,m,b){const v=(0,o._)`${f}${(0,o.getProperty)(m)} === undefined`;return b?(0,o.or)(v,(0,o.not)(c(l,f,m))):v}ne.noPropertyInData=d;function g(l){return l?Object.keys(l).filter(f=>f!=="__proto__"):[]}ne.allSchemaProperties=g;function $(l,f){return g(f).filter(m=>!(0,e.alwaysValidSchema)(l,f[m]))}ne.schemaProperties=$;function P({schemaCode:l,data:f,it:{gen:m,topSchemaRef:b,schemaPath:v,errorPath:_},it:M},N,q,z){const G=z?(0,o._)`${l}, ${f}, ${b}${v}`:f,L=[[t.default.instancePath,(0,o.strConcat)(t.default.instancePath,_)],[t.default.parentData,M.parentData],[t.default.parentDataProperty,M.parentDataProperty],[t.default.rootData,t.default.rootData]];M.opts.dynamicRef&&L.push([t.default.dynamicAnchors,t.default.dynamicAnchors]);const H=(0,o._)`${G}, ${m.object(...L)}`;return q!==o.nil?(0,o._)`${N}.call(${q}, ${H})`:(0,o._)`${N}(${H})`}ne.callValidateCode=P;const E=(0,o._)`new RegExp`;function w({gen:l,it:{opts:f}},m){const b=f.unicodeRegExp?"u":"",{regExp:v}=f.code,_=v(m,b);return l.scopeValue("pattern",{key:_.toString(),ref:_,code:(0,o._)`${v.code==="new RegExp"?E:(0,r.useFunc)(l,v)}(${m}, ${b})`})}ne.usePattern=w;function p(l){const{gen:f,data:m,keyword:b,it:v}=l,_=f.name("valid");if(v.allErrors){const N=f.let("valid",!0);return M(()=>f.assign(N,!1)),N}return f.var(_,!0),M(()=>f.break()),_;function M(N){const q=f.const("len",(0,o._)`${m}.length`);f.forRange("i",0,q,z=>{l.subschema({keyword:b,dataProp:z,dataPropType:e.Type.Num},_),f.if((0,o.not)(_),N)})}}ne.validateArray=p;function h(l){const{gen:f,schema:m,keyword:b,it:v}=l;if(!Array.isArray(m))throw new Error("ajv implementation error");if(m.some(q=>(0,e.alwaysValidSchema)(v,q))&&!v.opts.unevaluated)return;const M=f.let("valid",!1),N=f.name("_valid");f.block(()=>m.forEach((q,z)=>{const G=l.subschema({keyword:b,schemaProp:z,compositeRule:!0},N);f.assign(M,(0,o._)`${M} || ${N}`),l.mergeValidEvaluated(G,N)||f.if((0,o.not)(M))})),l.result(M,()=>l.reset(),()=>l.error(!0))}return ne.validateUnion=h,ne}var Er;function ei(){if(Er)return be;Er=1,Object.defineProperty(be,"__esModule",{value:!0}),be.validateKeywordUsage=be.validSchemaType=be.funcKeywordCode=be.macroKeywordCode=void 0;const o=W(),e=Se(),t=we(),r=Be();function n($,P){const{gen:E,keyword:w,schema:p,parentSchema:h,it:l}=$,f=P.macro.call(l.self,p,h,l),m=u(E,w,f);l.opts.validateSchema!==!1&&l.self.validateSchema(f,!0);const b=E.name("valid");$.subschema({schema:f,schemaPath:o.nil,errSchemaPath:`${l.errSchemaPath}/${w}`,topSchemaRef:m,compositeRule:!0},b),$.pass(b,()=>$.error(!0))}be.macroKeywordCode=n;function i($,P){var E;const{gen:w,keyword:p,schema:h,parentSchema:l,$data:f,it:m}=$;c(m,P);const b=!f&&P.compile?P.compile.call(m.self,h,l,m):P.validate,v=u(w,p,b),_=w.let("valid");$.block$data(_,M),$.ok((E=P.valid)!==null&&E!==void 0?E:_);function M(){if(P.errors===!1)z(),P.modifying&&s($),G(()=>$.error());else{const L=P.async?N():q();P.modifying&&s($),G(()=>a($,L))}}function N(){const L=w.let("ruleErrs",null);return w.try(()=>z((0,o._)`await `),H=>w.assign(_,!1).if((0,o._)`${H} instanceof ${m.ValidationError}`,()=>w.assign(L,(0,o._)`${H}.errors`),()=>w.throw(H))),L}function q(){const L=(0,o._)`${v}.errors`;return w.assign(L,null),z(o.nil),L}function z(L=P.async?(0,o._)`await `:o.nil){const H=m.opts.passContext?e.default.this:e.default.self,ce=!("compile"in P&&!f||P.schema===!1);w.assign(_,(0,o._)`${L}${(0,t.callValidateCode)($,v,H,ce)}`,P.modifying)}function G(L){var H;w.if((0,o.not)((H=P.valid)!==null&&H!==void 0?H:_),L)}}be.funcKeywordCode=i;function s($){const{gen:P,data:E,it:w}=$;P.if(w.parentData,()=>P.assign(E,(0,o._)`${w.parentData}[${w.parentDataProperty}]`))}function a($,P){const{gen:E}=$;E.if((0,o._)`Array.isArray(${P})`,()=>{E.assign(e.default.vErrors,(0,o._)`${e.default.vErrors} === null ? ${P} : ${e.default.vErrors}.concat(${P})`).assign(e.default.errors,(0,o._)`${e.default.vErrors}.length`),(0,r.extendErrors)($)},()=>$.error())}function c({schemaEnv:$},P){if(P.async&&!$.$async)throw new Error("async keyword in sync schema")}function u($,P,E){if(E===void 0)throw new Error(`keyword "${P}" failed to compile`);return $.scopeValue("keyword",typeof E=="function"?{ref:E}:{ref:E,code:(0,o.stringify)(E)})}function d($,P,E=!1){return!P.length||P.some(w=>w==="array"?Array.isArray($):w==="object"?$&&typeof $=="object"&&!Array.isArray($):typeof $==w||E&&typeof $>"u")}be.validSchemaType=d;function g({schema:$,opts:P,self:E,errSchemaPath:w},p,h){if(Array.isArray(p.keyword)?!p.keyword.includes(h):p.keyword!==h)throw new Error("ajv implementation error");const l=p.dependencies;if(l?.some(f=>!Object.prototype.hasOwnProperty.call($,f)))throw new Error(`parent schema must have dependencies of ${h}: ${l.join(",")}`);if(p.validateSchema&&!p.validateSchema($[h])){const m=`keyword "${h}" value is invalid at path "${w}": `+E.errorsText(p.validateSchema.errors);if(P.validateSchema==="log")E.logger.error(m);else throw new Error(m)}}return be.validateKeywordUsage=g,be}var Pe={},Tr;function ti(){if(Tr)return Pe;Tr=1,Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.extendSubschemaMode=Pe.extendSubschemaData=Pe.getSubschema=void 0;const o=W(),e=Q();function t(i,{keyword:s,schemaProp:a,schema:c,schemaPath:u,errSchemaPath:d,topSchemaRef:g}){if(s!==void 0&&c!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(s!==void 0){const $=i.schema[s];return a===void 0?{schema:$,schemaPath:(0,o._)`${i.schemaPath}${(0,o.getProperty)(s)}`,errSchemaPath:`${i.errSchemaPath}/${s}`}:{schema:$[a],schemaPath:(0,o._)`${i.schemaPath}${(0,o.getProperty)(s)}${(0,o.getProperty)(a)}`,errSchemaPath:`${i.errSchemaPath}/${s}/${(0,e.escapeFragment)(a)}`}}if(c!==void 0){if(u===void 0||d===void 0||g===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:c,schemaPath:u,topSchemaRef:g,errSchemaPath:d}}throw new Error('either "keyword" or "schema" must be passed')}Pe.getSubschema=t;function r(i,s,{dataProp:a,dataPropType:c,data:u,dataTypes:d,propertyName:g}){if(u!==void 0&&a!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:$}=s;if(a!==void 0){const{errorPath:E,dataPathArr:w,opts:p}=s,h=$.let("data",(0,o._)`${s.data}${(0,o.getProperty)(a)}`,!0);P(h),i.errorPath=(0,o.str)`${E}${(0,e.getErrorPath)(a,c,p.jsPropertySyntax)}`,i.parentDataProperty=(0,o._)`${a}`,i.dataPathArr=[...w,i.parentDataProperty]}if(u!==void 0){const E=u instanceof o.Name?u:$.let("data",u,!0);P(E),g!==void 0&&(i.propertyName=g)}d&&(i.dataTypes=d);function P(E){i.data=E,i.dataLevel=s.dataLevel+1,i.dataTypes=[],s.definedProperties=new Set,i.parentData=s.data,i.dataNames=[...s.dataNames,E]}}Pe.extendSubschemaData=r;function n(i,{jtdDiscriminator:s,jtdMetadata:a,compositeRule:c,createErrors:u,allErrors:d}){c!==void 0&&(i.compositeRule=c),u!==void 0&&(i.createErrors=u),d!==void 0&&(i.allErrors=d),i.jtdDiscriminator=s,i.jtdMetadata=a}return Pe.extendSubschemaMode=n,Pe}var pe={},Gt,Mr;function kr(){return Mr||(Mr=1,Gt=function o(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,n,i;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(!o(e[n],t[n]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(i=Object.keys(e),r=i.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[n]))return!1;for(n=r;n--!==0;){var s=i[n];if(!o(e[s],t[s]))return!1}return!0}return e!==e&&t!==t}),Gt}var Bt={exports:{}},xr;function ri(){if(xr)return Bt.exports;xr=1;var o=Bt.exports=function(r,n,i){typeof n=="function"&&(i=n,n={}),i=n.cb||i;var s=typeof i=="function"?i:i.pre||function(){},a=i.post||function(){};e(n,s,a,r,"",r)};o.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0},o.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},o.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},o.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function e(r,n,i,s,a,c,u,d,g,$){if(s&&typeof s=="object"&&!Array.isArray(s)){n(s,a,c,u,d,g,$);for(var P in s){var E=s[P];if(Array.isArray(E)){if(P in o.arrayKeywords)for(var w=0;w<E.length;w++)e(r,n,i,E[w],a+"/"+P+"/"+w,c,a,P,s,w)}else if(P in o.propsKeywords){if(E&&typeof E=="object")for(var p in E)e(r,n,i,E[p],a+"/"+P+"/"+t(p),c,a,P,s,p)}else(P in o.keywords||r.allKeys&&!(P in o.skipKeywords))&&e(r,n,i,E,a+"/"+P,c,a,P,s)}i(s,a,c,u,d,g,$)}}function t(r){return r.replace(/~/g,"~0").replace(/\//g,"~1")}return Bt.exports}var Ar;function He(){if(Ar)return pe;Ar=1,Object.defineProperty(pe,"__esModule",{value:!0}),pe.getSchemaRefs=pe.resolveUrl=pe.normalizeId=pe._getFullPath=pe.getFullPath=pe.inlineRef=void 0;const o=Q(),e=kr(),t=ri(),r=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function n(w,p=!0){return typeof w=="boolean"?!0:p===!0?!s(w):p?a(w)<=p:!1}pe.inlineRef=n;const i=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function s(w){for(const p in w){if(i.has(p))return!0;const h=w[p];if(Array.isArray(h)&&h.some(s)||typeof h=="object"&&s(h))return!0}return!1}function a(w){let p=0;for(const h in w){if(h==="$ref")return 1/0;if(p++,!r.has(h)&&(typeof w[h]=="object"&&(0,o.eachItem)(w[h],l=>p+=a(l)),p===1/0))return 1/0}return p}function c(w,p="",h){h!==!1&&(p=g(p));const l=w.parse(p);return u(w,l)}pe.getFullPath=c;function u(w,p){return w.serialize(p).split("#")[0]+"#"}pe._getFullPath=u;const d=/#\/?$/;function g(w){return w?w.replace(d,""):""}pe.normalizeId=g;function $(w,p,h){return h=g(h),w.resolve(p,h)}pe.resolveUrl=$;const P=/^[a-z_][-a-z0-9._]*$/i;function E(w,p){if(typeof w=="boolean")return{};const{schemaId:h,uriResolver:l}=this.opts,f=g(w[h]||p),m={"":f},b=c(l,f,!1),v={},_=new Set;return t(w,{allKeys:!0},(q,z,G,L)=>{if(L===void 0)return;const H=b+z;let ce=m[L];typeof q[h]=="string"&&(ce=me.call(this,q[h])),ye.call(this,q.$anchor),ye.call(this,q.$dynamicAnchor),m[z]=ce;function me(ee){const V=this.opts.uriResolver.resolve;if(ee=g(ce?V(ce,ee):ee),_.has(ee))throw N(ee);_.add(ee);let I=this.refs[ee];return typeof I=="string"&&(I=this.refs[I]),typeof I=="object"?M(q,I.schema,ee):ee!==g(H)&&(ee[0]==="#"?(M(q,v[ee],ee),v[ee]=q):this.refs[ee]=H),ee}function ye(ee){if(typeof ee=="string"){if(!P.test(ee))throw new Error(`invalid anchor "${ee}"`);me.call(this,`#${ee}`)}}}),v;function M(q,z,G){if(z!==void 0&&!e(q,z))throw N(G)}function N(q){return new Error(`reference "${q}" resolves to more than one schema`)}}return pe.getSchemaRefs=E,pe}var Nr;function Je(){if(Nr)return $e;Nr=1,Object.defineProperty($e,"__esModule",{value:!0}),$e.getData=$e.KeywordCxt=$e.validateFunctionCode=void 0;const o=Qn(),e=Ke(),t=$r(),r=Ke(),n=Zn(),i=ei(),s=ti(),a=W(),c=Se(),u=He(),d=Q(),g=Be();function $(S){if(b(S)&&(_(S),m(S))){p(S);return}P(S,()=>(0,o.topBoolOrEmptySchema)(S))}$e.validateFunctionCode=$;function P({gen:S,validateName:k,schema:j,schemaEnv:O,opts:D},U){D.code.es5?S.func(k,(0,a._)`${c.default.data}, ${c.default.valCxt}`,O.$async,()=>{S.code((0,a._)`"use strict"; ${l(j,D)}`),w(S,D),S.code(U)}):S.func(k,(0,a._)`${c.default.data}, ${E(D)}`,O.$async,()=>S.code(l(j,D)).code(U))}function E(S){return(0,a._)`{${c.default.instancePath}="", ${c.default.parentData}, ${c.default.parentDataProperty}, ${c.default.rootData}=${c.default.data}${S.dynamicRef?(0,a._)`, ${c.default.dynamicAnchors}={}`:a.nil}}={}`}function w(S,k){S.if(c.default.valCxt,()=>{S.var(c.default.instancePath,(0,a._)`${c.default.valCxt}.${c.default.instancePath}`),S.var(c.default.parentData,(0,a._)`${c.default.valCxt}.${c.default.parentData}`),S.var(c.default.parentDataProperty,(0,a._)`${c.default.valCxt}.${c.default.parentDataProperty}`),S.var(c.default.rootData,(0,a._)`${c.default.valCxt}.${c.default.rootData}`),k.dynamicRef&&S.var(c.default.dynamicAnchors,(0,a._)`${c.default.valCxt}.${c.default.dynamicAnchors}`)},()=>{S.var(c.default.instancePath,(0,a._)`""`),S.var(c.default.parentData,(0,a._)`undefined`),S.var(c.default.parentDataProperty,(0,a._)`undefined`),S.var(c.default.rootData,c.default.data),k.dynamicRef&&S.var(c.default.dynamicAnchors,(0,a._)`{}`)})}function p(S){const{schema:k,opts:j,gen:O}=S;P(S,()=>{j.$comment&&k.$comment&&L(S),q(S),O.let(c.default.vErrors,null),O.let(c.default.errors,0),j.unevaluated&&h(S),M(S),H(S)})}function h(S){const{gen:k,validateName:j}=S;S.evaluated=k.const("evaluated",(0,a._)`${j}.evaluated`),k.if((0,a._)`${S.evaluated}.dynamicProps`,()=>k.assign((0,a._)`${S.evaluated}.props`,(0,a._)`undefined`)),k.if((0,a._)`${S.evaluated}.dynamicItems`,()=>k.assign((0,a._)`${S.evaluated}.items`,(0,a._)`undefined`))}function l(S,k){const j=typeof S=="object"&&S[k.schemaId];return j&&(k.code.source||k.code.process)?(0,a._)`/*# sourceURL=${j} */`:a.nil}function f(S,k){if(b(S)&&(_(S),m(S))){v(S,k);return}(0,o.boolOrEmptySchema)(S,k)}function m({schema:S,self:k}){if(typeof S=="boolean")return!S;for(const j in S)if(k.RULES.all[j])return!0;return!1}function b(S){return typeof S.schema!="boolean"}function v(S,k){const{schema:j,gen:O,opts:D}=S;D.$comment&&j.$comment&&L(S),z(S),G(S);const U=O.const("_errs",c.default.errors);M(S,U),O.var(k,(0,a._)`${U} === ${c.default.errors}`)}function _(S){(0,d.checkUnknownRules)(S),N(S)}function M(S,k){if(S.opts.jtd)return me(S,[],!1,k);const j=(0,e.getSchemaTypes)(S.schema),O=(0,e.coerceAndCheckDataType)(S,j);me(S,j,!O,k)}function N(S){const{schema:k,errSchemaPath:j,opts:O,self:D}=S;k.$ref&&O.ignoreKeywordsWithRef&&(0,d.schemaHasRulesButRef)(k,D.RULES)&&D.logger.warn(`$ref: keywords ignored in schema at path "${j}"`)}function q(S){const{schema:k,opts:j}=S;k.default!==void 0&&j.useDefaults&&j.strictSchema&&(0,d.checkStrictMode)(S,"default is ignored in the schema root")}function z(S){const k=S.schema[S.opts.schemaId];k&&(S.baseId=(0,u.resolveUrl)(S.opts.uriResolver,S.baseId,k))}function G(S){if(S.schema.$async&&!S.schemaEnv.$async)throw new Error("async schema in sync schema")}function L({gen:S,schemaEnv:k,schema:j,errSchemaPath:O,opts:D}){const U=j.$comment;if(D.$comment===!0)S.code((0,a._)`${c.default.self}.logger.log(${U})`);else if(typeof D.$comment=="function"){const Z=(0,a.str)`${O}/$comment`,te=S.scopeValue("root",{ref:k.root});S.code((0,a._)`${c.default.self}.opts.$comment(${U}, ${Z}, ${te}.schema)`)}}function H(S){const{gen:k,schemaEnv:j,validateName:O,ValidationError:D,opts:U}=S;j.$async?k.if((0,a._)`${c.default.errors} === 0`,()=>k.return(c.default.data),()=>k.throw((0,a._)`new ${D}(${c.default.vErrors})`)):(k.assign((0,a._)`${O}.errors`,c.default.vErrors),U.unevaluated&&ce(S),k.return((0,a._)`${c.default.errors} === 0`))}function ce({gen:S,evaluated:k,props:j,items:O}){j instanceof a.Name&&S.assign((0,a._)`${k}.props`,j),O instanceof a.Name&&S.assign((0,a._)`${k}.items`,O)}function me(S,k,j,O){const{gen:D,schema:U,data:Z,allErrors:te,opts:oe,self:le}=S,{RULES:se}=le;if(U.$ref&&(oe.ignoreKeywordsWithRef||!(0,d.schemaHasRulesButRef)(U,se))){D.block(()=>F(S,"$ref",se.all.$ref.definition));return}oe.jtd||ee(S,k),D.block(()=>{for(const ue of se.rules)ae(ue);ae(se.post)});function ae(ue){(0,t.shouldUseGroup)(U,ue)&&(ue.type?(D.if((0,r.checkDataType)(ue.type,Z,oe.strictNumbers)),ye(S,ue),k.length===1&&k[0]===ue.type&&j&&(D.else(),(0,r.reportTypeError)(S)),D.endIf()):ye(S,ue),te||D.if((0,a._)`${c.default.errors} === ${O||0}`))}}function ye(S,k){const{gen:j,schema:O,opts:{useDefaults:D}}=S;D&&(0,n.assignDefaults)(S,k.type),j.block(()=>{for(const U of k.rules)(0,t.shouldUseRule)(O,U)&&F(S,U.keyword,U.definition,k.type)})}function ee(S,k){S.schemaEnv.meta||!S.opts.strictTypes||(V(S,k),S.opts.allowUnionTypes||I(S,k),x(S,S.dataTypes))}function V(S,k){if(k.length){if(!S.dataTypes.length){S.dataTypes=k;return}k.forEach(j=>{A(S.dataTypes,j)||T(S,`type "${j}" not allowed by context "${S.dataTypes.join(",")}"`)}),y(S,k)}}function I(S,k){k.length>1&&!(k.length===2&&k.includes("null"))&&T(S,"use allowUnionTypes to allow union type keyword")}function x(S,k){const j=S.self.RULES.all;for(const O in j){const D=j[O];if(typeof D=="object"&&(0,t.shouldUseRule)(S.schema,D)){const{type:U}=D.definition;U.length&&!U.some(Z=>C(k,Z))&&T(S,`missing type "${U.join(",")}" for keyword "${O}"`)}}}function C(S,k){return S.includes(k)||k==="number"&&S.includes("integer")}function A(S,k){return S.includes(k)||k==="integer"&&S.includes("number")}function y(S,k){const j=[];for(const O of S.dataTypes)A(k,O)?j.push(O):k.includes("integer")&&O==="number"&&j.push("integer");S.dataTypes=j}function T(S,k){const j=S.schemaEnv.baseId+S.errSchemaPath;k+=` at "${j}" (strictTypes)`,(0,d.checkStrictMode)(S,k,S.opts.strictTypes)}class R{constructor(k,j,O){if((0,i.validateKeywordUsage)(k,j,O),this.gen=k.gen,this.allErrors=k.allErrors,this.keyword=O,this.data=k.data,this.schema=k.schema[O],this.$data=j.$data&&k.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,d.schemaRefOrVal)(k,this.schema,O,this.$data),this.schemaType=j.schemaType,this.parentSchema=k.schema,this.params={},this.it=k,this.def=j,this.$data)this.schemaCode=k.gen.const("vSchema",Y(this.$data,k));else if(this.schemaCode=this.schemaValue,!(0,i.validSchemaType)(this.schema,j.schemaType,j.allowUndefined))throw new Error(`${O} value must be ${JSON.stringify(j.schemaType)}`);("code"in j?j.trackErrors:j.errors!==!1)&&(this.errsCount=k.gen.const("_errs",c.default.errors))}result(k,j,O){this.failResult((0,a.not)(k),j,O)}failResult(k,j,O){this.gen.if(k),O?O():this.error(),j?(this.gen.else(),j(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(k,j){this.failResult((0,a.not)(k),void 0,j)}fail(k){if(k===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(k),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(k){if(!this.$data)return this.fail(k);const{schemaCode:j}=this;this.fail((0,a._)`${j} !== undefined && (${(0,a.or)(this.invalid$data(),k)})`)}error(k,j,O){if(j){this.setParams(j),this._error(k,O),this.setParams({});return}this._error(k,O)}_error(k,j){(k?g.reportExtraError:g.reportError)(this,this.def.error,j)}$dataError(){(0,g.reportError)(this,this.def.$dataError||g.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,g.resetErrorsCount)(this.gen,this.errsCount)}ok(k){this.allErrors||this.gen.if(k)}setParams(k,j){j?Object.assign(this.params,k):this.params=k}block$data(k,j,O=a.nil){this.gen.block(()=>{this.check$data(k,O),j()})}check$data(k=a.nil,j=a.nil){if(!this.$data)return;const{gen:O,schemaCode:D,schemaType:U,def:Z}=this;O.if((0,a.or)((0,a._)`${D} === undefined`,j)),k!==a.nil&&O.assign(k,!0),(U.length||Z.validateSchema)&&(O.elseIf(this.invalid$data()),this.$dataError(),k!==a.nil&&O.assign(k,!1)),O.else()}invalid$data(){const{gen:k,schemaCode:j,schemaType:O,def:D,it:U}=this;return(0,a.or)(Z(),te());function Z(){if(O.length){if(!(j instanceof a.Name))throw new Error("ajv implementation error");const oe=Array.isArray(O)?O:[O];return(0,a._)`${(0,r.checkDataTypes)(oe,j,U.opts.strictNumbers,r.DataType.Wrong)}`}return a.nil}function te(){if(D.validateSchema){const oe=k.scopeValue("validate$data",{ref:D.validateSchema});return(0,a._)`!${oe}(${j})`}return a.nil}}subschema(k,j){const O=(0,s.getSubschema)(this.it,k);(0,s.extendSubschemaData)(O,this.it,k),(0,s.extendSubschemaMode)(O,k);const D={...this.it,...O,items:void 0,props:void 0};return f(D,j),D}mergeEvaluated(k,j){const{it:O,gen:D}=this;O.opts.unevaluated&&(O.props!==!0&&k.props!==void 0&&(O.props=d.mergeEvaluated.props(D,k.props,O.props,j)),O.items!==!0&&k.items!==void 0&&(O.items=d.mergeEvaluated.items(D,k.items,O.items,j)))}mergeValidEvaluated(k,j){const{it:O,gen:D}=this;if(O.opts.unevaluated&&(O.props!==!0||O.items!==!0))return D.if(j,()=>this.mergeEvaluated(k,a.Name)),!0}}$e.KeywordCxt=R;function F(S,k,j,O){const D=new R(S,j,k);"code"in j?j.code(D,O):D.$data&&j.validate?(0,i.funcKeywordCode)(D,j):"macro"in j?(0,i.macroKeywordCode)(D,j):(j.compile||j.validate)&&(0,i.funcKeywordCode)(D,j)}const B=/^\/(?:[^~]|~0|~1)*$/,X=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function Y(S,{dataLevel:k,dataNames:j,dataPathArr:O}){let D,U;if(S==="")return c.default.rootData;if(S[0]==="/"){if(!B.test(S))throw new Error(`Invalid JSON-pointer: ${S}`);D=S,U=c.default.rootData}else{const le=X.exec(S);if(!le)throw new Error(`Invalid JSON-pointer: ${S}`);const se=+le[1];if(D=le[2],D==="#"){if(se>=k)throw new Error(oe("property/index",se));return O[k-se]}if(se>k)throw new Error(oe("data",se));if(U=j[k-se],!D)return U}let Z=U;const te=D.split("/");for(const le of te)le&&(U=(0,a._)`${U}${(0,a.getProperty)((0,d.unescapeJsonPointer)(le))}`,Z=(0,a._)`${Z} && ${U}`);return Z;function oe(le,se){return`Cannot access ${le} ${se} levels up, current level is ${k}`}}return $e.getData=Y,$e}var We={},Rr;function Kt(){if(Rr)return We;Rr=1,Object.defineProperty(We,"__esModule",{value:!0});class o extends Error{constructor(t){super("validation failed"),this.errors=t,this.ajv=this.validation=!0}}return We.default=o,We}var Ye={},jr;function Xe(){if(jr)return Ye;jr=1,Object.defineProperty(Ye,"__esModule",{value:!0});const o=He();class e extends Error{constructor(r,n,i,s){super(s||`can't resolve reference ${i} from id ${n}`),this.missingRef=(0,o.resolveUrl)(r,n,i),this.missingSchema=(0,o.normalizeId)((0,o.getFullPath)(r,this.missingRef))}}return Ye.default=e,Ye}var ge={},Cr;function Ht(){if(Cr)return ge;Cr=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.resolveSchema=ge.getCompilingSchema=ge.resolveRef=ge.compileSchema=ge.SchemaEnv=void 0;const o=W(),e=Kt(),t=Se(),r=He(),n=Q(),i=Je();class s{constructor(h){var l;this.refs={},this.dynamicAnchors={};let f;typeof h.schema=="object"&&(f=h.schema),this.schema=h.schema,this.schemaId=h.schemaId,this.root=h.root||this,this.baseId=(l=h.baseId)!==null&&l!==void 0?l:(0,r.normalizeId)(f?.[h.schemaId||"$id"]),this.schemaPath=h.schemaPath,this.localRefs=h.localRefs,this.meta=h.meta,this.$async=f?.$async,this.refs={}}}ge.SchemaEnv=s;function a(p){const h=d.call(this,p);if(h)return h;const l=(0,r.getFullPath)(this.opts.uriResolver,p.root.baseId),{es5:f,lines:m}=this.opts.code,{ownProperties:b}=this.opts,v=new o.CodeGen(this.scope,{es5:f,lines:m,ownProperties:b});let _;p.$async&&(_=v.scopeValue("Error",{ref:e.default,code:(0,o._)`require("ajv/dist/runtime/validation_error").default`}));const M=v.scopeName("validate");p.validateName=M;const N={gen:v,allErrors:this.opts.allErrors,data:t.default.data,parentData:t.default.parentData,parentDataProperty:t.default.parentDataProperty,dataNames:[t.default.data],dataPathArr:[o.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:v.scopeValue("schema",this.opts.code.source===!0?{ref:p.schema,code:(0,o.stringify)(p.schema)}:{ref:p.schema}),validateName:M,ValidationError:_,schema:p.schema,schemaEnv:p,rootId:l,baseId:p.baseId||l,schemaPath:o.nil,errSchemaPath:p.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,o._)`""`,opts:this.opts,self:this};let q;try{this._compilations.add(p),(0,i.validateFunctionCode)(N),v.optimize(this.opts.code.optimize);const z=v.toString();q=`${v.scopeRefs(t.default.scope)}return ${z}`,this.opts.code.process&&(q=this.opts.code.process(q,p));const L=new Function(`${t.default.self}`,`${t.default.scope}`,q)(this,this.scope.get());if(this.scope.value(M,{ref:L}),L.errors=null,L.schema=p.schema,L.schemaEnv=p,p.$async&&(L.$async=!0),this.opts.code.source===!0&&(L.source={validateName:M,validateCode:z,scopeValues:v._values}),this.opts.unevaluated){const{props:H,items:ce}=N;L.evaluated={props:H instanceof o.Name?void 0:H,items:ce instanceof o.Name?void 0:ce,dynamicProps:H instanceof o.Name,dynamicItems:ce instanceof o.Name},L.source&&(L.source.evaluated=(0,o.stringify)(L.evaluated))}return p.validate=L,p}catch(z){throw delete p.validate,delete p.validateName,q&&this.logger.error("Error compiling schema, function code:",q),z}finally{this._compilations.delete(p)}}ge.compileSchema=a;function c(p,h,l){var f;l=(0,r.resolveUrl)(this.opts.uriResolver,h,l);const m=p.refs[l];if(m)return m;let b=$.call(this,p,l);if(b===void 0){const v=(f=p.localRefs)===null||f===void 0?void 0:f[l],{schemaId:_}=this.opts;v&&(b=new s({schema:v,schemaId:_,root:p,baseId:h}))}if(b!==void 0)return p.refs[l]=u.call(this,b)}ge.resolveRef=c;function u(p){return(0,r.inlineRef)(p.schema,this.opts.inlineRefs)?p.schema:p.validate?p:a.call(this,p)}function d(p){for(const h of this._compilations)if(g(h,p))return h}ge.getCompilingSchema=d;function g(p,h){return p.schema===h.schema&&p.root===h.root&&p.baseId===h.baseId}function $(p,h){let l;for(;typeof(l=this.refs[h])=="string";)h=l;return l||this.schemas[h]||P.call(this,p,h)}function P(p,h){const l=this.opts.uriResolver.parse(h),f=(0,r._getFullPath)(this.opts.uriResolver,l);let m=(0,r.getFullPath)(this.opts.uriResolver,p.baseId,void 0);if(Object.keys(p.schema).length>0&&f===m)return w.call(this,l,p);const b=(0,r.normalizeId)(f),v=this.refs[b]||this.schemas[b];if(typeof v=="string"){const _=P.call(this,p,v);return typeof _?.schema!="object"?void 0:w.call(this,l,_)}if(typeof v?.schema=="object"){if(v.validate||a.call(this,v),b===(0,r.normalizeId)(h)){const{schema:_}=v,{schemaId:M}=this.opts,N=_[M];return N&&(m=(0,r.resolveUrl)(this.opts.uriResolver,m,N)),new s({schema:_,schemaId:M,root:p,baseId:m})}return w.call(this,l,v)}}ge.resolveSchema=P;const E=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function w(p,{baseId:h,schema:l,root:f}){var m;if(((m=p.fragment)===null||m===void 0?void 0:m[0])!=="/")return;for(const _ of p.fragment.slice(1).split("/")){if(typeof l=="boolean")return;const M=l[(0,n.unescapeFragment)(_)];if(M===void 0)return;l=M;const N=typeof l=="object"&&l[this.opts.schemaId];!E.has(_)&&N&&(h=(0,r.resolveUrl)(this.opts.uriResolver,h,N))}let b;if(typeof l!="boolean"&&l.$ref&&!(0,n.schemaHasRulesButRef)(l,this.RULES)){const _=(0,r.resolveUrl)(this.opts.uriResolver,h,l.$ref);b=P.call(this,f,_)}const{schemaId:v}=this.opts;if(b=b||new s({schema:l,schemaId:v,root:f,baseId:h}),b.schema!==b.root.schema)return b}return ge}const ni={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1};var Qe={},Ie={exports:{}},Jt,Or;function ii(){return Or||(Or=1,Jt={HEX:{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15}}),Jt}var Wt,Ir;function oi(){if(Ir)return Wt;Ir=1;const{HEX:o}=ii(),e=/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u;function t(w){if(a(w,".")<3)return{host:w,isIPV4:!1};const p=w.match(e)||[],[h]=p;return h?{host:s(h,"."),isIPV4:!0}:{host:w,isIPV4:!1}}function r(w,p=!1){let h="",l=!0;for(const f of w){if(o[f]===void 0)return;f!=="0"&&l===!0&&(l=!1),l||(h+=f)}return p&&h.length===0&&(h="0"),h}function n(w){let p=0;const h={error:!1,address:"",zone:""},l=[],f=[];let m=!1,b=!1,v=!1;function _(){if(f.length){if(m===!1){const M=r(f);if(M!==void 0)l.push(M);else return h.error=!0,!1}f.length=0}return!0}for(let M=0;M<w.length;M++){const N=w[M];if(!(N==="["||N==="]"))if(N===":"){if(b===!0&&(v=!0),!_())break;if(p++,l.push(":"),p>7){h.error=!0;break}M-1>=0&&w[M-1]===":"&&(b=!0);continue}else if(N==="%"){if(!_())break;m=!0}else{f.push(N);continue}}return f.length&&(m?h.zone=f.join(""):v?l.push(f.join("")):l.push(r(f))),h.address=l.join(""),h}function i(w){if(a(w,":")<2)return{host:w,isIPV6:!1};const p=n(w);if(p.error)return{host:w,isIPV6:!1};{let h=p.address,l=p.address;return p.zone&&(h+="%"+p.zone,l+="%25"+p.zone),{host:h,escapedHost:l,isIPV6:!0}}}function s(w,p){let h="",l=!0;const f=w.length;for(let m=0;m<f;m++){const b=w[m];b==="0"&&l?(m+1<=f&&w[m+1]===p||m+1===f)&&(h+=b,l=!1):(b===p?l=!0:l=!1,h+=b)}return h}function a(w,p){let h=0;for(let l=0;l<w.length;l++)w[l]===p&&h++;return h}const c=/^\.\.?\//u,u=/^\/\.(?:\/|$)/u,d=/^\/\.\.(?:\/|$)/u,g=/^\/?(?:.|\n)*?(?=\/|$)/u;function $(w){const p=[];for(;w.length;)if(w.match(c))w=w.replace(c,"");else if(w.match(u))w=w.replace(u,"/");else if(w.match(d))w=w.replace(d,"/"),p.pop();else if(w==="."||w==="..")w="";else{const h=w.match(g);if(h){const l=h[0];w=w.slice(l.length),p.push(l)}else throw new Error("Unexpected dot segment condition")}return p.join("")}function P(w,p){const h=p!==!0?escape:unescape;return w.scheme!==void 0&&(w.scheme=h(w.scheme)),w.userinfo!==void 0&&(w.userinfo=h(w.userinfo)),w.host!==void 0&&(w.host=h(w.host)),w.path!==void 0&&(w.path=h(w.path)),w.query!==void 0&&(w.query=h(w.query)),w.fragment!==void 0&&(w.fragment=h(w.fragment)),w}function E(w){const p=[];if(w.userinfo!==void 0&&(p.push(w.userinfo),p.push("@")),w.host!==void 0){let h=unescape(w.host);const l=t(h);if(l.isIPV4)h=l.host;else{const f=i(l.host);f.isIPV6===!0?h=`[${f.escapedHost}]`:h=w.host}p.push(h)}return(typeof w.port=="number"||typeof w.port=="string")&&(p.push(":"),p.push(String(w.port))),p.length?p.join(""):void 0}return Wt={recomposeAuthority:E,normalizeComponentEncoding:P,removeDotSegments:$,normalizeIPv4:t,normalizeIPv6:i,stringArrayToHexStripped:r},Wt}var Yt,qr;function si(){if(qr)return Yt;qr=1;const o=/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu,e=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu;function t(l){return typeof l.secure=="boolean"?l.secure:String(l.scheme).toLowerCase()==="wss"}function r(l){return l.host||(l.error=l.error||"HTTP URIs must have a host."),l}function n(l){const f=String(l.scheme).toLowerCase()==="https";return(l.port===(f?443:80)||l.port==="")&&(l.port=void 0),l.path||(l.path="/"),l}function i(l){return l.secure=t(l),l.resourceName=(l.path||"/")+(l.query?"?"+l.query:""),l.path=void 0,l.query=void 0,l}function s(l){if((l.port===(t(l)?443:80)||l.port==="")&&(l.port=void 0),typeof l.secure=="boolean"&&(l.scheme=l.secure?"wss":"ws",l.secure=void 0),l.resourceName){const[f,m]=l.resourceName.split("?");l.path=f&&f!=="/"?f:void 0,l.query=m,l.resourceName=void 0}return l.fragment=void 0,l}function a(l,f){if(!l.path)return l.error="URN can not be parsed",l;const m=l.path.match(e);if(m){const b=f.scheme||l.scheme||"urn";l.nid=m[1].toLowerCase(),l.nss=m[2];const v=`${b}:${f.nid||l.nid}`,_=h[v];l.path=void 0,_&&(l=_.parse(l,f))}else l.error=l.error||"URN can not be parsed.";return l}function c(l,f){const m=f.scheme||l.scheme||"urn",b=l.nid.toLowerCase(),v=`${m}:${f.nid||b}`,_=h[v];_&&(l=_.serialize(l,f));const M=l,N=l.nss;return M.path=`${b||f.nid}:${N}`,f.skipEscape=!0,M}function u(l,f){const m=l;return m.uuid=m.nss,m.nss=void 0,!f.tolerant&&(!m.uuid||!o.test(m.uuid))&&(m.error=m.error||"UUID is not valid."),m}function d(l){const f=l;return f.nss=(l.uuid||"").toLowerCase(),f}const g={scheme:"http",domainHost:!0,parse:r,serialize:n},$={scheme:"https",domainHost:g.domainHost,parse:r,serialize:n},P={scheme:"ws",domainHost:!0,parse:i,serialize:s},E={scheme:"wss",domainHost:P.domainHost,parse:P.parse,serialize:P.serialize},h={http:g,https:$,ws:P,wss:E,urn:{scheme:"urn",parse:a,serialize:c,skipNormalize:!0},"urn:uuid":{scheme:"urn:uuid",parse:u,serialize:d,skipNormalize:!0}};return Yt=h,Yt}var Dr;function ai(){if(Dr)return Ie.exports;Dr=1;const{normalizeIPv6:o,normalizeIPv4:e,removeDotSegments:t,recomposeAuthority:r,normalizeComponentEncoding:n}=oi(),i=si();function s(p,h){return typeof p=="string"?p=d(E(p,h),h):typeof p=="object"&&(p=E(d(p,h),h)),p}function a(p,h,l){const f=Object.assign({scheme:"null"},l),m=c(E(p,f),E(h,f),f,!0);return d(m,{...f,skipEscape:!0})}function c(p,h,l,f){const m={};return f||(p=E(d(p,l),l),h=E(d(h,l),l)),l=l||{},!l.tolerant&&h.scheme?(m.scheme=h.scheme,m.userinfo=h.userinfo,m.host=h.host,m.port=h.port,m.path=t(h.path||""),m.query=h.query):(h.userinfo!==void 0||h.host!==void 0||h.port!==void 0?(m.userinfo=h.userinfo,m.host=h.host,m.port=h.port,m.path=t(h.path||""),m.query=h.query):(h.path?(h.path.charAt(0)==="/"?m.path=t(h.path):((p.userinfo!==void 0||p.host!==void 0||p.port!==void 0)&&!p.path?m.path="/"+h.path:p.path?m.path=p.path.slice(0,p.path.lastIndexOf("/")+1)+h.path:m.path=h.path,m.path=t(m.path)),m.query=h.query):(m.path=p.path,h.query!==void 0?m.query=h.query:m.query=p.query),m.userinfo=p.userinfo,m.host=p.host,m.port=p.port),m.scheme=p.scheme),m.fragment=h.fragment,m}function u(p,h,l){return typeof p=="string"?(p=unescape(p),p=d(n(E(p,l),!0),{...l,skipEscape:!0})):typeof p=="object"&&(p=d(n(p,!0),{...l,skipEscape:!0})),typeof h=="string"?(h=unescape(h),h=d(n(E(h,l),!0),{...l,skipEscape:!0})):typeof h=="object"&&(h=d(n(h,!0),{...l,skipEscape:!0})),p.toLowerCase()===h.toLowerCase()}function d(p,h){const l={host:p.host,scheme:p.scheme,userinfo:p.userinfo,port:p.port,path:p.path,query:p.query,nid:p.nid,nss:p.nss,uuid:p.uuid,fragment:p.fragment,reference:p.reference,resourceName:p.resourceName,secure:p.secure,error:""},f=Object.assign({},h),m=[],b=i[(f.scheme||l.scheme||"").toLowerCase()];b&&b.serialize&&b.serialize(l,f),l.path!==void 0&&(f.skipEscape?l.path=unescape(l.path):(l.path=escape(l.path),l.scheme!==void 0&&(l.path=l.path.split("%3A").join(":")))),f.reference!=="suffix"&&l.scheme&&m.push(l.scheme,":");const v=r(l);if(v!==void 0&&(f.reference!=="suffix"&&m.push("//"),m.push(v),l.path&&l.path.charAt(0)!=="/"&&m.push("/")),l.path!==void 0){let _=l.path;!f.absolutePath&&(!b||!b.absolutePath)&&(_=t(_)),v===void 0&&(_=_.replace(/^\/\//u,"/%2F")),m.push(_)}return l.query!==void 0&&m.push("?",l.query),l.fragment!==void 0&&m.push("#",l.fragment),m.join("")}const g=Array.from({length:127},(p,h)=>/[^!"$&'()*+,\-.;=_`a-z{}~]/u.test(String.fromCharCode(h)));function $(p){let h=0;for(let l=0,f=p.length;l<f;++l)if(h=p.charCodeAt(l),h>126||g[h])return!0;return!1}const P=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function E(p,h){const l=Object.assign({},h),f={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0},m=p.indexOf("%")!==-1;let b=!1;l.reference==="suffix"&&(p=(l.scheme?l.scheme+":":"")+"//"+p);const v=p.match(P);if(v){if(f.scheme=v[1],f.userinfo=v[3],f.host=v[4],f.port=parseInt(v[5],10),f.path=v[6]||"",f.query=v[7],f.fragment=v[8],isNaN(f.port)&&(f.port=v[5]),f.host){const M=e(f.host);if(M.isIPV4===!1){const N=o(M.host);f.host=N.host.toLowerCase(),b=N.isIPV6}else f.host=M.host,b=!0}f.scheme===void 0&&f.userinfo===void 0&&f.host===void 0&&f.port===void 0&&f.query===void 0&&!f.path?f.reference="same-document":f.scheme===void 0?f.reference="relative":f.fragment===void 0?f.reference="absolute":f.reference="uri",l.reference&&l.reference!=="suffix"&&l.reference!==f.reference&&(f.error=f.error||"URI is not a "+l.reference+" reference.");const _=i[(l.scheme||f.scheme||"").toLowerCase()];if(!l.unicodeSupport&&(!_||!_.unicodeSupport)&&f.host&&(l.domainHost||_&&_.domainHost)&&b===!1&&$(f.host))try{f.host=URL.domainToASCII(f.host.toLowerCase())}catch(M){f.error=f.error||"Host's domain name can not be converted to ASCII: "+M}(!_||_&&!_.skipNormalize)&&(m&&f.scheme!==void 0&&(f.scheme=unescape(f.scheme)),m&&f.host!==void 0&&(f.host=unescape(f.host)),f.path&&(f.path=escape(unescape(f.path))),f.fragment&&(f.fragment=encodeURI(decodeURIComponent(f.fragment)))),_&&_.parse&&_.parse(f,l)}else f.error=f.error||"URI can not be parsed.";return f}const w={SCHEMES:i,normalize:s,resolve:a,resolveComponents:c,equal:u,serialize:d,parse:E};return Ie.exports=w,Ie.exports.default=w,Ie.exports.fastUri=w,Ie.exports}var zr;function ci(){if(zr)return Qe;zr=1,Object.defineProperty(Qe,"__esModule",{value:!0});const o=ai();return o.code='require("ajv/dist/runtime/uri").default',Qe.default=o,Qe}var Vr;function li(){return Vr||(Vr=1,(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.CodeGen=o.Name=o.nil=o.stringify=o.str=o._=o.KeywordCxt=void 0;var e=Je();Object.defineProperty(o,"KeywordCxt",{enumerable:!0,get:function(){return e.KeywordCxt}});var t=W();Object.defineProperty(o,"_",{enumerable:!0,get:function(){return t._}}),Object.defineProperty(o,"str",{enumerable:!0,get:function(){return t.str}}),Object.defineProperty(o,"stringify",{enumerable:!0,get:function(){return t.stringify}}),Object.defineProperty(o,"nil",{enumerable:!0,get:function(){return t.nil}}),Object.defineProperty(o,"Name",{enumerable:!0,get:function(){return t.Name}}),Object.defineProperty(o,"CodeGen",{enumerable:!0,get:function(){return t.CodeGen}});const r=Kt(),n=Xe(),i=br(),s=Ht(),a=W(),c=He(),u=Ke(),d=Q(),g=ni,$=ci(),P=(I,x)=>new RegExp(I,x);P.code="new RegExp";const E=["removeAdditional","useDefaults","coerceTypes"],w=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),p={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},h={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},l=200;function f(I){var x,C,A,y,T,R,F,B,X,Y,S,k,j,O,D,U,Z,te,oe,le,se,ae,ue,re,K;const ie=I.strict,fe=(x=I.code)===null||x===void 0?void 0:x.optimize,ve=fe===!0||fe===void 0?1:fe||0,Fe=(A=(C=I.code)===null||C===void 0?void 0:C.regExp)!==null&&A!==void 0?A:P,It=(y=I.uriResolver)!==null&&y!==void 0?y:$.default;return{strictSchema:(R=(T=I.strictSchema)!==null&&T!==void 0?T:ie)!==null&&R!==void 0?R:!0,strictNumbers:(B=(F=I.strictNumbers)!==null&&F!==void 0?F:ie)!==null&&B!==void 0?B:!0,strictTypes:(Y=(X=I.strictTypes)!==null&&X!==void 0?X:ie)!==null&&Y!==void 0?Y:"log",strictTuples:(k=(S=I.strictTuples)!==null&&S!==void 0?S:ie)!==null&&k!==void 0?k:"log",strictRequired:(O=(j=I.strictRequired)!==null&&j!==void 0?j:ie)!==null&&O!==void 0?O:!1,code:I.code?{...I.code,optimize:ve,regExp:Fe}:{optimize:ve,regExp:Fe},loopRequired:(D=I.loopRequired)!==null&&D!==void 0?D:l,loopEnum:(U=I.loopEnum)!==null&&U!==void 0?U:l,meta:(Z=I.meta)!==null&&Z!==void 0?Z:!0,messages:(te=I.messages)!==null&&te!==void 0?te:!0,inlineRefs:(oe=I.inlineRefs)!==null&&oe!==void 0?oe:!0,schemaId:(le=I.schemaId)!==null&&le!==void 0?le:"$id",addUsedSchema:(se=I.addUsedSchema)!==null&&se!==void 0?se:!0,validateSchema:(ae=I.validateSchema)!==null&&ae!==void 0?ae:!0,validateFormats:(ue=I.validateFormats)!==null&&ue!==void 0?ue:!0,unicodeRegExp:(re=I.unicodeRegExp)!==null&&re!==void 0?re:!0,int32range:(K=I.int32range)!==null&&K!==void 0?K:!0,uriResolver:It}}class m{constructor(x={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,x=this.opts={...x,...f(x)};const{es5:C,lines:A}=this.opts.code;this.scope=new a.ValueScope({scope:{},prefixes:w,es5:C,lines:A}),this.logger=G(x.logger);const y=x.validateFormats;x.validateFormats=!1,this.RULES=(0,i.getRules)(),b.call(this,p,x,"NOT SUPPORTED"),b.call(this,h,x,"DEPRECATED","warn"),this._metaOpts=q.call(this),x.formats&&M.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),x.keywords&&N.call(this,x.keywords),typeof x.meta=="object"&&this.addMetaSchema(x.meta),_.call(this),x.validateFormats=y}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:x,meta:C,schemaId:A}=this.opts;let y=g;A==="id"&&(y={...g},y.id=y.$id,delete y.$id),C&&x&&this.addMetaSchema(y,y[A],!1)}defaultMeta(){const{meta:x,schemaId:C}=this.opts;return this.opts.defaultMeta=typeof x=="object"?x[C]||x:void 0}validate(x,C){let A;if(typeof x=="string"){if(A=this.getSchema(x),!A)throw new Error(`no schema with key or ref "${x}"`)}else A=this.compile(x);const y=A(C);return"$async"in A||(this.errors=A.errors),y}compile(x,C){const A=this._addSchema(x,C);return A.validate||this._compileSchemaEnv(A)}compileAsync(x,C){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");const{loadSchema:A}=this.opts;return y.call(this,x,C);async function y(Y,S){await T.call(this,Y.$schema);const k=this._addSchema(Y,S);return k.validate||R.call(this,k)}async function T(Y){Y&&!this.getSchema(Y)&&await y.call(this,{$ref:Y},!0)}async function R(Y){try{return this._compileSchemaEnv(Y)}catch(S){if(!(S instanceof n.default))throw S;return F.call(this,S),await B.call(this,S.missingSchema),R.call(this,Y)}}function F({missingSchema:Y,missingRef:S}){if(this.refs[Y])throw new Error(`AnySchema ${Y} is loaded but ${S} cannot be resolved`)}async function B(Y){const S=await X.call(this,Y);this.refs[Y]||await T.call(this,S.$schema),this.refs[Y]||this.addSchema(S,Y,C)}async function X(Y){const S=this._loading[Y];if(S)return S;try{return await(this._loading[Y]=A(Y))}finally{delete this._loading[Y]}}}addSchema(x,C,A,y=this.opts.validateSchema){if(Array.isArray(x)){for(const R of x)this.addSchema(R,void 0,A,y);return this}let T;if(typeof x=="object"){const{schemaId:R}=this.opts;if(T=x[R],T!==void 0&&typeof T!="string")throw new Error(`schema ${R} must be string`)}return C=(0,c.normalizeId)(C||T),this._checkUnique(C),this.schemas[C]=this._addSchema(x,A,C,y,!0),this}addMetaSchema(x,C,A=this.opts.validateSchema){return this.addSchema(x,C,!0,A),this}validateSchema(x,C){if(typeof x=="boolean")return!0;let A;if(A=x.$schema,A!==void 0&&typeof A!="string")throw new Error("$schema must be a string");if(A=A||this.opts.defaultMeta||this.defaultMeta(),!A)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const y=this.validate(A,x);if(!y&&C){const T="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(T);else throw new Error(T)}return y}getSchema(x){let C;for(;typeof(C=v.call(this,x))=="string";)x=C;if(C===void 0){const{schemaId:A}=this.opts,y=new s.SchemaEnv({schema:{},schemaId:A});if(C=s.resolveSchema.call(this,y,x),!C)return;this.refs[x]=C}return C.validate||this._compileSchemaEnv(C)}removeSchema(x){if(x instanceof RegExp)return this._removeAllSchemas(this.schemas,x),this._removeAllSchemas(this.refs,x),this;switch(typeof x){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const C=v.call(this,x);return typeof C=="object"&&this._cache.delete(C.schema),delete this.schemas[x],delete this.refs[x],this}case"object":{const C=x;this._cache.delete(C);let A=x[this.opts.schemaId];return A&&(A=(0,c.normalizeId)(A),delete this.schemas[A],delete this.refs[A]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(x){for(const C of x)this.addKeyword(C);return this}addKeyword(x,C){let A;if(typeof x=="string")A=x,typeof C=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),C.keyword=A);else if(typeof x=="object"&&C===void 0){if(C=x,A=C.keyword,Array.isArray(A)&&!A.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(H.call(this,A,C),!C)return(0,d.eachItem)(A,T=>ce.call(this,T)),this;ye.call(this,C);const y={...C,type:(0,u.getJSONTypes)(C.type),schemaType:(0,u.getJSONTypes)(C.schemaType)};return(0,d.eachItem)(A,y.type.length===0?T=>ce.call(this,T,y):T=>y.type.forEach(R=>ce.call(this,T,y,R))),this}getKeyword(x){const C=this.RULES.all[x];return typeof C=="object"?C.definition:!!C}removeKeyword(x){const{RULES:C}=this;delete C.keywords[x],delete C.all[x];for(const A of C.rules){const y=A.rules.findIndex(T=>T.keyword===x);y>=0&&A.rules.splice(y,1)}return this}addFormat(x,C){return typeof C=="string"&&(C=new RegExp(C)),this.formats[x]=C,this}errorsText(x=this.errors,{separator:C=", ",dataVar:A="data"}={}){return!x||x.length===0?"No errors":x.map(y=>`${A}${y.instancePath} ${y.message}`).reduce((y,T)=>y+C+T)}$dataMetaSchema(x,C){const A=this.RULES.all;x=JSON.parse(JSON.stringify(x));for(const y of C){const T=y.split("/").slice(1);let R=x;for(const F of T)R=R[F];for(const F in A){const B=A[F];if(typeof B!="object")continue;const{$data:X}=B.definition,Y=R[F];X&&Y&&(R[F]=V(Y))}}return x}_removeAllSchemas(x,C){for(const A in x){const y=x[A];(!C||C.test(A))&&(typeof y=="string"?delete x[A]:y&&!y.meta&&(this._cache.delete(y.schema),delete x[A]))}}_addSchema(x,C,A,y=this.opts.validateSchema,T=this.opts.addUsedSchema){let R;const{schemaId:F}=this.opts;if(typeof x=="object")R=x[F];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof x!="boolean")throw new Error("schema must be object or boolean")}let B=this._cache.get(x);if(B!==void 0)return B;A=(0,c.normalizeId)(R||A);const X=c.getSchemaRefs.call(this,x,A);return B=new s.SchemaEnv({schema:x,schemaId:F,meta:C,baseId:A,localRefs:X}),this._cache.set(B.schema,B),T&&!A.startsWith("#")&&(A&&this._checkUnique(A),this.refs[A]=B),y&&this.validateSchema(x,!0),B}_checkUnique(x){if(this.schemas[x]||this.refs[x])throw new Error(`schema with key or id "${x}" already exists`)}_compileSchemaEnv(x){if(x.meta?this._compileMetaSchema(x):s.compileSchema.call(this,x),!x.validate)throw new Error("ajv implementation error");return x.validate}_compileMetaSchema(x){const C=this.opts;this.opts=this._metaOpts;try{s.compileSchema.call(this,x)}finally{this.opts=C}}}m.ValidationError=r.default,m.MissingRefError=n.default,o.default=m;function b(I,x,C,A="error"){for(const y in I){const T=y;T in x&&this.logger[A](`${C}: option ${y}. ${I[T]}`)}}function v(I){return I=(0,c.normalizeId)(I),this.schemas[I]||this.refs[I]}function _(){const I=this.opts.schemas;if(I)if(Array.isArray(I))this.addSchema(I);else for(const x in I)this.addSchema(I[x],x)}function M(){for(const I in this.opts.formats){const x=this.opts.formats[I];x&&this.addFormat(I,x)}}function N(I){if(Array.isArray(I)){this.addVocabulary(I);return}this.logger.warn("keywords option as map is deprecated, pass array");for(const x in I){const C=I[x];C.keyword||(C.keyword=x),this.addKeyword(C)}}function q(){const I={...this.opts};for(const x of E)delete I[x];return I}const z={log(){},warn(){},error(){}};function G(I){if(I===!1)return z;if(I===void 0)return console;if(I.log&&I.warn&&I.error)return I;throw new Error("logger must implement log, warn and error methods")}const L=/^[a-z_$][a-z0-9_$:-]*$/i;function H(I,x){const{RULES:C}=this;if((0,d.eachItem)(I,A=>{if(C.keywords[A])throw new Error(`Keyword ${A} is already defined`);if(!L.test(A))throw new Error(`Keyword ${A} has invalid name`)}),!!x&&x.$data&&!("code"in x||"validate"in x))throw new Error('$data keyword must have "code" or "validate" function')}function ce(I,x,C){var A;const y=x?.post;if(C&&y)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:T}=this;let R=y?T.post:T.rules.find(({type:B})=>B===C);if(R||(R={type:C,rules:[]},T.rules.push(R)),T.keywords[I]=!0,!x)return;const F={keyword:I,definition:{...x,type:(0,u.getJSONTypes)(x.type),schemaType:(0,u.getJSONTypes)(x.schemaType)}};x.before?me.call(this,R,F,x.before):R.rules.push(F),T.all[I]=F,(A=x.implements)===null||A===void 0||A.forEach(B=>this.addKeyword(B))}function me(I,x,C){const A=I.rules.findIndex(y=>y.keyword===C);A>=0?I.rules.splice(A,0,x):(I.rules.push(x),this.logger.warn(`rule ${C} is not defined`))}function ye(I){let{metaSchema:x}=I;x!==void 0&&(I.$data&&this.opts.$data&&(x=V(x)),I.validateSchema=this.compile(x,!0))}const ee={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function V(I){return{anyOf:[I,ee]}}})(zt)),zt}var Ze={},et={},tt={},Fr;function ui(){if(Fr)return tt;Fr=1,Object.defineProperty(tt,"__esModule",{value:!0});const o={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};return tt.default=o,tt}var Ee={},Lr;function di(){if(Lr)return Ee;Lr=1,Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.callRef=Ee.getValidate=void 0;const o=Xe(),e=we(),t=W(),r=Se(),n=Ht(),i=Q(),s={keyword:"$ref",schemaType:"string",code(u){const{gen:d,schema:g,it:$}=u,{baseId:P,schemaEnv:E,validateName:w,opts:p,self:h}=$,{root:l}=E;if((g==="#"||g==="#/")&&P===l.baseId)return m();const f=n.resolveRef.call(h,l,P,g);if(f===void 0)throw new o.default($.opts.uriResolver,P,g);if(f instanceof n.SchemaEnv)return b(f);return v(f);function m(){if(E===l)return c(u,w,E,E.$async);const _=d.scopeValue("root",{ref:l});return c(u,(0,t._)`${_}.validate`,l,l.$async)}function b(_){const M=a(u,_);c(u,M,_,_.$async)}function v(_){const M=d.scopeValue("schema",p.code.source===!0?{ref:_,code:(0,t.stringify)(_)}:{ref:_}),N=d.name("valid"),q=u.subschema({schema:_,dataTypes:[],schemaPath:t.nil,topSchemaRef:M,errSchemaPath:g},N);u.mergeEvaluated(q),u.ok(N)}}};function a(u,d){const{gen:g}=u;return d.validate?g.scopeValue("validate",{ref:d.validate}):(0,t._)`${g.scopeValue("wrapper",{ref:d})}.validate`}Ee.getValidate=a;function c(u,d,g,$){const{gen:P,it:E}=u,{allErrors:w,schemaEnv:p,opts:h}=E,l=h.passContext?r.default.this:t.nil;$?f():m();function f(){if(!p.$async)throw new Error("async schema referenced by sync schema");const _=P.let("valid");P.try(()=>{P.code((0,t._)`await ${(0,e.callValidateCode)(u,d,l)}`),v(d),w||P.assign(_,!0)},M=>{P.if((0,t._)`!(${M} instanceof ${E.ValidationError})`,()=>P.throw(M)),b(M),w||P.assign(_,!1)}),u.ok(_)}function m(){u.result((0,e.callValidateCode)(u,d,l),()=>v(d),()=>b(d))}function b(_){const M=(0,t._)`${_}.errors`;P.assign(r.default.vErrors,(0,t._)`${r.default.vErrors} === null ? ${M} : ${r.default.vErrors}.concat(${M})`),P.assign(r.default.errors,(0,t._)`${r.default.vErrors}.length`)}function v(_){var M;if(!E.opts.unevaluated)return;const N=(M=g?.validate)===null||M===void 0?void 0:M.evaluated;if(E.props!==!0)if(N&&!N.dynamicProps)N.props!==void 0&&(E.props=i.mergeEvaluated.props(P,N.props,E.props));else{const q=P.var("props",(0,t._)`${_}.evaluated.props`);E.props=i.mergeEvaluated.props(P,q,E.props,t.Name)}if(E.items!==!0)if(N&&!N.dynamicItems)N.items!==void 0&&(E.items=i.mergeEvaluated.items(P,N.items,E.items));else{const q=P.var("items",(0,t._)`${_}.evaluated.items`);E.items=i.mergeEvaluated.items(P,q,E.items,t.Name)}}}return Ee.callRef=c,Ee.default=s,Ee}var Ur;function hi(){if(Ur)return et;Ur=1,Object.defineProperty(et,"__esModule",{value:!0});const o=ui(),e=di(),t=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",o.default,e.default];return et.default=t,et}var rt={},nt={},Gr;function fi(){if(Gr)return nt;Gr=1,Object.defineProperty(nt,"__esModule",{value:!0});const o=W(),e=o.operators,t={maximum:{okStr:"<=",ok:e.LTE,fail:e.GT},minimum:{okStr:">=",ok:e.GTE,fail:e.LT},exclusiveMaximum:{okStr:"<",ok:e.LT,fail:e.GTE},exclusiveMinimum:{okStr:">",ok:e.GT,fail:e.LTE}},r={message:({keyword:i,schemaCode:s})=>(0,o.str)`must be ${t[i].okStr} ${s}`,params:({keyword:i,schemaCode:s})=>(0,o._)`{comparison: ${t[i].okStr}, limit: ${s}}`},n={keyword:Object.keys(t),type:"number",schemaType:"number",$data:!0,error:r,code(i){const{keyword:s,data:a,schemaCode:c}=i;i.fail$data((0,o._)`${a} ${t[s].fail} ${c} || isNaN(${a})`)}};return nt.default=n,nt}var it={},Br;function pi(){if(Br)return it;Br=1,Object.defineProperty(it,"__esModule",{value:!0});const o=W(),t={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:{message:({schemaCode:r})=>(0,o.str)`must be multiple of ${r}`,params:({schemaCode:r})=>(0,o._)`{multipleOf: ${r}}`},code(r){const{gen:n,data:i,schemaCode:s,it:a}=r,c=a.opts.multipleOfPrecision,u=n.let("res"),d=c?(0,o._)`Math.abs(Math.round(${u}) - ${u}) > 1e-${c}`:(0,o._)`${u} !== parseInt(${u})`;r.fail$data((0,o._)`(${s} === 0 || (${u} = ${i}/${s}, ${d}))`)}};return it.default=t,it}var ot={},st={},Kr;function mi(){if(Kr)return st;Kr=1,Object.defineProperty(st,"__esModule",{value:!0});function o(e){const t=e.length;let r=0,n=0,i;for(;n<t;)r++,i=e.charCodeAt(n++),i>=55296&&i<=56319&&n<t&&(i=e.charCodeAt(n),(i&64512)===56320&&n++);return r}return st.default=o,o.code='require("ajv/dist/runtime/ucs2length").default',st}var Hr;function yi(){if(Hr)return ot;Hr=1,Object.defineProperty(ot,"__esModule",{value:!0});const o=W(),e=Q(),t=mi(),n={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:{message({keyword:i,schemaCode:s}){const a=i==="maxLength"?"more":"fewer";return(0,o.str)`must NOT have ${a} than ${s} characters`},params:({schemaCode:i})=>(0,o._)`{limit: ${i}}`},code(i){const{keyword:s,data:a,schemaCode:c,it:u}=i,d=s==="maxLength"?o.operators.GT:o.operators.LT,g=u.opts.unicode===!1?(0,o._)`${a}.length`:(0,o._)`${(0,e.useFunc)(i.gen,t.default)}(${a})`;i.fail$data((0,o._)`${g} ${d} ${c}`)}};return ot.default=n,ot}var at={},Jr;function gi(){if(Jr)return at;Jr=1,Object.defineProperty(at,"__esModule",{value:!0});const o=we(),e=W(),r={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:{message:({schemaCode:n})=>(0,e.str)`must match pattern "${n}"`,params:({schemaCode:n})=>(0,e._)`{pattern: ${n}}`},code(n){const{data:i,$data:s,schema:a,schemaCode:c,it:u}=n,d=u.opts.unicodeRegExp?"u":"",g=s?(0,e._)`(new RegExp(${c}, ${d}))`:(0,o.usePattern)(n,a);n.fail$data((0,e._)`!${g}.test(${i})`)}};return at.default=r,at}var ct={},Wr;function vi(){if(Wr)return ct;Wr=1,Object.defineProperty(ct,"__esModule",{value:!0});const o=W(),t={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:{message({keyword:r,schemaCode:n}){const i=r==="maxProperties"?"more":"fewer";return(0,o.str)`must NOT have ${i} than ${n} properties`},params:({schemaCode:r})=>(0,o._)`{limit: ${r}}`},code(r){const{keyword:n,data:i,schemaCode:s}=r,a=n==="maxProperties"?o.operators.GT:o.operators.LT;r.fail$data((0,o._)`Object.keys(${i}).length ${a} ${s}`)}};return ct.default=t,ct}var lt={},Yr;function bi(){if(Yr)return lt;Yr=1,Object.defineProperty(lt,"__esModule",{value:!0});const o=we(),e=W(),t=Q(),n={keyword:"required",type:"object",schemaType:"array",$data:!0,error:{message:({params:{missingProperty:i}})=>(0,e.str)`must have required property '${i}'`,params:({params:{missingProperty:i}})=>(0,e._)`{missingProperty: ${i}}`},code(i){const{gen:s,schema:a,schemaCode:c,data:u,$data:d,it:g}=i,{opts:$}=g;if(!d&&a.length===0)return;const P=a.length>=$.loopRequired;if(g.allErrors?E():w(),$.strictRequired){const l=i.parentSchema.properties,{definedProperties:f}=i.it;for(const m of a)if(l?.[m]===void 0&&!f.has(m)){const b=g.schemaEnv.baseId+g.errSchemaPath,v=`required property "${m}" is not defined at "${b}" (strictRequired)`;(0,t.checkStrictMode)(g,v,g.opts.strictRequired)}}function E(){if(P||d)i.block$data(e.nil,p);else for(const l of a)(0,o.checkReportMissingProp)(i,l)}function w(){const l=s.let("missing");if(P||d){const f=s.let("valid",!0);i.block$data(f,()=>h(l,f)),i.ok(f)}else s.if((0,o.checkMissingProp)(i,a,l)),(0,o.reportMissingProp)(i,l),s.else()}function p(){s.forOf("prop",c,l=>{i.setParams({missingProperty:l}),s.if((0,o.noPropertyInData)(s,u,l,$.ownProperties),()=>i.error())})}function h(l,f){i.setParams({missingProperty:l}),s.forOf(l,c,()=>{s.assign(f,(0,o.propertyInData)(s,u,l,$.ownProperties)),s.if((0,e.not)(f),()=>{i.error(),s.break()})},e.nil)}}};return lt.default=n,lt}var ut={},Xr;function wi(){if(Xr)return ut;Xr=1,Object.defineProperty(ut,"__esModule",{value:!0});const o=W(),t={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:{message({keyword:r,schemaCode:n}){const i=r==="maxItems"?"more":"fewer";return(0,o.str)`must NOT have ${i} than ${n} items`},params:({schemaCode:r})=>(0,o._)`{limit: ${r}}`},code(r){const{keyword:n,data:i,schemaCode:s}=r,a=n==="maxItems"?o.operators.GT:o.operators.LT;r.fail$data((0,o._)`${i}.length ${a} ${s}`)}};return ut.default=t,ut}var dt={},ht={},Qr;function Xt(){if(Qr)return ht;Qr=1,Object.defineProperty(ht,"__esModule",{value:!0});const o=kr();return o.code='require("ajv/dist/runtime/equal").default',ht.default=o,ht}var Zr;function $i(){if(Zr)return dt;Zr=1,Object.defineProperty(dt,"__esModule",{value:!0});const o=Ke(),e=W(),t=Q(),r=Xt(),i={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:{message:({params:{i:s,j:a}})=>(0,e.str)`must NOT have duplicate items (items ## ${a} and ${s} are identical)`,params:({params:{i:s,j:a}})=>(0,e._)`{i: ${s}, j: ${a}}`},code(s){const{gen:a,data:c,$data:u,schema:d,parentSchema:g,schemaCode:$,it:P}=s;if(!u&&!d)return;const E=a.let("valid"),w=g.items?(0,o.getSchemaTypes)(g.items):[];s.block$data(E,p,(0,e._)`${$} === false`),s.ok(E);function p(){const m=a.let("i",(0,e._)`${c}.length`),b=a.let("j");s.setParams({i:m,j:b}),a.assign(E,!0),a.if((0,e._)`${m} > 1`,()=>(h()?l:f)(m,b))}function h(){return w.length>0&&!w.some(m=>m==="object"||m==="array")}function l(m,b){const v=a.name("item"),_=(0,o.checkDataTypes)(w,v,P.opts.strictNumbers,o.DataType.Wrong),M=a.const("indices",(0,e._)`{}`);a.for((0,e._)`;${m}--;`,()=>{a.let(v,(0,e._)`${c}[${m}]`),a.if(_,(0,e._)`continue`),w.length>1&&a.if((0,e._)`typeof ${v} == "string"`,(0,e._)`${v} += "_"`),a.if((0,e._)`typeof ${M}[${v}] == "number"`,()=>{a.assign(b,(0,e._)`${M}[${v}]`),s.error(),a.assign(E,!1).break()}).code((0,e._)`${M}[${v}] = ${m}`)})}function f(m,b){const v=(0,t.useFunc)(a,r.default),_=a.name("outer");a.label(_).for((0,e._)`;${m}--;`,()=>a.for((0,e._)`${b} = ${m}; ${b}--;`,()=>a.if((0,e._)`${v}(${c}[${m}], ${c}[${b}])`,()=>{s.error(),a.assign(E,!1).break(_)})))}}};return dt.default=i,dt}var ft={},en;function _i(){if(en)return ft;en=1,Object.defineProperty(ft,"__esModule",{value:!0});const o=W(),e=Q(),t=Xt(),n={keyword:"const",$data:!0,error:{message:"must be equal to constant",params:({schemaCode:i})=>(0,o._)`{allowedValue: ${i}}`},code(i){const{gen:s,data:a,$data:c,schemaCode:u,schema:d}=i;c||d&&typeof d=="object"?i.fail$data((0,o._)`!${(0,e.useFunc)(s,t.default)}(${a}, ${u})`):i.fail((0,o._)`${d} !== ${a}`)}};return ft.default=n,ft}var pt={},tn;function Pi(){if(tn)return pt;tn=1,Object.defineProperty(pt,"__esModule",{value:!0});const o=W(),e=Q(),t=Xt(),n={keyword:"enum",schemaType:"array",$data:!0,error:{message:"must be equal to one of the allowed values",params:({schemaCode:i})=>(0,o._)`{allowedValues: ${i}}`},code(i){const{gen:s,data:a,$data:c,schema:u,schemaCode:d,it:g}=i;if(!c&&u.length===0)throw new Error("enum must have non-empty array");const $=u.length>=g.opts.loopEnum;let P;const E=()=>P??(P=(0,e.useFunc)(s,t.default));let w;if($||c)w=s.let("valid"),i.block$data(w,p);else{if(!Array.isArray(u))throw new Error("ajv implementation error");const l=s.const("vSchema",d);w=(0,o.or)(...u.map((f,m)=>h(l,m)))}i.pass(w);function p(){s.assign(w,!1),s.forOf("v",d,l=>s.if((0,o._)`${E()}(${a}, ${l})`,()=>s.assign(w,!0).break()))}function h(l,f){const m=u[f];return typeof m=="object"&&m!==null?(0,o._)`${E()}(${a}, ${l}[${f}])`:(0,o._)`${a} === ${m}`}}};return pt.default=n,pt}var rn;function Si(){if(rn)return rt;rn=1,Object.defineProperty(rt,"__esModule",{value:!0});const o=fi(),e=pi(),t=yi(),r=gi(),n=vi(),i=bi(),s=wi(),a=$i(),c=_i(),u=Pi(),d=[o.default,e.default,t.default,r.default,n.default,i.default,s.default,a.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},c.default,u.default];return rt.default=d,rt}var mt={},Ne={},nn;function on(){if(nn)return Ne;nn=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.validateAdditionalItems=void 0;const o=W(),e=Q(),r={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:{message:({params:{len:i}})=>(0,o.str)`must NOT have more than ${i} items`,params:({params:{len:i}})=>(0,o._)`{limit: ${i}}`},code(i){const{parentSchema:s,it:a}=i,{items:c}=s;if(!Array.isArray(c)){(0,e.checkStrictMode)(a,'"additionalItems" is ignored when "items" is not an array of schemas');return}n(i,c)}};function n(i,s){const{gen:a,schema:c,data:u,keyword:d,it:g}=i;g.items=!0;const $=a.const("len",(0,o._)`${u}.length`);if(c===!1)i.setParams({len:s.length}),i.pass((0,o._)`${$} <= ${s.length}`);else if(typeof c=="object"&&!(0,e.alwaysValidSchema)(g,c)){const E=a.var("valid",(0,o._)`${$} <= ${s.length}`);a.if((0,o.not)(E),()=>P(E)),i.ok(E)}function P(E){a.forRange("i",s.length,$,w=>{i.subschema({keyword:d,dataProp:w,dataPropType:e.Type.Num},E),g.allErrors||a.if((0,o.not)(E),()=>a.break())})}}return Ne.validateAdditionalItems=n,Ne.default=r,Ne}var yt={},Re={},sn;function an(){if(sn)return Re;sn=1,Object.defineProperty(Re,"__esModule",{value:!0}),Re.validateTuple=void 0;const o=W(),e=Q(),t=we(),r={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(i){const{schema:s,it:a}=i;if(Array.isArray(s))return n(i,"additionalItems",s);a.items=!0,!(0,e.alwaysValidSchema)(a,s)&&i.ok((0,t.validateArray)(i))}};function n(i,s,a=i.schema){const{gen:c,parentSchema:u,data:d,keyword:g,it:$}=i;w(u),$.opts.unevaluated&&a.length&&$.items!==!0&&($.items=e.mergeEvaluated.items(c,a.length,$.items));const P=c.name("valid"),E=c.const("len",(0,o._)`${d}.length`);a.forEach((p,h)=>{(0,e.alwaysValidSchema)($,p)||(c.if((0,o._)`${E} > ${h}`,()=>i.subschema({keyword:g,schemaProp:h,dataProp:h},P)),i.ok(P))});function w(p){const{opts:h,errSchemaPath:l}=$,f=a.length,m=f===p.minItems&&(f===p.maxItems||p[s]===!1);if(h.strictTuples&&!m){const b=`"${g}" is ${f}-tuple, but minItems or maxItems/${s} are not specified or different at path "${l}"`;(0,e.checkStrictMode)($,b,h.strictTuples)}}}return Re.validateTuple=n,Re.default=r,Re}var cn;function Ei(){if(cn)return yt;cn=1,Object.defineProperty(yt,"__esModule",{value:!0});const o=an(),e={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,o.validateTuple)(t,"items")};return yt.default=e,yt}var gt={},ln;function Ti(){if(ln)return gt;ln=1,Object.defineProperty(gt,"__esModule",{value:!0});const o=W(),e=Q(),t=we(),r=on(),i={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:{message:({params:{len:s}})=>(0,o.str)`must NOT have more than ${s} items`,params:({params:{len:s}})=>(0,o._)`{limit: ${s}}`},code(s){const{schema:a,parentSchema:c,it:u}=s,{prefixItems:d}=c;u.items=!0,!(0,e.alwaysValidSchema)(u,a)&&(d?(0,r.validateAdditionalItems)(s,d):s.ok((0,t.validateArray)(s)))}};return gt.default=i,gt}var vt={},un;function Mi(){if(un)return vt;un=1,Object.defineProperty(vt,"__esModule",{value:!0});const o=W(),e=Q(),r={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:{message:({params:{min:n,max:i}})=>i===void 0?(0,o.str)`must contain at least ${n} valid item(s)`:(0,o.str)`must contain at least ${n} and no more than ${i} valid item(s)`,params:({params:{min:n,max:i}})=>i===void 0?(0,o._)`{minContains: ${n}}`:(0,o._)`{minContains: ${n}, maxContains: ${i}}`},code(n){const{gen:i,schema:s,parentSchema:a,data:c,it:u}=n;let d,g;const{minContains:$,maxContains:P}=a;u.opts.next?(d=$===void 0?1:$,g=P):d=1;const E=i.const("len",(0,o._)`${c}.length`);if(n.setParams({min:d,max:g}),g===void 0&&d===0){(0,e.checkStrictMode)(u,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(g!==void 0&&d>g){(0,e.checkStrictMode)(u,'"minContains" > "maxContains" is always invalid'),n.fail();return}if((0,e.alwaysValidSchema)(u,s)){let f=(0,o._)`${E} >= ${d}`;g!==void 0&&(f=(0,o._)`${f} && ${E} <= ${g}`),n.pass(f);return}u.items=!0;const w=i.name("valid");g===void 0&&d===1?h(w,()=>i.if(w,()=>i.break())):d===0?(i.let(w,!0),g!==void 0&&i.if((0,o._)`${c}.length > 0`,p)):(i.let(w,!1),p()),n.result(w,()=>n.reset());function p(){const f=i.name("_valid"),m=i.let("count",0);h(f,()=>i.if(f,()=>l(m)))}function h(f,m){i.forRange("i",0,E,b=>{n.subschema({keyword:"contains",dataProp:b,dataPropType:e.Type.Num,compositeRule:!0},f),m()})}function l(f){i.code((0,o._)`${f}++`),g===void 0?i.if((0,o._)`${f} >= ${d}`,()=>i.assign(w,!0).break()):(i.if((0,o._)`${f} > ${g}`,()=>i.assign(w,!1).break()),d===1?i.assign(w,!0):i.if((0,o._)`${f} >= ${d}`,()=>i.assign(w,!0)))}}};return vt.default=r,vt}var Qt={},dn;function ki(){return dn||(dn=1,(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.validateSchemaDeps=o.validatePropertyDeps=o.error=void 0;const e=W(),t=Q(),r=we();o.error={message:({params:{property:c,depsCount:u,deps:d}})=>{const g=u===1?"property":"properties";return(0,e.str)`must have ${g} ${d} when property ${c} is present`},params:({params:{property:c,depsCount:u,deps:d,missingProperty:g}})=>(0,e._)`{property: ${c},
    missingProperty: ${g},
    depsCount: ${u},
    deps: ${d}}`};const n={keyword:"dependencies",type:"object",schemaType:"object",error:o.error,code(c){const[u,d]=i(c);s(c,u),a(c,d)}};function i({schema:c}){const u={},d={};for(const g in c){if(g==="__proto__")continue;const $=Array.isArray(c[g])?u:d;$[g]=c[g]}return[u,d]}function s(c,u=c.schema){const{gen:d,data:g,it:$}=c;if(Object.keys(u).length===0)return;const P=d.let("missing");for(const E in u){const w=u[E];if(w.length===0)continue;const p=(0,r.propertyInData)(d,g,E,$.opts.ownProperties);c.setParams({property:E,depsCount:w.length,deps:w.join(", ")}),$.allErrors?d.if(p,()=>{for(const h of w)(0,r.checkReportMissingProp)(c,h)}):(d.if((0,e._)`${p} && (${(0,r.checkMissingProp)(c,w,P)})`),(0,r.reportMissingProp)(c,P),d.else())}}o.validatePropertyDeps=s;function a(c,u=c.schema){const{gen:d,data:g,keyword:$,it:P}=c,E=d.name("valid");for(const w in u)(0,t.alwaysValidSchema)(P,u[w])||(d.if((0,r.propertyInData)(d,g,w,P.opts.ownProperties),()=>{const p=c.subschema({keyword:$,schemaProp:w},E);c.mergeValidEvaluated(p,E)},()=>d.var(E,!0)),c.ok(E))}o.validateSchemaDeps=a,o.default=n})(Qt)),Qt}var bt={},hn;function xi(){if(hn)return bt;hn=1,Object.defineProperty(bt,"__esModule",{value:!0});const o=W(),e=Q(),r={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:{message:"property name must be valid",params:({params:n})=>(0,o._)`{propertyName: ${n.propertyName}}`},code(n){const{gen:i,schema:s,data:a,it:c}=n;if((0,e.alwaysValidSchema)(c,s))return;const u=i.name("valid");i.forIn("key",a,d=>{n.setParams({propertyName:d}),n.subschema({keyword:"propertyNames",data:d,dataTypes:["string"],propertyName:d,compositeRule:!0},u),i.if((0,o.not)(u),()=>{n.error(!0),c.allErrors||i.break()})}),n.ok(u)}};return bt.default=r,bt}var wt={},fn;function pn(){if(fn)return wt;fn=1,Object.defineProperty(wt,"__esModule",{value:!0});const o=we(),e=W(),t=Se(),r=Q(),i={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:{message:"must NOT have additional properties",params:({params:s})=>(0,e._)`{additionalProperty: ${s.additionalProperty}}`},code(s){const{gen:a,schema:c,parentSchema:u,data:d,errsCount:g,it:$}=s;if(!g)throw new Error("ajv implementation error");const{allErrors:P,opts:E}=$;if($.props=!0,E.removeAdditional!=="all"&&(0,r.alwaysValidSchema)($,c))return;const w=(0,o.allSchemaProperties)(u.properties),p=(0,o.allSchemaProperties)(u.patternProperties);h(),s.ok((0,e._)`${g} === ${t.default.errors}`);function h(){a.forIn("key",d,v=>{!w.length&&!p.length?m(v):a.if(l(v),()=>m(v))})}function l(v){let _;if(w.length>8){const M=(0,r.schemaRefOrVal)($,u.properties,"properties");_=(0,o.isOwnProperty)(a,M,v)}else w.length?_=(0,e.or)(...w.map(M=>(0,e._)`${v} === ${M}`)):_=e.nil;return p.length&&(_=(0,e.or)(_,...p.map(M=>(0,e._)`${(0,o.usePattern)(s,M)}.test(${v})`))),(0,e.not)(_)}function f(v){a.code((0,e._)`delete ${d}[${v}]`)}function m(v){if(E.removeAdditional==="all"||E.removeAdditional&&c===!1){f(v);return}if(c===!1){s.setParams({additionalProperty:v}),s.error(),P||a.break();return}if(typeof c=="object"&&!(0,r.alwaysValidSchema)($,c)){const _=a.name("valid");E.removeAdditional==="failing"?(b(v,_,!1),a.if((0,e.not)(_),()=>{s.reset(),f(v)})):(b(v,_),P||a.if((0,e.not)(_),()=>a.break()))}}function b(v,_,M){const N={keyword:"additionalProperties",dataProp:v,dataPropType:r.Type.Str};M===!1&&Object.assign(N,{compositeRule:!0,createErrors:!1,allErrors:!1}),s.subschema(N,_)}}};return wt.default=i,wt}var $t={},mn;function Ai(){if(mn)return $t;mn=1,Object.defineProperty($t,"__esModule",{value:!0});const o=Je(),e=we(),t=Q(),r=pn(),n={keyword:"properties",type:"object",schemaType:"object",code(i){const{gen:s,schema:a,parentSchema:c,data:u,it:d}=i;d.opts.removeAdditional==="all"&&c.additionalProperties===void 0&&r.default.code(new o.KeywordCxt(d,r.default,"additionalProperties"));const g=(0,e.allSchemaProperties)(a);for(const p of g)d.definedProperties.add(p);d.opts.unevaluated&&g.length&&d.props!==!0&&(d.props=t.mergeEvaluated.props(s,(0,t.toHash)(g),d.props));const $=g.filter(p=>!(0,t.alwaysValidSchema)(d,a[p]));if($.length===0)return;const P=s.name("valid");for(const p of $)E(p)?w(p):(s.if((0,e.propertyInData)(s,u,p,d.opts.ownProperties)),w(p),d.allErrors||s.else().var(P,!0),s.endIf()),i.it.definedProperties.add(p),i.ok(P);function E(p){return d.opts.useDefaults&&!d.compositeRule&&a[p].default!==void 0}function w(p){i.subschema({keyword:"properties",schemaProp:p,dataProp:p},P)}}};return $t.default=n,$t}var _t={},yn;function Ni(){if(yn)return _t;yn=1,Object.defineProperty(_t,"__esModule",{value:!0});const o=we(),e=W(),t=Q(),r=Q(),n={keyword:"patternProperties",type:"object",schemaType:"object",code(i){const{gen:s,schema:a,data:c,parentSchema:u,it:d}=i,{opts:g}=d,$=(0,o.allSchemaProperties)(a),P=$.filter(m=>(0,t.alwaysValidSchema)(d,a[m]));if($.length===0||P.length===$.length&&(!d.opts.unevaluated||d.props===!0))return;const E=g.strictSchema&&!g.allowMatchingProperties&&u.properties,w=s.name("valid");d.props!==!0&&!(d.props instanceof e.Name)&&(d.props=(0,r.evaluatedPropsToName)(s,d.props));const{props:p}=d;h();function h(){for(const m of $)E&&l(m),d.allErrors?f(m):(s.var(w,!0),f(m),s.if(w))}function l(m){for(const b in E)new RegExp(m).test(b)&&(0,t.checkStrictMode)(d,`property ${b} matches pattern ${m} (use allowMatchingProperties)`)}function f(m){s.forIn("key",c,b=>{s.if((0,e._)`${(0,o.usePattern)(i,m)}.test(${b})`,()=>{const v=P.includes(m);v||i.subschema({keyword:"patternProperties",schemaProp:m,dataProp:b,dataPropType:r.Type.Str},w),d.opts.unevaluated&&p!==!0?s.assign((0,e._)`${p}[${b}]`,!0):!v&&!d.allErrors&&s.if((0,e.not)(w),()=>s.break())})})}}};return _t.default=n,_t}var Pt={},gn;function Ri(){if(gn)return Pt;gn=1,Object.defineProperty(Pt,"__esModule",{value:!0});const o=Q(),e={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){const{gen:r,schema:n,it:i}=t;if((0,o.alwaysValidSchema)(i,n)){t.fail();return}const s=r.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},s),t.failResult(s,()=>t.reset(),()=>t.error())},error:{message:"must NOT be valid"}};return Pt.default=e,Pt}var St={},vn;function ji(){if(vn)return St;vn=1,Object.defineProperty(St,"__esModule",{value:!0});const e={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:we().validateUnion,error:{message:"must match a schema in anyOf"}};return St.default=e,St}var Et={},bn;function Ci(){if(bn)return Et;bn=1,Object.defineProperty(Et,"__esModule",{value:!0});const o=W(),e=Q(),r={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:{message:"must match exactly one schema in oneOf",params:({params:n})=>(0,o._)`{passingSchemas: ${n.passing}}`},code(n){const{gen:i,schema:s,parentSchema:a,it:c}=n;if(!Array.isArray(s))throw new Error("ajv implementation error");if(c.opts.discriminator&&a.discriminator)return;const u=s,d=i.let("valid",!1),g=i.let("passing",null),$=i.name("_valid");n.setParams({passing:g}),i.block(P),n.result(d,()=>n.reset(),()=>n.error(!0));function P(){u.forEach((E,w)=>{let p;(0,e.alwaysValidSchema)(c,E)?i.var($,!0):p=n.subschema({keyword:"oneOf",schemaProp:w,compositeRule:!0},$),w>0&&i.if((0,o._)`${$} && ${d}`).assign(d,!1).assign(g,(0,o._)`[${g}, ${w}]`).else(),i.if($,()=>{i.assign(d,!0),i.assign(g,w),p&&n.mergeEvaluated(p,o.Name)})})}}};return Et.default=r,Et}var Tt={},wn;function Oi(){if(wn)return Tt;wn=1,Object.defineProperty(Tt,"__esModule",{value:!0});const o=Q(),e={keyword:"allOf",schemaType:"array",code(t){const{gen:r,schema:n,it:i}=t;if(!Array.isArray(n))throw new Error("ajv implementation error");const s=r.name("valid");n.forEach((a,c)=>{if((0,o.alwaysValidSchema)(i,a))return;const u=t.subschema({keyword:"allOf",schemaProp:c},s);t.ok(s),t.mergeEvaluated(u)})}};return Tt.default=e,Tt}var Mt={},$n;function Ii(){if($n)return Mt;$n=1,Object.defineProperty(Mt,"__esModule",{value:!0});const o=W(),e=Q(),r={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:{message:({params:i})=>(0,o.str)`must match "${i.ifClause}" schema`,params:({params:i})=>(0,o._)`{failingKeyword: ${i.ifClause}}`},code(i){const{gen:s,parentSchema:a,it:c}=i;a.then===void 0&&a.else===void 0&&(0,e.checkStrictMode)(c,'"if" without "then" and "else" is ignored');const u=n(c,"then"),d=n(c,"else");if(!u&&!d)return;const g=s.let("valid",!0),$=s.name("_valid");if(P(),i.reset(),u&&d){const w=s.let("ifClause");i.setParams({ifClause:w}),s.if($,E("then",w),E("else",w))}else u?s.if($,E("then")):s.if((0,o.not)($),E("else"));i.pass(g,()=>i.error(!0));function P(){const w=i.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},$);i.mergeEvaluated(w)}function E(w,p){return()=>{const h=i.subschema({keyword:w},$);s.assign(g,$),i.mergeValidEvaluated(h,g),p?s.assign(p,(0,o._)`${w}`):i.setParams({ifClause:w})}}}};function n(i,s){const a=i.schema[s];return a!==void 0&&!(0,e.alwaysValidSchema)(i,a)}return Mt.default=r,Mt}var kt={},_n;function qi(){if(_n)return kt;_n=1,Object.defineProperty(kt,"__esModule",{value:!0});const o=Q(),e={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:r,it:n}){r.if===void 0&&(0,o.checkStrictMode)(n,`"${t}" without "if" is ignored`)}};return kt.default=e,kt}var Pn;function Di(){if(Pn)return mt;Pn=1,Object.defineProperty(mt,"__esModule",{value:!0});const o=on(),e=Ei(),t=an(),r=Ti(),n=Mi(),i=ki(),s=xi(),a=pn(),c=Ai(),u=Ni(),d=Ri(),g=ji(),$=Ci(),P=Oi(),E=Ii(),w=qi();function p(h=!1){const l=[d.default,g.default,$.default,P.default,E.default,w.default,s.default,a.default,i.default,c.default,u.default];return h?l.push(e.default,r.default):l.push(o.default,t.default),l.push(n.default),l}return mt.default=p,mt}var xt={},At={},Sn;function zi(){if(Sn)return At;Sn=1,Object.defineProperty(At,"__esModule",{value:!0});const o=W(),t={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:{message:({schemaCode:r})=>(0,o.str)`must match format "${r}"`,params:({schemaCode:r})=>(0,o._)`{format: ${r}}`},code(r,n){const{gen:i,data:s,$data:a,schema:c,schemaCode:u,it:d}=r,{opts:g,errSchemaPath:$,schemaEnv:P,self:E}=d;if(!g.validateFormats)return;a?w():p();function w(){const h=i.scopeValue("formats",{ref:E.formats,code:g.code.formats}),l=i.const("fDef",(0,o._)`${h}[${u}]`),f=i.let("fType"),m=i.let("format");i.if((0,o._)`typeof ${l} == "object" && !(${l} instanceof RegExp)`,()=>i.assign(f,(0,o._)`${l}.type || "string"`).assign(m,(0,o._)`${l}.validate`),()=>i.assign(f,(0,o._)`"string"`).assign(m,l)),r.fail$data((0,o.or)(b(),v()));function b(){return g.strictSchema===!1?o.nil:(0,o._)`${u} && !${m}`}function v(){const _=P.$async?(0,o._)`(${l}.async ? await ${m}(${s}) : ${m}(${s}))`:(0,o._)`${m}(${s})`,M=(0,o._)`(typeof ${m} == "function" ? ${_} : ${m}.test(${s}))`;return(0,o._)`${m} && ${m} !== true && ${f} === ${n} && !${M}`}}function p(){const h=E.formats[c];if(!h){b();return}if(h===!0)return;const[l,f,m]=v(h);l===n&&r.pass(_());function b(){if(g.strictSchema===!1){E.logger.warn(M());return}throw new Error(M());function M(){return`unknown format "${c}" ignored in schema at path "${$}"`}}function v(M){const N=M instanceof RegExp?(0,o.regexpCode)(M):g.code.formats?(0,o._)`${g.code.formats}${(0,o.getProperty)(c)}`:void 0,q=i.scopeValue("formats",{key:c,ref:M,code:N});return typeof M=="object"&&!(M instanceof RegExp)?[M.type||"string",M.validate,(0,o._)`${q}.validate`]:["string",M,q]}function _(){if(typeof h=="object"&&!(h instanceof RegExp)&&h.async){if(!P.$async)throw new Error("async format in sync schema");return(0,o._)`await ${m}(${s})`}return typeof f=="function"?(0,o._)`${m}(${s})`:(0,o._)`${m}.test(${s})`}}}};return At.default=t,At}var En;function Vi(){if(En)return xt;En=1,Object.defineProperty(xt,"__esModule",{value:!0});const e=[zi().default];return xt.default=e,xt}var Ae={},Tn;function Fi(){return Tn||(Tn=1,Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.contentVocabulary=Ae.metadataVocabulary=void 0,Ae.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"],Ae.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]),Ae}var Mn;function Li(){if(Mn)return Ze;Mn=1,Object.defineProperty(Ze,"__esModule",{value:!0});const o=hi(),e=Si(),t=Di(),r=Vi(),n=Fi(),i=[o.default,e.default,(0,t.default)(),r.default,n.metadataVocabulary,n.contentVocabulary];return Ze.default=i,Ze}var Nt={},qe={},kn;function Ui(){if(kn)return qe;kn=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.DiscrError=void 0;var o;return(function(e){e.Tag="tag",e.Mapping="mapping"})(o||(qe.DiscrError=o={})),qe}var xn;function Gi(){if(xn)return Nt;xn=1,Object.defineProperty(Nt,"__esModule",{value:!0});const o=W(),e=Ui(),t=Ht(),r=Xe(),n=Q(),s={keyword:"discriminator",type:"object",schemaType:"object",error:{message:({params:{discrError:a,tagName:c}})=>a===e.DiscrError.Tag?`tag "${c}" must be string`:`value of tag "${c}" must be in oneOf`,params:({params:{discrError:a,tag:c,tagName:u}})=>(0,o._)`{error: ${a}, tag: ${u}, tagValue: ${c}}`},code(a){const{gen:c,data:u,schema:d,parentSchema:g,it:$}=a,{oneOf:P}=g;if(!$.opts.discriminator)throw new Error("discriminator: requires discriminator option");const E=d.propertyName;if(typeof E!="string")throw new Error("discriminator: requires propertyName");if(d.mapping)throw new Error("discriminator: mapping is not supported");if(!P)throw new Error("discriminator: requires oneOf keyword");const w=c.let("valid",!1),p=c.const("tag",(0,o._)`${u}${(0,o.getProperty)(E)}`);c.if((0,o._)`typeof ${p} == "string"`,()=>h(),()=>a.error(!1,{discrError:e.DiscrError.Tag,tag:p,tagName:E})),a.ok(w);function h(){const m=f();c.if(!1);for(const b in m)c.elseIf((0,o._)`${p} === ${b}`),c.assign(w,l(m[b]));c.else(),a.error(!1,{discrError:e.DiscrError.Mapping,tag:p,tagName:E}),c.endIf()}function l(m){const b=c.name("valid"),v=a.subschema({keyword:"oneOf",schemaProp:m},b);return a.mergeEvaluated(v,o.Name),b}function f(){var m;const b={},v=M(g);let _=!0;for(let z=0;z<P.length;z++){let G=P[z];if(G?.$ref&&!(0,n.schemaHasRulesButRef)(G,$.self.RULES)){const H=G.$ref;if(G=t.resolveRef.call($.self,$.schemaEnv.root,$.baseId,H),G instanceof t.SchemaEnv&&(G=G.schema),G===void 0)throw new r.default($.opts.uriResolver,$.baseId,H)}const L=(m=G?.properties)===null||m===void 0?void 0:m[E];if(typeof L!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${E}"`);_=_&&(v||M(G)),N(L,z)}if(!_)throw new Error(`discriminator: "${E}" must be required`);return b;function M({required:z}){return Array.isArray(z)&&z.includes(E)}function N(z,G){if(z.const)q(z.const,G);else if(z.enum)for(const L of z.enum)q(L,G);else throw new Error(`discriminator: "properties/${E}" must have "const" or "enum"`)}function q(z,G){if(typeof z!="string"||z in b)throw new Error(`discriminator: "${E}" values must be unique strings`);b[z]=G}}}};return Nt.default=s,Nt}const Bi={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0};var An;function Ki(){return An||(An=1,(function(o,e){Object.defineProperty(e,"__esModule",{value:!0}),e.MissingRefError=e.ValidationError=e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=e.Ajv=void 0;const t=li(),r=Li(),n=Gi(),i=Bi,s=["/properties"],a="http://json-schema.org/draft-07/schema";class c extends t.default{_addVocabularies(){super._addVocabularies(),r.default.forEach(E=>this.addVocabulary(E)),this.opts.discriminator&&this.addKeyword(n.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const E=this.opts.$data?this.$dataMetaSchema(i,s):i;this.addMetaSchema(E,a,!1),this.refs["http://json-schema.org/schema"]=a}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(a)?a:void 0)}}e.Ajv=c,o.exports=e=c,o.exports.Ajv=c,Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var u=Je();Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return u.KeywordCxt}});var d=W();Object.defineProperty(e,"_",{enumerable:!0,get:function(){return d._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return d.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return d.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return d.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return d.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return d.CodeGen}});var g=Kt();Object.defineProperty(e,"ValidationError",{enumerable:!0,get:function(){return g.default}});var $=Xe();Object.defineProperty(e,"MissingRefError",{enumerable:!0,get:function(){return $.default}})})(Le,Le.exports)),Le.exports}var Hi=Ki();const Ji=Ce(Hi),Wi={$schema:"http://json-schema.org/draft-07/schema#",title:"JMON Composition (Multi-Track, Extended)",description:"A declarative music format supporting synthesis, MIDI, score notation, key changes, arbitrary metadata, annotations, and custom presets. Time values should use the bars:beats:ticks format (e.g., '2:1:240') for precise musical timing. This format is independent of BPM and follows professional DAW standards.",type:"object",required:["format","version","bpm","tracks"],properties:JSON.parse(`{"format":{"type":"string","const":"jmon","description":"The format identifier for the JMON schema."},"version":{"type":"string","description":"JMON schema version."},"bpm":{"type":"number","minimum":20,"maximum":400,"description":"Tempo in beats per minute."},"keySignature":{"type":"string","pattern":"^[A-G](#|b)?m?$","description":"Key signature (e.g., 'C', 'Am', 'F#')."},"keySignatureMap":{"type":"array","description":"Map of key signature changes over time.","items":{"type":"object","required":["time","keySignature"],"properties":{"time":{"oneOf":[{"type":"string","pattern":"^\\\\d+:\\\\d+(\\\\.\\\\d+)?:\\\\d+$","description":"Musical time in bars:beats:ticks format (e.g., '2:0:0')."},{"type":"number","description":"Legacy: Time in beats (deprecated)."}],"description":"Time of the key signature change."},"keySignature":{"type":"string","pattern":"^[A-G](#|b)?m?$","description":"New key signature at this time."}},"additionalProperties":false}},"timeSignature":{"type":"string","pattern":"^\\\\d+/\\\\d+$","description":"Time signature for the composition (e.g., '4/4')."},"tempoMap":{"type":"array","description":"Map of tempo changes over time.","items":{"type":"object","required":["time","bpm"],"properties":{"time":{"oneOf":[{"type":"string","pattern":"^\\\\d+:\\\\d+(\\\\.\\\\d+)?:\\\\d+$","description":"Musical time in bars:beats:ticks format (e.g., '4:0:0')."},{"type":"number","description":"Legacy: Time in beats (deprecated)."}],"description":"The time point for the tempo change."},"bpm":{"type":"number","minimum":20,"maximum":400,"description":"Tempo in beats per minute at this time point."}},"additionalProperties":false}},"transport":{"type":"object","description":"Settings controlling global playback and looping.","properties":{"startOffset":{"oneOf":[{"type":"string","pattern":"^\\\\d+:\\\\d+(\\\\.\\\\d+)?:\\\\d+$","description":"Musical time in bars:beats:ticks format (e.g., '0:2:0')."},{"type":"number","description":"Legacy: Time in beats (deprecated)."}],"description":"Offset for when playback should start."},"globalLoop":{"type":"boolean","description":"Whether the entire project should loop."},"globalLoopEnd":{"type":"string","pattern":"^\\\\d+:\\\\d+(\\\\.\\\\d+)?:\\\\d+$","description":"Musical time in bars:beats:ticks format where the global loop should end (e.g., '8:0:0')."},"swing":{"type":"number","minimum":0,"maximum":1,"description":"Swing amount (0-1)."}},"additionalProperties":false},"metadata":{"type":"object","description":"Metadata for the composition, allowing arbitrary fields.","properties":{"name":{"type":"string","description":"Name of the composition."},"author":{"type":"string","description":"Author or composer."},"description":{"type":"string","description":"Description of the composition."}},"additionalProperties":true},"customPresets":{"type":"array","description":"Array of custom user-defined presets for synths or effects.","items":{"type":"object","required":["id","type","options"],"properties":{"id":{"type":"string","description":"Unique identifier for this preset."},"type":{"type":"string","description":"Type of preset (e.g., 'Synth', 'Effect', 'Sampler')."},"options":{"type":"object","description":"Preset options."}},"additionalProperties":false}},"audioGraph":{"type":"array","description":"Audio node graph for synthesis. If not provided, a default synth->master setup will be created automatically.","default":[{"id":"synth","type":"Synth","options":{}},{"id":"master","type":"Destination","options":{}}],"items":{"type":"object","required":["id","type","options"],"properties":{"id":{"type":"string","description":"Unique identifier for this node."},"type":{"type":"string","enum":["Synth","PolySynth","MonoSynth","AMSynth","FMSynth","DuoSynth","PluckSynth","NoiseSynth","Sampler","Filter","AutoFilter","Reverb","FeedbackDelay","PingPongDelay","Delay","Chorus","Phaser","Tremolo","Vibrato","AutoWah","Distortion","Chebyshev","BitCrusher","Compressor","Limiter","Gate","FrequencyShifter","PitchShift","JCReverb","Freeverb","StereoWidener","MidSideCompressor","Destination"],"description":"Type of audio node (Synth, Sampler, Effect, etc.)."},"options":{"type":"object","description":"Options for this node. Content varies by node type."},"target":{"type":"string","description":"Target node for audio routing."},"presetRef":{"type":"string","description":"Reference to a custom preset."}},"allOf":[{"if":{"properties":{"type":{"const":"Sampler"}}},"then":{"properties":{"options":{"type":"object","properties":{"urls":{"type":"object","description":"Sample URLs for Sampler nodes (note -> file path mapping)","patternProperties":{"^[A-G](#|b)?[0-8]$":{"type":"string","description":"File path to sample for this note"}}},"envelope":{"type":"object","description":"Automatic envelope for Samplers to smooth attack/release","properties":{"enabled":{"type":"boolean","default":true,"description":"Whether to apply automatic envelope"},"attack":{"type":"number","minimum":0,"maximum":2,"default":0.02,"description":"Attack time in seconds"},"decay":{"type":"number","minimum":0,"maximum":2,"default":0.1,"description":"Decay time in seconds"},"sustain":{"type":"number","minimum":0,"maximum":1,"default":0.8,"description":"Sustain level (0-1)"},"release":{"type":"number","minimum":0,"maximum":5,"default":0.3,"description":"Release time in seconds"}},"additionalProperties":false}},"additionalProperties":false}}}},{"if":{"properties":{"type":{"enum":["Synth","PolySynth","MonoSynth","AMSynth","FMSynth","DuoSynth","PluckSynth","NoiseSynth"]}}},"then":{"properties":{"options":{"type":"object","properties":{"oscillator":{"type":"object","description":"Oscillator settings for synths"},"envelope":{"type":"object","description":"ADSR envelope settings for synths"},"filter":{"type":"object","description":"Filter settings for synths"}},"additionalProperties":true}}}},{"if":{"properties":{"type":{"enum":["Reverb","JCReverb","Freeverb"]}}},"then":{"properties":{"options":{"type":"object","properties":{"wet":{"type":"number","minimum":0,"maximum":1,"default":0.5,"description":"Wet/dry mix (0=dry, 1=wet)"},"roomSize":{"type":"number","minimum":0,"maximum":1,"default":0.7,"description":"Room size for reverb effects"},"dampening":{"type":"number","minimum":0,"maximum":1,"default":0.3,"description":"Dampening for reverb effects"}},"additionalProperties":false}}}},{"if":{"properties":{"type":{"enum":["Delay","FeedbackDelay","PingPongDelay"]}}},"then":{"properties":{"options":{"type":"object","properties":{"wet":{"type":"number","minimum":0,"maximum":1,"default":0.5,"description":"Wet/dry mix (0=dry, 1=wet)"},"delayTime":{"type":"string","default":"8n","description":"Delay time (note values like '8n' or seconds)"},"feedback":{"type":"number","minimum":0,"maximum":0.95,"default":0.4,"description":"Feedback amount for delay effects"}},"additionalProperties":false}}}},{"if":{"properties":{"type":{"enum":["Filter","AutoFilter"]}}},"then":{"properties":{"options":{"type":"object","properties":{"frequency":{"type":"number","minimum":20,"maximum":20000,"default":1000,"description":"Filter frequency"},"Q":{"type":"number","minimum":0.1,"maximum":50,"default":1,"description":"Filter Q/resonance"},"type":{"type":"string","enum":["lowpass","highpass","bandpass","notch"],"default":"lowpass","description":"Filter type"}},"additionalProperties":false}}}},{"if":{"properties":{"type":{"enum":["Chorus","Phaser"]}}},"then":{"properties":{"options":{"type":"object","properties":{"wet":{"type":"number","minimum":0,"maximum":1,"default":0.5,"description":"Wet/dry mix (0=dry, 1=wet)"},"depth":{"type":"number","minimum":0,"maximum":1,"default":0.5,"description":"Modulation depth"},"rate":{"type":"string","default":"4n","description":"Modulation rate (note values or Hz)"}},"additionalProperties":false}}}},{"if":{"properties":{"type":{"enum":["Compressor","Limiter","Gate"]}}},"then":{"properties":{"options":{"type":"object","properties":{"threshold":{"type":"number","minimum":-60,"maximum":0,"default":-24,"description":"Threshold in dB"},"ratio":{"type":"number","minimum":1,"maximum":20,"default":4,"description":"Compression ratio"},"attack":{"type":"number","minimum":0,"maximum":1,"default":0.003,"description":"Attack time for compressor/gate"},"release":{"type":"number","minimum":0,"maximum":1,"default":0.1,"description":"Release time for compressor/gate"}},"additionalProperties":false}}}},{"if":{"properties":{"type":{"enum":["Distortion","Chebyshev"]}}},"then":{"properties":{"options":{"type":"object","properties":{"wet":{"type":"number","minimum":0,"maximum":1,"default":0.5,"description":"Wet/dry mix (0=dry, 1=wet)"},"distortion":{"type":"number","minimum":0,"maximum":1,"default":0.4,"description":"Distortion amount"}},"additionalProperties":false}}}},{"if":{"properties":{"type":{"const":"BitCrusher"}}},"then":{"properties":{"options":{"type":"object","properties":{"wet":{"type":"number","minimum":0,"maximum":1,"default":0.5,"description":"Wet/dry mix (0=dry, 1=wet)"},"bits":{"type":"number","minimum":1,"maximum":16,"default":4,"description":"Bit depth for BitCrusher"}},"additionalProperties":false}}}},{"if":{"properties":{"type":{"const":"Tremolo"}}},"then":{"properties":{"options":{"type":"object","properties":{"wet":{"type":"number","minimum":0,"maximum":1,"default":1,"description":"Wet/dry mix (0=dry, 1=wet)"},"frequency":{"type":"number","minimum":0.1,"maximum":20,"default":4,"description":"Tremolo frequency in Hz"},"depth":{"type":"number","minimum":0,"maximum":1,"default":0.5,"description":"Tremolo depth"}},"additionalProperties":false}}}},{"if":{"properties":{"type":{"const":"Destination"}}},"then":{"properties":{"options":{"type":"object","properties":{},"additionalProperties":false}}}}],"additionalProperties":false}},"connections":{"type":"array","description":"Array of audio graph connections. Each is a two-element array [source, target]. If not provided, default connections will be created automatically.","default":[["synth","master"]],"items":{"type":"array","minItems":2,"maxItems":2,"items":{"type":"string"}}},"tracks":{"type":"array","description":"Musical tracks (sequences or parts).","items":{"type":"object","required":["label","notes"],"properties":{"label":{"type":"string","description":"Label for this sequence (e.g., 'lead', 'bass', etc.)."},"midiChannel":{"type":"integer","minimum":0,"maximum":15,"description":"Default MIDI channel for this sequence (0-15)."},"synth":{"type":"object","required":["type"],"properties":{"type":{"type":"string","enum":["Synth","PolySynth","MonoSynth","AMSynth","FMSynth","DuoSynth","PluckSynth","NoiseSynth","Sampler"],"description":"Type of synthesizer (Synth, Sampler, AMSynth, FMSynth, etc.)."},"options":{"type":"object","description":"Synthesizer options."},"presetRef":{"type":"string","description":"Reference to a custom preset."},"modulationTarget":{"type":"string","enum":["vibrato","tremolo","glissando","filter"],"description":"Target for modulation wheel (CC1) control. Determines how modulation wheel affects the synth."}},"additionalProperties":false,"description":"Synthesizer definition for this sequence."},"synthRef":{"type":"string","description":"Reference to an audioGraph node to use as the synth."},"notes":{"type":"array","description":"Array of note events.","items":{"type":"object","required":["pitch","time","duration"],"properties":{"pitch":{"oneOf":[{"type":"number","description":"MIDI note number (preferred)."},{"type":"string","description":"Note name (e.g., 'C4', 'G#3')."},{"type":"array","description":"Chord (array of MIDI numbers or note names).","items":{"oneOf":[{"type":"number"},{"type":"string"}]}}]},"time":{"oneOf":[{"type":"string","pattern":"^\\\\d+:\\\\d+(\\\\.\\\\d+)?:\\\\d+$","description":"Musical time in bars:beats:ticks format (e.g., '0:2:0', '1:3.5:240'). Preferred format for precise musical timing."},{"type":"string","pattern":"^(\\\\d+n|\\\\d+t)$","description":"Tone.js note values (e.g., '4n', '8t') for relative timing."},{"type":"number","description":"Legacy: Time in beats (deprecated, use bars:beats:ticks format instead)."}]},"duration":{"oneOf":[{"type":"string","pattern":"^(\\\\d+n|\\\\d+t|\\\\d+:\\\\d+(\\\\.\\\\d+)?:\\\\d+)$","description":"Musical duration using Tone.js note values (e.g., '4n', '8n', '2t') or bars:beats:ticks format (e.g., '1:0:0')."},{"type":"number","description":"Legacy: Duration in seconds (deprecated, use note values instead)."}]},"velocity":{"type":"number","minimum":0,"maximum":1,"description":"Note velocity (0-1)."},"articulation":{"type":"string","enum":["staccato","accent","tenuto","legato","marcato"],"description":"Performance instruction that affects how a note is played (e.g., 'staccato', 'accent')."},"ornaments":{"type":"array","description":"Array of melodic ornaments to apply to this note","items":{"type":"object","required":["type"],"properties":{"type":{"type":"string","enum":["grace_note","trill","mordent","turn","arpeggio"],"description":"Type of ornament"},"parameters":{"type":"object","description":"Parameters specific to this ornament type","oneOf":[{"if":{"properties":{"type":{"const":"grace_note"}}},"then":{"properties":{"graceNoteType":{"type":"string","enum":["acciaccatura","appoggiatura"],"description":"Type of grace note"},"gracePitches":{"type":"array","items":{"oneOf":[{"type":"number","description":"MIDI note number"},{"type":"string","description":"Note name (e.g., 'C4')"}]},"description":"Optional specific pitches for the grace note(s)"}},"required":["graceNoteType"]}},{"if":{"properties":{"type":{"const":"trill"}}},"then":{"properties":{"by":{"type":"number","default":1,"description":"Interval for the trill (in scale steps)"},"trillRate":{"type":"number","default":0.125,"description":"Duration of each note in the trill"}}}},{"if":{"properties":{"type":{"const":"mordent"}}},"then":{"properties":{"by":{"type":"number","default":1,"description":"Interval for the mordent (in scale steps)"}}}},{"if":{"properties":{"type":{"const":"turn"}}},"then":{"properties":{"scale":{"type":"string","description":"Optional scale context for the turn"}}}},{"if":{"properties":{"type":{"const":"arpeggio"}}},"then":{"properties":{"arpeggioDegrees":{"type":"array","items":{"type":"number"},"description":"Scale degrees for the arpeggio"},"direction":{"type":"string","enum":["up","down","both"],"default":"up","description":"Direction of the arpeggio"}},"required":["arpeggioDegrees"]}}]}},"additionalProperties":false}},"microtuning":{"type":"number","description":"Microtuning adjustment in semitones."},"channel":{"type":"integer","minimum":0,"maximum":15,"description":"Override sequence MIDI channel for this note (0-15)."},"modulations":{"type":"array","description":"Per-note modulation events (CC, pitch bend, aftertouch).","items":{"type":"object","required":["type","value","time"],"properties":{"type":{"type":"string","enum":["cc","pitchBend","aftertouch"],"description":"Type of MIDI modulation event."},"controller":{"type":"integer","description":"MIDI CC number (required for type: 'cc')."},"value":{"type":"number","description":"Value for this modulation: 0-127 for CC, -8192 to +8192 for pitchBend (14-bit, maps to 2 semitones), 0-127 for aftertouch."},"time":{"oneOf":[{"type":"string","pattern":"^(\\\\d+n|\\\\d+t|\\\\d+:\\\\d+(\\\\.\\\\d+)?:\\\\d+)$","description":"Relative time using note values (e.g., '8n') or bars:beats:ticks (e.g., '0:0:240')."},{"type":"number","description":"Legacy: Relative time in seconds (deprecated)."}],"description":"When this modulation event happens (relative to note start)."}},"additionalProperties":false}}},"additionalProperties":false}},"loop":{"oneOf":[{"type":"boolean"},{"type":"string"}],"description":"Whether this sequence loops, or string for musical duration."},"loopEnd":{"type":"string","pattern":"^\\\\d+:\\\\d+(\\\\.\\\\d+)?:\\\\d+$","description":"Musical time in bars:beats:ticks format to end the loop (e.g., '4:0:0')."},"effects":{"type":"array","description":"Sequence-level effects.","items":{"type":"object","required":["type"],"properties":{"type":{"type":"string","description":"Type of effect (e.g., 'Reverb', 'Delay')."},"options":{"type":"object","description":"Options for this effect."},"presetRef":{"type":"string","description":"Reference to a custom preset."}},"additionalProperties":false}},"automation":{"type":"array","description":"Sequence-level automation channels affecting only this sequence.","items":{"$ref":"#/definitions/automationChannel"}}},"additionalProperties":false}},"automation":{"type":"object","description":"Multi-level automation system with interpolation support.","properties":{"enabled":{"type":"boolean","default":true,"description":"Whether automation is enabled globally."},"global":{"type":"array","description":"Global automation channels affecting the entire composition.","items":{"$ref":"#/definitions/automationChannel"}},"tracks":{"type":"object","description":"Sequence-level automation channels organized by sequence ID.","patternProperties":{".*":{"type":"array","description":"Automation channels for this sequence.","items":{"$ref":"#/definitions/automationChannel"}}},"additionalProperties":false},"events":{"type":"array","description":"Legacy automation events (deprecated, use channels instead).","items":{"type":"object","required":["target","time","value"],"properties":{"target":{"type":"string","description":"Parameter to automate, e.g., 'synth.frequency', 'effect.mix', 'midi.cc1'."},"time":{"oneOf":[{"type":"string","pattern":"^\\\\d+:\\\\d+(\\\\.\\\\d+)?:\\\\d+$","description":"Musical time in bars:beats:ticks format."},{"type":"number","description":"Legacy: Time in beats (deprecated)."}]},"value":{"type":"number","description":"Target value for the parameter."}},"additionalProperties":false}}},"additionalProperties":false},"annotations":{"type":"array","description":"Annotations (e.g., lyrics, rehearsal marks, comments) in the composition.","items":{"type":"object","required":["text","time"],"properties":{"text":{"type":"string","description":"Annotation text (e.g., lyric, instruction, label)."},"time":{"oneOf":[{"type":"string","pattern":"^\\\\d+:\\\\d+(\\\\.\\\\d+)?:\\\\d+$","description":"Musical time in bars:beats:ticks format (e.g., '1:2:0')."},{"type":"number","description":"Legacy: Time in beats (deprecated)."}]},"type":{"type":"string","description":"Type of annotation (e.g., 'lyric', 'marker', 'comment', 'rehearsal')."},"duration":{"oneOf":[{"type":"string","pattern":"^(\\\\d+n|\\\\d+t|\\\\d+:\\\\d+(\\\\.\\\\d+)?:\\\\d+)$","description":"Musical duration using note values (e.g., '4n') or bars:beats:ticks (e.g., '1:0:0')."},{"type":"number","description":"Legacy: Duration in seconds (deprecated)."}],"description":"Optional duration for annotation (e.g., for lyrics or extended comments)."}},"additionalProperties":false}},"timeSignatureMap":{"type":"array","description":"Map of time signature changes over time.","items":{"type":"object","required":["time","timeSignature"],"properties":{"time":{"oneOf":[{"type":"string","pattern":"^\\\\d+:\\\\d+(\\\\.\\\\d+)?:\\\\d+$","description":"Musical time in bars:beats:ticks format (e.g., '8:0:0')."},{"type":"number","description":"Legacy: Time in beats (deprecated)."}],"description":"Time of the time signature change."},"timeSignature":{"type":"string","pattern":"^\\\\d+/\\\\d+$","description":"New time signature at this time."}},"additionalProperties":false}},"synthConfig":{"type":"object","description":"Global synthesizer configuration that applies to all tracks unless overridden.","properties":{"type":{"type":"string","enum":["Synth","PolySynth","MonoSynth","AMSynth","FMSynth","DuoSynth","PluckSynth","NoiseSynth","Sampler"],"description":"Default synthesizer type (Synth, Sampler, AMSynth, FMSynth, etc.)."},"modulationTarget":{"type":"string","enum":["vibrato","tremolo","glissando","filter"],"description":"Default target for modulation wheel (CC1) control across all tracks."},"options":{"type":"object","description":"Default synthesizer options applied globally.","properties":{"envelope":{"type":"object","description":"Automatic envelope settings for Samplers to avoid abrupt cuts","properties":{"enabled":{"type":"boolean","default":true,"description":"Whether to apply automatic envelope to Samplers"},"attack":{"type":"number","minimum":0,"maximum":2,"default":0.02,"description":"Attack time in seconds"},"decay":{"type":"number","minimum":0,"maximum":2,"default":0.1,"description":"Decay time in seconds"},"sustain":{"type":"number","minimum":0,"maximum":1,"default":0.8,"description":"Sustain level (0-1)"},"release":{"type":"number","minimum":0,"maximum":5,"default":0.3,"description":"Release time in seconds"}},"additionalProperties":false}}}},"additionalProperties":false},"converterHints":{"type":"object","description":"Optional hints to guide specific converters.","properties":{"tone":{"type":"object","description":"Hints for jmon-tone.js converter.","patternProperties":{"^cc[0-9]+$":{"type":"object","description":"Hint configuration for a MIDI CC controller mapping.","properties":{"target":{"type":"string","description":"Target for this CC mapping - can be legacy target (filter, vibrato, tremolo, glissando) or specific effect node ID from audioGraph."},"parameter":{"type":"string","description":"Parameter name to control on the target effect (e.g., 'frequency', 'depth', 'Q')."},"frequency":{"type":"number","description":"Modulation rate in Hz (for vibrato/tremolo)."},"depthRange":{"type":"array","description":"Min/max depth or frequency range for the parameter.","items":{"type":"number"},"minItems":2,"maxItems":2}},"required":["target"],"additionalProperties":false}},"additionalProperties":false},"midi":{"type":"object","description":"Hints for jmon-midi.js converter.","properties":{"channel":{"type":"integer","minimum":0,"maximum":15,"description":"Default MIDI channel for outgoing messages."},"port":{"type":"string","description":"MIDI port name or identifier."}},"additionalProperties":false}},"additionalProperties":false}}`),definitions:{automationChannel:{type:"object",description:"Automation channel with interpolation support and anchor points.",required:["id","target","anchorPoints"],properties:{id:{type:"string",description:"Unique identifier for this automation channel."},name:{type:"string",description:"Human-readable name for this automation channel."},target:{type:"string",description:"JMON target parameter (e.g., 'synth.frequency', 'midi.cc1', 'effect.mix')."},level:{type:"string",enum:["global","sequence","note"],default:"global",description:"Automation level: global (entire composition), sequence (per track), or note (per note velocity)."},sequenceId:{type:"string",description:"Target sequence ID for sequence-level automation."},range:{type:"array",items:{type:"number"},minItems:2,maxItems:2,default:[0,127],description:"Value range [min, max] for this automation parameter."},interpolation:{type:"string",enum:["linear","quadratic","cubic","daw"],default:"daw",description:"Interpolation type: linear, quadratic (curve), cubic (smoothstep), or daw (Hermite splines)."},enabled:{type:"boolean",default:!0,description:"Whether this automation channel is enabled."},anchorPoints:{type:"array",description:"Automation anchor points defining the curve.",items:{type:"object",required:["time","value"],properties:{time:{oneOf:[{type:"string",pattern:"^\\d+:\\d+(\\.\\d+)?:\\d+$",description:"Musical time in bars:beats:ticks format (e.g., '2:1:240')."},{type:"number",description:"Time in measures (e.g., 2.5 = 2 bars + 2 beats in 4/4)."}]},value:{type:"number",description:"Automation value at this time point."},tangent:{type:"number",description:"Optional tangent/slope for Hermite interpolation (DAW mode)."}},additionalProperties:!1}}},additionalProperties:!1}},additionalProperties:!1};function Yi(o){const e=typeof o=="string"?parseInt(o,10):o;if(!Number.isFinite(e))return String(o);const r=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][(e%12+12)%12],n=Math.floor(e/12)-1;return`${r}${n}`}function Nn(o){return!o||!Array.isArray(o.audioGraph)||o.audioGraph.forEach(e=>{try{if(!e||e.type!=="Sampler")return;const t=e.options||{},r=t.urls;if(!r||typeof r!="object")return;const n={};Object.keys(r).forEach(i=>{const s=String(i);let a=s;/^\d+$/.test(s)&&(a=Yi(parseInt(s,10))),n[a]=r[i]}),e.options={...t,urls:n}}catch{}}),o}class Zt{constructor(e=Wi){this.ajv=new Ji({allErrors:!0,useDefaults:!0}),this.validate=this.ajv.compile(e)}validateAndNormalize(e){const t=JSON.parse(JSON.stringify(e));Nn(t);const r=this.validate(t);return{valid:r,errors:this.validate.errors||null,normalized:r?t:null}}getValidJmon(e){const{valid:t,normalized:r}=this.validateAndNormalize(e);return t?r:null}}class de{static chromatic_scale=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];static flat_to_sharp={Bb:"A#",Db:"C#",Eb:"D#",Gb:"F#",Ab:"G#","B":"A#","D":"C#","E":"D#","G":"F#","A":"G#","B-":"A#","D-":"C#","E-":"D#","G-":"F#","A-":"G#"};static scale_intervals={major:[0,2,4,5,7,9,11],minor:[0,2,3,5,7,8,10],diminished:[0,2,3,5,6,8,9,11],"major pentatonic":[0,2,4,7,9],"minor pentatonic":[0,3,5,7,10],chromatic:[0,1,2,3,4,5,6,7,8,9,10,11],lydian:[0,2,4,6,7,9,11],mixolydian:[0,2,4,5,7,9,10],dorian:[0,2,3,5,7,9,10],phrygian:[0,1,3,5,7,8,10],locrian:[0,1,3,5,6,8,10],"harmonic minor":[0,2,3,5,7,8,11],"melodic minor ascending":[0,2,3,5,7,9,11],"melodic minor descending":[0,2,3,5,7,8,10]};static intervals={P1:0,m2:1,M2:2,m3:3,M3:4,P4:5,P5:7,m6:8,M6:9,m7:10,M7:11,P8:12};static convertFlatToSharp(e){return this.flat_to_sharp[e]||e}static noteNameToMidi(e){const t=e.match(/^([A-G][#b-]?)(-?\d+)$/);if(!t)throw new Error(`Invalid note name format: ${e}`);const[,r,n]=t,i=this.convertFlatToSharp(r),s=this.chromatic_scale.indexOf(i);if(s===-1)throw new Error(`Invalid note name: ${r}`);return s+(parseInt(n)+1)*12}static midiToNoteName(e,t=!1){const r=Math.floor(e/12)-1,n=e%12;return`${this.chromatic_scale[n]}${r}`}static scaleToTriad(e){return[e[0],e[2],e[4]]}}class Rn{constructor(e,t="major"){const r=de.convertFlatToSharp(e);if(!de.chromatic_scale.includes(r))throw new Error(`'${e}' is not a valid tonic note. Select one among '${de.chromatic_scale.join(", ")}'.`);if(this.tonic=r,!Object.keys(de.scale_intervals).includes(t))throw new Error(`'${t}' is not a valid scale. Select one among '${Object.keys(de.scale_intervals).join(", ")}'.`);this.mode=t}generate(e={}){const t=de.scale_intervals[this.mode];if(!t)return console.warn(`Unknown scale mode: ${this.mode}`),[];typeof e.start=="string"&&(e.start=de.noteNameToMidi(e.start)),typeof e.end=="string"&&(e.end=de.noteNameToMidi(e.end));const r=e.start??60;if(de.chromatic_scale.indexOf(this.tonic)===-1)return console.warn(`Unknown tonic: ${this.tonic}`),[];const i=(a,c)=>{const u=c%t.length,d=Math.floor(c/t.length)*12,g=t[u];return a+g+d},s=[];if(e.end!==void 0)for(let a=0;;a++){const c=i(r,a);if(c>e.end)break;s.push(c)}else if(e.length)for(let a=0;a<e.length;a++)s.push(i(r,a));else return t.map(a=>r+a);return s}getNoteNames(){const e=de.scale_intervals[this.mode];if(!e)return[];const t=de.chromatic_scale.indexOf(this.tonic);return t===-1?[]:e.map(r=>{const n=(t+r)%12;return de.chromatic_scale[n]})}isInScale(e){const t=e%12;return this.generate().map(n=>n%12).includes(t)}}function Xi(o){if(typeof o=="object"&&!Array.isArray(o))return o;if(Array.isArray(o)){if(o.length===0)return{};if(o.every(t=>Array.isArray(t)&&t.length===3))return{"track 1":o};const e={};return o.forEach((t,r)=>{e[`track ${r+1}`]=t}),e}throw new Error("Input must be a list or dict of tracks.")}function jn(o,e){return e.reduce((t,r)=>Math.abs(r-o)<Math.abs(t-o)?r:t)}function Cn(o){return Math.floor(o/12)-1}function Qi(o){return{"D-":"C#","E-":"D#","G-":"F#","A-":"G#","B-":"A#",Db:"C#",Eb:"D#",Gb:"F#",Ab:"G#",Bb:"A#"}[o]||o}function er(o,e,t){typeof o=="string"&&(o=De(o)),typeof t=="string"&&(t=De(t));const r=e.indexOf(t);if(e.includes(o))return e.indexOf(o)-r;{const n=jn(o,e),i=e.indexOf(n),s=i>0?i-1:i,a=e[s],c=n-o,u=o-a,d=c+u;if(d===0)return i-r;const g=1-c/d,$=1-u/d,P=i-r,E=s-r;return P*g+E*$}}function Zi(o,e,t){const r=e.indexOf(t),n=Math.round(r+o);if(n>=0&&n<e.length)return e[n];{const i=Math.max(0,Math.min(n,e.length-1)),s=Math.min(e.length-1,Math.max(n,0)),a=e[i],c=e[s],u=s-n,d=n-i,g=u+d;if(g===0)return(c+a)/2;const $=1-u/g,P=1-d/g;return c*$+a*P}}function On(o){o.length>0&&o[0].length===2&&(o=o.map(r=>[r[0],r[1],0]));const e=[];let t=0;for(const[r,n,i]of o)e.push([r,n,t]),t+=n;return e}function In(o,e=0){const t=[...o].sort((i,s)=>i[2]-s[2]);let r=0;const n=[];for(const i of t){const[s,a,c]=i,u=e+c;if(u>r){const g=[null,u-r,r-e];n.push(g)}n.push(i),r=Math.max(r,u+a)}return n}function qn(o){o.sort((e,t)=>e[2]-t[2]);for(let e=0;e<o.length-1;e++){const t=o[e],r=o[e+1];if(t[2]+t[1]>r[2]){const i=r[2]-t[2];o[e]=[t[0],i,t[2]]}}return o}function eo(o){return qn(In(o))}function De(o){const e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],t={Db:"C#",Eb:"D#",Gb:"F#",Ab:"G#",Bb:"A#",Cb:"B"};let r=4,n=o;if(o.includes("b")){const a=o.slice(0,-1);t[a]&&(n=t[a]+o.slice(-1))}let i;return n.length>2||n.length===2&&!isNaN(n[1])?(i=n.slice(0,-1),r=parseInt(n.slice(-1))):i=n[0],12*(r+1)+e.indexOf(i)}function to(o){const e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],t=Math.floor(o/12)-1,r=o%12;return e[r]+t.toString()}function ro(o,e="offsets"){const t=[];let r=0;for(const[n,i,s]of o)t.push([n,i,r]),r+=i;return t}function no(o){return o.every(e=>Array.isArray(e))?"list of tuples":o.every(e=>!Array.isArray(e))?"list":"unknown"}function io(o,e,t,r=null,n=null){const i=r!==null?r:Math.min(...o),s=n!==null?n:Math.max(...o);return i===s?new Array(o.length).fill((e+t)/2):o.map(a=>(a-i)*(t-e)/(s-i)+e)}function Dn(o,e){return o.map(([t,r,n])=>[t,r,n+e])}function oo(o,e,t){const r=[];for(const[n,i,s]of o){const a=Math.round(s/t)*t,c=(Math.floor(a/e)+1)*e;let u=Math.round(i/t)*t;u=Math.min(u,c-a),u>0&&r.push([n,u,a])}return r}function so(o,e){const r=o.filter(([a,,c])=>a!==null&&c!==null).sort((a,c)=>a[2]-c[2]),n=Math.max(...r.map(([,,a])=>a)),i=Math.floor(n/e)+1,s=[];for(let a=0;a<i;a++){const c=a*e;let u=null,d=1/0;for(const[g,,$]of r){const P=c-$;if(P>=0&&P<d&&(d=P,u=g),$>c)break}u!==null&&s.push(u)}return s}function ao(o,e){return e.reduce((t,r)=>Math.abs(r-o)<Math.abs(t-o)?r:t)}function co(o,e){return 60/e*o}function*lo(o=0,e=1,t=0,r=1){for(;;)yield t+r*o,[o,e]=[e,o+e]}function uo(o,e,t){const r={};for(const[n,i]of Object.entries(o)){const s=[];for(let a=0;a<e;a++){const c=a*t,u=Dn(i,c);s.push(...u)}r[n]=s}return r}const ho=Object.freeze(Object.defineProperty({__proto__:null,adjustNoteDurationsToPreventOverlaps:qn,cdeToMidi:De,checkInput:no,fibonacci:lo,fillGapsWithRests:In,findClosestPitchAtMeasureStart:so,getDegreeFromPitch:er,getOctave:Cn,getPitchFromDegree:Zi,getSharp:Qi,instrumentMapping:{"Acoustic Grand Piano":0,"Bright Acoustic Piano":1,"Electric Grand Piano":2,"Honky-tonk Piano":3,"Electric Piano 1":4,"Electric Piano 2":5,Harpsichord:6,Clavinet:7,Gunshot:127},midiToCde:to,noOverlap:ro,offsetTrack:Dn,qlToSeconds:co,quantizeNotes:oo,repairNotes:eo,repeatPolyloops:uo,roundToList:jn,scaleList:io,setOffsetsAccordingToDurations:On,tracksToDict:Xi,tune:ao},Symbol.toStringTag,{value:"Module"}));class fo extends de{constructor(e="C4",t="P5",r="chords",n=[3,3,1],i=null){if(super(),this.tonicMidi=De(e),this.circleOf=t,this.type=r,this.radius=n,this.weights=i||n,!Object.keys(this.intervals).includes(this.circleOf))throw new Error(`Select a circleOf among ${Object.keys(this.intervals).join(", ")}.`);if(!["chords","pitches"].includes(this.type))throw new Error("Type must either be 'pitches' or 'chords'.")}computeCircle(){const e=this.intervals[this.circleOf],t=[this.tonicMidi];for(let r=0;r<Math.max(...this.radius);r++){const n=(t[t.length-1]+e)%12+Math.floor(t[t.length-1]/12)*12;t.push(n)}return{major:t.slice(0,this.radius[0]),minor:t.slice(0,this.radius[1]),diminished:t.slice(0,this.radius[2])}}generateChord(e,t){return({major:[0,4,7],minor:[0,3,7],diminished:[0,3,6]}[t]||[0,4,7]).map(s=>e+s).map(s=>s>127?s-12:s)}generate(e=4,t=null){t!==null&&(Math.seedrandom=t);const{major:r,minor:n,diminished:i}=this.computeCircle(),s=[r,n,i],a=["major","minor","diminished"],c=[];for(let u=0;u<e;u++){const d=this.weightedRandomChoice(this.weights);if(s[d].length>0){const g=s[d][Math.floor(Math.random()*s[d].length)],$=a[d],P=Array.isArray(g)?g[0]:g,E=this.generateChord(P,$);c.push(E)}}return c}weightedRandomChoice(e){const t=e.reduce((n,i)=>n+i,0);let r=Math.random()*t;for(let n=0;n<e.length;n++)if(r-=e[n],r<=0)return n;return e.length-1}}class po extends de{constructor(e="major",t="C",r=[0,2,4]){super(),this.tonic=t,this.scale=new Rn(t,e).generate(),this.degrees=r}pitchToChord(e){const t=Cn(e),r=this.tonic+t.toString(),n=De(r),i=this.scale.map(c=>er(c,this.scale,n)),s=Math.round(er(e,this.scale,n)),a=[];for(const c of this.degrees){const u=s+c,d=i.indexOf(u);d!==-1&&a.push(this.scale[d])}return a}generate(e,t=null,r=!1){if(!Array.isArray(e)||e.length===0)return[];let n=e;if(typeof e[0]=="number"){t===null&&(t=[1]);let s=0,a=0;n=e.map(c=>{const u=t[s%t.length],d=[c,u,a];return a+=u,s++,d})}const i=n.map(([s,a,c])=>[this.pitchToChord(s),a,c]);if(r){const s=[];for(const[a,c,u]of i){const d=c/a.length;a.forEach((g,$)=>{s.push([g,d,u+$*d])})}return s}else return i}}const zn={grace_note:{requiredParams:["graceNoteType"],optionalParams:["gracePitches"],conflicts:[],description:"Single note before the main note",defaultParams:{graceNoteType:"acciaccatura"},validate:(o,e)=>["acciaccatura","appoggiatura"].includes(e.graceNoteType)?e.gracePitches&&!Array.isArray(e.gracePitches)?{valid:!1,error:"gracePitches must be an array of pitches"}:{valid:!0}:{valid:!1,error:"graceNoteType must be either acciaccatura or appoggiatura"}},trill:{requiredParams:[],optionalParams:["by","trillRate"],conflicts:["mordent"],minDuration:"8n",description:"Rapid alternation between main note and auxiliary note",defaultParams:{by:1,trillRate:.125},validate:(o,e)=>e.by&&typeof e.by!="number"?{valid:!1,error:"trill step (by) must be a number"}:e.trillRate&&typeof e.trillRate!="number"?{valid:!1,error:"trillRate must be a number"}:{valid:!0}},mordent:{requiredParams:[],optionalParams:["by"],conflicts:["trill"],description:"Quick alternation with note above or below",defaultParams:{by:1},validate:(o,e)=>e.by&&typeof e.by!="number"?{valid:!1,error:"mordent step (by) must be a number"}:{valid:!0}},turn:{requiredParams:[],optionalParams:["scale"],conflicts:[],description:"Melodic turn around the main note",validate:(o,e)=>e.scale&&typeof e.scale!="string"?{valid:!1,error:"scale must be a string"}:{valid:!0}},arpeggio:{requiredParams:["arpeggioDegrees"],optionalParams:["direction"],conflicts:[],description:"Notes played in sequence",defaultParams:{direction:"up"},validate:(o,e)=>Array.isArray(e.arpeggioDegrees)?e.direction&&!["up","down","both"].includes(e.direction)?{valid:!1,error:"direction must be up, down, or both"}:{valid:!0}:{valid:!1,error:"arpeggioDegrees must be an array"}}};class tr{static validateOrnament(e,t,r={}){const n={valid:!1,warnings:[],errors:[]},i=zn[t];if(!i)return n.errors.push(`Unknown ornament type: ${t}`),n;if(i.requiredParams){for(const s of i.requiredParams)if(!(s in r))return n.errors.push(`Missing required parameter '${s}' for ${t}`),n}if(i.minDuration&&n.warnings.push(`Duration check not implemented for ${t}`),e.ornaments&&i.conflicts){const s=e.ornaments.filter(a=>i.conflicts.includes(a.type)).map(a=>a.type);if(s.length>0)return n.errors.push(`${t} conflicts with existing ornaments: ${s.join(", ")}`),n}if(i.validate){const s=i.validate(e,r);if(!s.valid)return n.errors.push(s.error),n}return n.valid=!0,n}constructor(e){const t=zn[e.type];if(!t)throw new Error(`Unknown ornament type: ${e.type}`);this.type=e.type,this.params={...t.defaultParams,...e.parameters},e.tonic&&e.mode?(this.tonicIndex=de.chromatic_scale.indexOf(e.tonic),this.scale=this.generateScale(e.tonic,e.mode)):this.scale=null}generateScale(e,t){const r=de.scale_intervals[t],n=de.chromatic_scale.indexOf(e),i=r.map(a=>(n+a)%12),s=[];for(let a=-1;a<10;a++)for(const c of i){const u=12*a+c;u>=0&&u<=127&&s.push(u)}return s}apply(e,t=null){if(!Array.isArray(e)||e.length===0||(t===null&&(t=Math.floor(Math.random()*e.length)),t<0||t>=e.length))return e;const r=e[t],n=tr.validateOrnament(r,this.type,this.params);if(!n.valid)return console.warn(`Ornament validation failed: ${n.errors.join(", ")}`),e;switch(this.type){case"grace_note":return this.addGraceNote(e,t);case"trill":return this.addTrill(e,t);case"mordent":return this.addMordent(e,t);case"turn":return this.addTurn(e,t);case"arpeggio":return this.addArpeggio(e,t);default:return e}}addGraceNote(e,t){const r=e[t],n=r.pitch,i=r.duration,s=r.time,a=this.params.gracePitches?this.params.gracePitches[Math.floor(Math.random()*this.params.gracePitches.length)]:n+1;if(this.params.graceNoteType==="acciaccatura"){const c=i*.125,u={pitch:n,duration:i,time:s+c};return[...e.slice(0,t),{pitch:a,duration:c,time:s},u,...e.slice(t+1)]}else{const c=i/2,u={pitch:n,duration:c,time:s+c};return[...e.slice(0,t),{pitch:a,duration:c,time:s},u,...e.slice(t+1)]}}addTrill(e,t){const r=e[t],n=r.pitch,i=r.duration,s=r.time,a=[];let c=s;const u=this.params.by||1,d=this.params.trillRate||.125;let g;if(this.scale&&this.scale.includes(n)){const P=(this.scale.indexOf(n)+Math.round(u))%this.scale.length;g=this.scale[P]}else g=n+u;for(;c<s+i;){const $=s+i-c,P=Math.min(d,$/2);if($>=P*2)a.push({pitch:n,duration:P,time:c}),a.push({pitch:g,duration:P,time:c+P}),c+=2*P;else break}return[...e.slice(0,t),...a,...e.slice(t+1)]}addMordent(e,t){const r=e[t],n=r.pitch,i=r.duration,s=r.time,a=this.params.by||1;let c;if(this.scale&&this.scale.includes(n)){const $=this.scale.indexOf(n)+Math.round(a);c=this.scale[$]||n+a}else c=n+a;const u=i/3,d=[{pitch:n,duration:u,time:s},{pitch:c,duration:u,time:s+u},{pitch:n,duration:u,time:s+2*u}];return[...e.slice(0,t),...d,...e.slice(t+1)]}addTurn(e,t){const r=e[t],n=r.pitch,i=r.duration,s=r.time,a=i/4;let c,u;if(this.scale&&this.scale.includes(n)){const g=this.scale.indexOf(n);c=this.scale[g+1]||n+2,u=this.scale[g-1]||n-2}else c=n+2,u=n-2;const d=[{pitch:n,duration:a,time:s},{pitch:c,duration:a,time:s+a},{pitch:n,duration:a,time:s+2*a},{pitch:u,duration:a,time:s+3*a}];return[...e.slice(0,t),...d,...e.slice(t+1)]}addArpeggio(e,t){const r=e[t],n=r.pitch,i=r.duration,s=r.time,{arpeggioDegrees:a,direction:c="up"}=this.params;if(!a||!Array.isArray(a))return e;const u=[];if(this.scale&&this.scale.includes(n)){const $=this.scale.indexOf(n);u.push(...a.map(P=>this.scale[$+P]||n+P))}else u.push(...a.map($=>n+$));c==="down"&&u.reverse(),c==="both"&&u.push(...u.slice(0,-1).reverse());const d=i/u.length,g=u.map(($,P)=>({pitch:$,duration:d,time:s+P*d}));return[...e.slice(0,t),...g,...e.slice(t+1)]}}const rr={staccato:{complex:!1,description:"Shortens note duration to ~50%"},accent:{complex:!1,description:"Increases note velocity/emphasis"},tenuto:{complex:!1,description:"Holds note for full duration with emphasis"},legato:{complex:!1,description:"Smooth connection between notes"},marcato:{complex:!1,description:"Strong accent with slight separation"},glissando:{complex:!0,requiredParams:["target"],description:"Smooth slide from note to target pitch"},portamento:{complex:!0,requiredParams:["target"],optionalParams:["curve","speed"],description:"Expressive slide between pitches"},bend:{complex:!0,requiredParams:["amount"],optionalParams:["curve","returnToOriginal"],description:"Pitch bend up or down in cents"},vibrato:{complex:!0,optionalParams:["rate","depth","delay"],description:"Periodic pitch variation"},tremolo:{complex:!0,optionalParams:["rate","depth"],description:"Rapid volume variation"},crescendo:{complex:!0,requiredParams:["endVelocity"],optionalParams:["curve"],description:"Gradual volume increase"},diminuendo:{complex:!0,requiredParams:["endVelocity"],optionalParams:["curve"],description:"Gradual volume decrease"}};class Rt{static addArticulation(e,t,r,n={}){const i={success:!1,warnings:[],errors:[]};if(!Array.isArray(e))return i.errors.push("Sequence must be an array"),i;if(r<0||r>=e.length)return i.errors.push(`Note index ${r} out of bounds (sequence length: ${e.length})`),i;const s=rr[t];if(!s)return i.errors.push(`Unknown articulation type: ${t}`),i;const a=e[r];return!a||typeof a!="object"?(i.errors.push(`Invalid note at index ${r}`),i):s.complex?this._addComplexArticulation(a,t,s,n,i):(a.articulation=t,i.success=!0,i)}static _addComplexArticulation(e,t,r,n,i){if(r.requiredParams){for(const s of r.requiredParams)if(!(s in n))return i.errors.push(`Missing required parameter '${s}' for ${t}`),i}switch(t){case"glissando":case"portamento":return this._applyGlissando(e,t,n,i);case"bend":return this._applyBend(e,n,i);case"vibrato":return this._applyVibrato(e,n,i);case"tremolo":return this._applyTremolo(e,n,i);case"crescendo":case"diminuendo":return this._applyDynamicChange(e,t,n,i);default:return i.errors.push(`Complex articulation ${t} not implemented`),i}}static _applyGlissando(e,t,r,n){e.articulation=t,e.glissTarget=r.target,e.modulations||(e.modulations=[]);const i={type:"pitch",subtype:t,target:r.target,curve:r.curve||"linear",timing:"note_duration"};return r.speed!==void 0&&(i.speed=r.speed),e.modulations=e.modulations.filter(s=>!(s.type==="pitch"&&s.subtype===t)),e.modulations.push(i),n.success=!0,n.warnings.push(`Added ${t} modulation synchronized with articulation`),n}static _applyBend(e,t,r){e.articulation="bend",e.modulations||(e.modulations=[]);const n={type:"pitch",subtype:"bend",amount:t.amount,curve:t.curve||"linear",timing:t.returnToOriginal?"note_duration":"sustain",returnToOriginal:t.returnToOriginal??!0};return e.modulations=e.modulations.filter(i=>!(i.type==="pitch"&&i.subtype==="bend")),e.modulations.push(n),r.success=!0,r.warnings.push("Added pitch bend modulation synchronized with articulation"),r}static _applyVibrato(e,t,r){e.articulation="vibrato",e.modulations||(e.modulations=[]);const n={type:"pitch",subtype:"vibrato",rate:t.rate||5,depth:t.depth||50,delay:t.delay||0,timing:"note_duration"};return e.modulations=e.modulations.filter(i=>!(i.type==="pitch"&&i.subtype==="vibrato")),e.modulations.push(n),r.success=!0,r.warnings.push("Added vibrato modulation synchronized with articulation"),r}static _applyTremolo(e,t,r){e.articulation="tremolo",e.modulations||(e.modulations=[]);const n={type:"amplitude",subtype:"tremolo",rate:t.rate||8,depth:t.depth||.3,timing:"note_duration"};return e.modulations=e.modulations.filter(i=>!(i.type==="amplitude"&&i.subtype==="tremolo")),e.modulations.push(n),r.success=!0,r.warnings.push("Added tremolo modulation synchronized with articulation"),r}static _applyDynamicChange(e,t,r,n){e.articulation=t,e.modulations||(e.modulations=[]);const i={type:"amplitude",subtype:t,startVelocity:e.velocity||.8,endVelocity:r.endVelocity,curve:r.curve||"linear",timing:"note_duration"};return e.modulations=e.modulations.filter(s=>!(s.type==="amplitude"&&(s.subtype==="crescendo"||s.subtype==="diminuendo"))),e.modulations.push(i),n.success=!0,n.warnings.push(`Added ${t} modulation synchronized with articulation`),n}static removeArticulation(e,t){if(!Array.isArray(e)||t<0||t>=e.length)return{success:!1,error:"Invalid sequence or note index"};const r=e[t];if(!r||typeof r!="object")return{success:!1,error:"Invalid note"};const n=r.articulation;if(delete r.articulation,delete r.glissTarget,r.modulations&&n){const i=rr[n];i&&i.complex&&(r.modulations=r.modulations.filter(s=>s.subtype!==n),r.modulations.length===0&&delete r.modulations)}return{success:!0,removed:n,message:`Removed ${n} articulation and related modulations`}}static validateSequence(e){const t=[];return e.forEach((r,n)=>{if(r.articulation){const i=this.ARTICULATION_TYPES[r.articulation];if(!i){t.push({type:"unknown_articulation",noteIndex:n,articulation:r.articulation,message:`Unknown articulation type: ${r.articulation}`});return}r.articulation==="glissando"&&!r.glissTarget&&t.push({type:"missing_parameter",noteIndex:n,articulation:r.articulation,message:"Glissando missing glissTarget parameter"}),i.complex&&r.modulations&&(r.modulations.some(a=>a.subtype===r.articulation)||t.push({type:"modulation_sync",noteIndex:n,articulation:r.articulation,message:`Complex articulation ${r.articulation} should have corresponding modulation`}))}}),{valid:t.length===0,issues:t}}static getAvailableTypes(){return Object.entries(rr).map(([e,t])=>({type:e,complex:t.complex,description:t.description,requiredParams:t.requiredParams||[],optionalParams:t.optionalParams||[]}))}}function Vn(o,e,t,r){return Rt.addArticulation(o,e,t,r)}function Fn(o,e){return Rt.removeArticulation(o,e)}function mo(o){return Rt.validateSequence(o)}const yo={Scale:Rn,Progression:fo,Voice:po,Ornament:tr,Articulation:Rt,addArticulation:Vn,addOrnament:Vn,removeArticulation:Fn,removeOrnament:Fn,validateArticulations:mo};class go{constructor(e,t){this.measureLength=e,this.durations=t}random(e=null,t=0,r=100){e!==null&&(Math.seedrandom=e);const n=[];let i=0,s=0;for(;i<this.measureLength&&s<r;){const a=this.durations[Math.floor(Math.random()*this.durations.length)];if(i+a>this.measureLength){s++;continue}if(Math.random()<t){s++;continue}n.push([a,i]),i+=a,s++}return s>=r&&console.warn("Max iterations reached. The sum of the durations may not equal the measure length."),n}darwin(e=null,t=10,r=50,n=.1){return new vo(e,t,this.measureLength,r,n,this.durations).generate()}}class vo{constructor(e,t,r,n,i,s){e!==null&&(Math.seedrandom=e),this.populationSize=t,this.measureLength=r,this.maxGenerations=n,this.mutationRate=i,this.durations=s,this.population=this.initializePopulation()}initializePopulation(){const e=[];for(let t=0;t<this.populationSize;t++)e.push(this.createRandomRhythm());return e}createRandomRhythm(){const e=[];let t=0;for(;t<this.measureLength;){const r=this.measureLength-t,n=this.durations[Math.floor(Math.random()*this.durations.length)];if(n<=r)e.push([n,t]),t+=n;else break}return e}evaluateFitness(e){const t=e.reduce((r,n)=>r+n[0],0);return Math.abs(this.measureLength-t)}selectParent(){const e=this.population[Math.floor(Math.random()*this.population.length)],t=this.population[Math.floor(Math.random()*this.population.length)];return this.evaluateFitness(e)<this.evaluateFitness(t)?e:t}crossover(e,t){if(e.length===0||t.length===0)return e.length>0?[...e]:[...t];const r=Math.floor(Math.random()*(e.length-1))+1,n=[...e.slice(0,r),...t.slice(r)];return this.ensureMeasureLength(n)}ensureMeasureLength(e){return e.reduce((r,n)=>r+n[0],0)>this.measureLength&&e.length>0&&e.pop(),e}mutate(e){if(Math.random()<this.mutationRate&&e.length>1){const t=Math.floor(Math.random()*(e.length-1)),[r,n]=e[t],s=(t===e.length-1?this.measureLength:e[t+1][1])-n,a=this.durations.filter(c=>c<=s);if(a.length>0){const c=a[Math.floor(Math.random()*a.length)];e[t]=[c,n]}}return e}generate(){for(let t=0;t<this.maxGenerations;t++){const r=[];for(let n=0;n<this.populationSize;n++){const i=this.selectParent(),s=this.selectParent();let a=this.crossover(i,s);a=this.mutate(a),a.sort((c,u)=>c[1]-u[1]),r.push(a)}this.population=r}return this.population.reduce((t,r)=>this.evaluateFitness(r)<this.evaluateFitness(t)?r:t).sort((t,r)=>t[1]-r[1])}}function bo(o,e){const t=o.map(a=>Array.isArray(a)||typeof a=="object"&&a.length?a[0]:a),r=wo(t.length,e.length),n=[],i=[];for(let a=0;a<r;a++)n.push(t[a%t.length]),i.push(e[a%e.length]);const s=n.map((a,c)=>[a,i[c],1]);return On(s)}function wo(o,e){const t=(r,n)=>n===0?r:t(n,r%n);return Math.abs(o*e)/t(o,e)}function $o(o,e){const t=[];let r=0,n=0;for(const i of o){const s=e[n%e.length];t.push([i,s,r]),r+=s,n++}return t}const _o={Rhythm:go,isorhythm:bo,beatcycle:$o};class Po{constructor(){}}class Te{data;constructor(e,t){if(typeof e=="number"){if(t===void 0)throw new Error("Columns parameter required when creating matrix from dimensions");this.rows=e,this.columns=t,this.data=Array(this.rows).fill(0).map(()=>Array(this.columns).fill(0))}else this.data=e.map(r=>[...r]),this.rows=this.data.length,this.columns=this.data[0]?.length||0}static zeros(e,t){return new Te(e,t)}static from2DArray(e){return new Te(e)}get(e,t){if(e<0||e>=this.rows||t<0||t>=this.columns)throw new Error(`Index out of bounds: (${e}, ${t})`);return this.data[e][t]}set(e,t,r){if(e<0||e>=this.rows||t<0||t>=this.columns)throw new Error(`Index out of bounds: (${e}, ${t})`);this.data[e][t]=r}getRow(e){if(e<0||e>=this.rows)throw new Error(`Row index out of bounds: ${e}`);return[...this.data[e]]}getColumn(e){if(e<0||e>=this.columns)throw new Error(`Column index out of bounds: ${e}`);return this.data.map(t=>t[e])}transpose(){const e=Array(this.columns).fill(0).map(()=>Array(this.rows).fill(0));for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e[r][t]=this.data[t][r];return new Te(e)}clone(){return new Te(this.data)}toArray(){return this.data.map(e=>[...e])}}function nr(o){return Array.isArray(o[0])?Te.from2DArray(o):Te.from2DArray([o])}function So(o){if(o.rows!==o.columns)throw new Error("Matrix must be square for Cholesky decomposition");const e=o.rows,t=Te.zeros(e,e);for(let r=0;r<e;r++)for(let n=0;n<=r;n++)if(r===n){let i=0;for(let a=0;a<n;a++)i+=t.get(n,a)*t.get(n,a);const s=o.get(n,n)-i;if(s<=0)throw new Error(`Matrix is not positive definite at position (${n}, ${n})`);t.set(n,n,Math.sqrt(s))}else{let i=0;for(let s=0;s<n;s++)i+=t.get(r,s)*t.get(n,s);t.set(r,n,(o.get(r,n)-i)/t.get(n,n))}return t}class Eo{kernel;alpha;XTrain;yTrain;L;alphaVector;constructor(e,t={}){this.kernel=e,this.alpha=t.alpha||1e-10}fit(e,t){this.XTrain=nr(e),this.yTrain=[...t];const r=this.kernel.call(this.XTrain);for(let n=0;n<r.rows;n++)r.set(n,n,r.get(n,n)+this.alpha);try{this.L=So(r)}catch(n){throw new Error(`Failed to compute Cholesky decomposition: ${n instanceof Error?n.message:"Unknown error"}`)}this.alphaVector=this.solveCholesky(this.L,this.yTrain)}predict(e,t=!1){if(!this.XTrain||!this.yTrain||!this.L||!this.alphaVector)throw new Error("Model must be fitted before prediction");const r=nr(e),n=this.kernel.call(this.XTrain,r),i=new Array(r.rows);for(let a=0;a<r.rows;a++){i[a]=0;for(let c=0;c<this.XTrain.rows;c++)i[a]+=n.get(c,a)*this.alphaVector[c]}const s={mean:i};if(t){const a=this.computeStd(r,n);s.std=a}return s}sampleY(e,t=1){if(!this.XTrain||!this.yTrain||!this.L||!this.alphaVector)throw new Error("Model must be fitted before sampling");const r=nr(e),n=this.predict(e,!0);if(!n.std)throw new Error("Standard deviation computation failed");const i=[];for(let s=0;s<t;s++){const a=new Array(r.rows);for(let c=0;c<r.rows;c++){const u=n.mean[c],d=n.std[c];a[c]=u+d*this.sampleStandardNormal()}i.push(a)}return i}logMarginalLikelihood(){if(!this.XTrain||!this.yTrain||!this.L||!this.alphaVector)throw new Error("Model must be fitted before computing log marginal likelihood");let e=0;for(let t=0;t<this.yTrain.length;t++)e-=.5*this.yTrain[t]*this.alphaVector[t];for(let t=0;t<this.L.rows;t++)e-=Math.log(this.L.get(t,t));return e-=.5*this.yTrain.length*Math.log(2*Math.PI),e}computeStd(e,t){if(!this.L)throw new Error("Cholesky decomposition not available");const r=new Array(e.rows);for(let n=0;n<e.rows;n++){const i=this.kernel.compute(e.getRow(n),e.getRow(n)),s=t.getColumn(n),a=this.forwardSubstitution(this.L,s);let c=0;for(let d=0;d<a.length;d++)c+=a[d]*a[d];const u=i-c;r[n]=Math.sqrt(Math.max(0,u))}return r}solveCholesky(e,t){const r=this.forwardSubstitution(e,t);return this.backSubstitution(e,r)}forwardSubstitution(e,t){const r=e.rows,n=new Array(r);for(let i=0;i<r;i++){n[i]=t[i];for(let s=0;s<i;s++)n[i]-=e.get(i,s)*n[s];n[i]/=e.get(i,i)}return n}backSubstitution(e,t){const r=e.rows,n=new Array(r);for(let i=r-1;i>=0;i--){n[i]=t[i];for(let s=i+1;s<r;s++)n[i]-=e.get(s,i)*n[s];n[i]/=e.get(i,i)}return n}sampleStandardNormal(){const e=Math.random(),t=Math.random();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)}}class To{constructor(e={}){this.width=e.width||51,this.ruleNumber=e.ruleNumber||30,this.initialState=e.initialState||this.generateRandomInitialState(),this.state=[...this.initialState],this.rules=this.loadRules(this.ruleNumber),this.history=[]}generate(e){this.history=[],this.state=[...this.initialState],this.history.push([...this.state]);for(let t=0;t<e;t++)this.updateState(),this.history.push([...this.state]);return this.history}generate01(e){return this.generate(e).map(r=>r.map(n=>n>0?1:0))}loadRules(e){const t=e.toString(2).padStart(8,"0"),r={},n=["111","110","101","100","011","010","001","000"];for(let i=0;i<8;i++)r[n[i]]=parseInt(t[i],10);return r}updateState(){const e=new Array(this.width);for(let t=0;t<this.width;t++){const r=this.state[(t-1+this.width)%this.width],n=this.state[t],i=this.state[(t+1)%this.width],s=`${r}${n}${i}`;e[t]=this.rules[s]||0}this.state=e}validateStrips(e){if(!Array.isArray(e)||e.length===0)return!1;const t=e[0]?.length;return t?e.every(r=>Array.isArray(r)&&r.length===t&&r.every(n=>typeof n=="number"&&(n===0||n===1))):!1}validateValues(e){return Array.isArray(e)&&e.length===this.width&&e.every(t=>typeof t=="number"&&(t===0||t===1))}setInitialState(e){if(this.validateValues(e))this.initialState=[...e],this.state=[...e];else throw new Error("Invalid initial state")}setRuleNumber(e){if(e>=0&&e<=255)this.ruleNumber=e,this.rules=this.loadRules(e);else throw new Error("Rule number must be between 0 and 255")}getHistory(){return this.history.map(e=>[...e])}getCurrentState(){return[...this.state]}generateRandomInitialState(){const e=new Array(this.width).fill(0);return e[Math.floor(this.width/2)]=1,e}generateRandomState(){return Array.from({length:this.width},()=>Math.random()>.5?1:0)}plot(){return{data:this.getHistory(),width:this.width,height:this.history.length}}async plotEvolution(e){return(await Promise.resolve().then(()=>lr)).CAVisualizer.plotEvolution(this.getHistory(),e)}async plotGeneration(e){return(await Promise.resolve().then(()=>lr)).CAVisualizer.plotGeneration(this.getCurrentState(),e)}async plotDensity(e){return(await Promise.resolve().then(()=>lr)).CAVisualizer.plotDensity(this.getHistory(),e)}}class jt{constructor(e,t=4,r=!0){if(!e)throw new Error("Loops parameter is required");if(typeof t!="number"||t<=0)throw new Error("measureLength must be a positive number");if(typeof r!="boolean")throw new Error("insertRests must be a boolean");if(this.measureLength=t,Array.isArray(e)){if(e.length===0)throw new Error("Loops array cannot be empty");const n={};e.forEach((i,s)=>{const a=i?.label||`Loop ${s+1}`;n[a]=i}),e=n}if(typeof e!="object"||Object.keys(e).length===0)throw new Error("Loops must be a non-empty object or array");this.loops={};for(const[n,i]of Object.entries(e)){if(!i)throw new Error(`Loop data for "${n}" is null or undefined`);const s=Array.isArray(i)?i:i.notes||[];if(!Array.isArray(s))throw new Error(`Notes for loop "${n}" must be an array`);const a=s.map((c,u)=>{if(!c||typeof c!="object")throw new Error(`Note ${u} in loop "${n}" must be an object`);if(c.pitch!==null&&(typeof c.pitch!="number"||c.pitch<0||c.pitch>127))throw new Error(`Note ${u} in loop "${n}" has invalid pitch: ${c.pitch}`);if(typeof c.time!="number"||c.time<0)throw new Error(`Note ${u} in loop "${n}" has invalid time: ${c.time}`);if(typeof c.duration!="number"||c.duration<=0)throw new Error(`Note ${u} in loop "${n}" has invalid duration: ${c.duration}`);return{pitch:c.pitch,time:c.time,duration:c.duration,velocity:typeof c.velocity=="number"?Math.max(0,Math.min(1,c.velocity)):.8}});this.loops[n]={label:i.label||n,notes:r?this.fillGapsWithRests(a):a,synth:i.synth||{type:"Synth",options:{oscillator:{type:"sine"},envelope:{attack:.01,decay:.1,sustain:.3,release:.5}}}}}}fillGapsWithRests(e){if(e.length===0)return e;const t=[];let r=0;const n=[...e].sort((i,s)=>i.time-s.time);for(const i of n)i.time>r&&t.push({pitch:null,duration:i.time-r,time:r,velocity:0}),t.push({pitch:i.pitch,duration:i.duration,time:i.time,velocity:i.velocity||.8}),r=i.time+i.duration;return t}static fromTrack(e,t=4){if((e.notes||[]).length===0)throw new Error("Track must have notes to create loop");return new jt({[e.label||"Track"]:e},t)}static euclidean(e,t,r=[60],n=null){if(typeof e!="number"||e<=0||!Number.isInteger(e))throw new Error("beats must be a positive integer");if(typeof t!="number"||t<0||!Number.isInteger(t))throw new Error("pulses must be a non-negative integer");if(t>e)throw new Error("pulses cannot be greater than beats");if(!Array.isArray(r)||r.length===0)throw new Error("pitches must be a non-empty array");const i=this.generateEuclideanRhythm(e,t),s=[],a=1;i.forEach((u,d)=>{if(u){const g=d*a,$=r[d%r.length];s.push({pitch:$,duration:a*.8,time:g,velocity:.8})}});const c={label:n||`Euclidean ${t}/${e}`,notes:s,synth:{type:"Synth",options:{oscillator:{type:"sine"},envelope:{attack:.01,decay:.1,sustain:.3,release:.5}}}};return new jt({[c.label]:c},e)}static generateEuclideanRhythm(e,t){if(t===0)return Array(e).fill(!1);if(t>=e)return Array(e).fill(!0);let r=[{pattern:[1],count:t},{pattern:[0],count:e-t}];for(;r.length>1;){const[s,a]=r;if(s.count<=a.count){const c=s.count,u=a.count-s.count;r=[{pattern:[...a.pattern,...s.pattern],count:c}],u>0&&r.push({pattern:a.pattern,count:u})}else{const c=a.count,u=s.count-a.count;r=[{pattern:[...s.pattern,...a.pattern],count:c}],u>0&&r.push({pattern:s.pattern,count:u})}}const n=r[0],i=[];for(let s=0;s<n.count;s++)i.push(...n.pattern);return i.map(s=>s===1)}toJMonSequences(){return Object.values(this.loops)}async plot(e=1/4,t=null,r={}){const{LoopVisualizer:n}=await Promise.resolve().then(()=>Yn);return n.plotLoops(this.loops,this.measureLength,e,t,r)}}class Ln{static gini(e,t){if(e.length===0)return 0;const r=e.length,n=t||Array(r).fill(1),i=e.map((g,$)=>({value:g,weight:n[$]})).sort((g,$)=>g.value-$.value),s=i.map(g=>g.value),a=i.map(g=>g.weight),c=a.reduce((g,$)=>g+$,0);let u=0,d=0;for(let g=0;g<r;g++){const $=a.slice(0,g+1).reduce((P,E)=>P+E,0);u+=a[g]*(2*$-a[g]-c)*s[g],d+=a[g]*s[g]*c}return d===0?0:u/d}static balance(e,t){if(e.length===0)return 0;const r=t||Array(e.length).fill(1),n=e.reduce((s,a,c)=>s+a*r[c],0),i=r.reduce((s,a)=>s+a,0);return i===0?0:n/i}static autocorrelation(e,t){const r=e.length,n=t||Math.floor(r/2),i=[],s=e.reduce((c,u)=>c+u,0)/r,a=e.reduce((c,u)=>c+Math.pow(u-s,2),0)/r;for(let c=0;c<=n;c++){let u=0;for(let d=0;d<r-c;d++)u+=(e[d]-s)*(e[d+c]-s);u/=r-c,i.push(a===0?0:u/a)}return i}static motif(e,t=3){if(e.length<t*2)return 0;const r=new Map;for(let s=0;s<=e.length-t;s++){const a=e.slice(s,s+t).join(",");r.set(a,(r.get(a)||0)+1)}const n=Math.max(...r.values()),i=r.size;return i===0?0:n/i}static dissonance(e,t=[0,2,4,5,7,9,11]){if(e.length===0)return 0;let r=0;for(const n of e){const i=(n%12+12)%12;t.includes(i)&&r++}return 1-r/e.length}static rhythmic(e,t=16){if(e.length===0)return 0;let r=0;const n=.1;for(const i of e){const s=i*t,a=Math.round(s);Math.abs(s-a)<=n&&r++}return r/e.length}static fibonacciIndex(e){if(e.length<2)return 0;const t=(1+Math.sqrt(5))/2;let r=0;for(let n=1;n<e.length;n++)if(e[n-1]!==0){const i=e[n]/e[n-1],s=Math.abs(i-t);r+=1/(1+s)}return r/(e.length-1)}static syncopation(e,t=4){if(e.length===0)return 0;let r=0;for(const n of e){const i=n*t%1;i>.2&&i<.8&&Math.abs(i-.5)>.2&&r++}return r/e.length}static contourEntropy(e){if(e.length<2)return 0;const t=[];for(let s=1;s<e.length;s++){const a=e[s]-e[s-1];a>0?t.push(1):a<0?t.push(-1):t.push(0)}const r={up:0,down:0,same:0};for(const s of t)s>0?r.up++:s<0?r.down++:r.same++;const n=t.length;return-[r.up/n,r.down/n,r.same/n].filter(s=>s>0).reduce((s,a)=>s+a*Math.log2(a),0)}static intervalVariance(e){if(e.length<2)return 0;const t=[];for(let i=1;i<e.length;i++)t.push(Math.abs(e[i]-e[i-1]));const r=t.reduce((i,s)=>i+s,0)/t.length;return t.reduce((i,s)=>i+Math.pow(s-r,2),0)/t.length}static density(e,t=1){if(e.length===0)return 0;const r=e.map(a=>typeof a.time=="string"?parseFloat(a.time)||0:a.time||0),n=Math.min(...r),s=Math.max(...r)-n||1;return e.length/(s/t)}static gapVariance(e){if(e.length<2)return 0;const t=[];for(let i=1;i<e.length;i++)t.push(e[i]-e[i-1]);const r=t.reduce((i,s)=>i+s,0)/t.length;return t.reduce((i,s)=>i+Math.pow(s-r,2),0)/t.length}static analyze(e,t={}){const{scale:r=[0,2,4,5,7,9,11]}=t,n=e.map(s=>typeof s.note=="number"?s.note:typeof s.note=="string"?60:Array.isArray(s.note)?s.note[0]:60),i=e.map(s=>typeof s.time=="number"?s.time:parseFloat(s.time)||0);return{gini:this.gini(n),balance:this.balance(n),motif:this.motif(n),dissonance:this.dissonance(n,r),rhythmic:this.rhythmic(i),fibonacciIndex:this.fibonacciIndex(n),syncopation:this.syncopation(i),contourEntropy:this.contourEntropy(n),intervalVariance:this.intervalVariance(n),density:this.density(e),gapVariance:this.gapVariance(i)}}}class Mo{constructor(e={}){this.options={populationSize:e.populationSize||50,generations:e.generations||100,mutationRate:e.mutationRate||.1,crossoverRate:e.crossoverRate||.8,elitismRate:e.elitismRate||.1,fitnessWeights:{gini:.2,balance:.15,motif:.25,dissonance:.2,rhythmic:.2,...e.fitnessWeights},scale:e.scale||[0,2,4,5,7,9,11],durations:e.durations||["4n","8n","2n","16n"],lengthRange:e.lengthRange||[8,16]},this.population=[],this.generation=0,this.bestFitness=-1/0,this.bestIndividual=null}initializePopulation(){this.population=[];for(let e=0;e<this.options.populationSize;e++){const t=this.createRandomIndividual();this.population.push(t)}this.evaluatePopulation()}evolve(){this.initializePopulation();for(let e=0;e<this.options.generations;e++){this.generation=e;const t=this.createNextGeneration();this.population=t,this.evaluatePopulation();const r=this.getBestIndividual();r.fitness>this.bestFitness&&(this.bestFitness=r.fitness,this.bestIndividual={...r})}return this.getBestIndividual()}createRandomIndividual(){const e=Math.floor(Math.random()*(this.options.lengthRange[1]-this.options.lengthRange[0]+1))+this.options.lengthRange[0],t=[];let r=0;for(let n=0;n<e;n++){const i=this.randomPitch(),s=this.randomDuration();t.push({note:i,time:`${Math.floor(r)}:${Math.floor(r%1*4)}:0`,duration:s,velocity:Math.random()*.5+.5}),r+=this.parseDuration(s)}return{genes:t,fitness:0,age:0}}randomPitch(){const e=Math.floor(Math.random()*3)+4,t=this.options.scale[Math.floor(Math.random()*this.options.scale.length)];return 12*e+t}randomDuration(){return this.options.durations[Math.floor(Math.random()*this.options.durations.length)]}parseDuration(e){return{"1n":4,"2n":2,"4n":1,"8n":.5,"16n":.25,"32n":.125}[e]||1}evaluatePopulation(){for(const e of this.population)e.fitness=this.calculateFitness(e.genes);this.population.sort((e,t)=>t.fitness-e.fitness)}calculateFitness(e){const t=Ln.analyze(e,{scale:this.options.scale});let r=0;const n=this.options.fitnessWeights;r+=(n.gini||0)*(1-t.gini),r+=(n.balance||0)*(1-Math.abs(t.balance-60)/60),r+=(n.motif||0)*t.motif,r+=(n.dissonance||0)*(1-t.dissonance),r+=(n.rhythmic||0)*t.rhythmic;const i=e.length;return(i<this.options.lengthRange[0]||i>this.options.lengthRange[1])&&(r*=.5),Math.max(0,r)}createNextGeneration(){const e=[],t=Math.floor(this.options.populationSize*this.options.elitismRate);for(let r=0;r<t;r++){const n={...this.population[r]};n.age++,e.push(n)}for(;e.length<this.options.populationSize;){const r=this.selectParent(),n=this.selectParent();let i,s;Math.random()<this.options.crossoverRate?[i,s]=this.crossover(r,n):(i={...r},s={...n}),Math.random()<this.options.mutationRate&&this.mutate(i),Math.random()<this.options.mutationRate&&this.mutate(s),i.age=0,s.age=0,e.push(i),e.length<this.options.populationSize&&e.push(s)}return e}selectParent(){const t=[];for(let r=0;r<3;r++){const n=Math.floor(Math.random()*this.population.length);t.push(this.population[n])}return t.sort((r,n)=>n.fitness-r.fitness),{...t[0]}}crossover(e,t){const r=Math.min(e.genes.length,t.genes.length),n=Math.floor(Math.random()*r),i={genes:[...e.genes.slice(0,n),...t.genes.slice(n)],fitness:0,age:0},s={genes:[...t.genes.slice(0,n),...e.genes.slice(n)],fitness:0,age:0};return[i,s]}mutate(e){const t=e.genes,r=Math.random();if(r<.3){const n=Math.floor(Math.random()*t.length);t[n].pitch=this.randomPitch()}else if(r<.6){const n=Math.floor(Math.random()*t.length);t[n].duration=this.randomDuration()}else if(r<.8){const n=Math.floor(Math.random()*t.length);t[n].velocity=Math.random()*.5+.5}else if(Math.random()<.5&&t.length<this.options.lengthRange[1]){const n=Math.floor(Math.random()*(t.length+1)),i={pitch:this.randomPitch(),time:"0:0:0",duration:this.randomDuration(),velocity:Math.random()*.5+.5};t.splice(n,0,i)}else if(t.length>this.options.lengthRange[0]){const n=Math.floor(Math.random()*t.length);t.splice(n,1)}this.recalculateTiming(e)}recalculateTiming(e){let t=0;for(const r of e.genes)r.time=`${Math.floor(t)}:${Math.floor(t%1*4)}:0`,t+=this.parseDuration(r.duration)}getBestIndividual(){return{...this.population[0]}}getStatistics(){const e=this.population.map(i=>i.fitness),t=e.reduce((i,s)=>i+s,0)/e.length,r=Math.max(...e),n=Math.min(...e);return{generation:this.generation,avgFitness:t,maxFitness:r,minFitness:n,bestAllTime:this.bestFitness,populationSize:this.population.length}}setCustomFitness(e){this.calculateFitness=e}}class ko{options;walkers;history;constructor(e={}){this.options={length:e.length||100,dimensions:e.dimensions||1,stepSize:e.stepSize||1,bounds:e.bounds||[-100,100],branchProbability:e.branchProbability||.05,mergeProbability:e.mergeProbability||.02,attractorStrength:e.attractorStrength||0,attractorPosition:e.attractorPosition||Array(e.dimensions||1).fill(0)},this.walkers=[],this.history=[]}generate(e){this.initialize(e),this.history=[];for(let t=0;t<this.options.length;t++)this.updateWalkers(),this.recordState(),this.handleBranching(),this.handleMerging();return this.history}initialize(e){const t=e||Array(this.options.dimensions).fill(0);this.walkers=[{position:[...t],velocity:Array(this.options.dimensions).fill(0),branches:[],age:0,active:!0}]}updateWalkers(){for(const e of this.walkers)if(e.active){for(let t=0;t<this.options.dimensions;t++){const r=(Math.random()-.5)*2*this.options.stepSize;let n=0;if(this.options.attractorStrength>0){const i=e.position[t]-this.options.attractorPosition[t];n=-this.options.attractorStrength*i}e.velocity[t]=e.velocity[t]*.9+r+n,e.position[t]+=e.velocity[t],e.position[t]<this.options.bounds[0]?(e.position[t]=this.options.bounds[0],e.velocity[t]*=-.5):e.position[t]>this.options.bounds[1]&&(e.position[t]=this.options.bounds[1],e.velocity[t]*=-.5)}e.age++}}recordState(){const e=this.walkers.filter(t=>t.active);if(e.length>0){const t=Array(this.options.dimensions).fill(0);for(const r of e)for(let n=0;n<this.options.dimensions;n++)t[n]+=r.position[n];for(let r=0;r<this.options.dimensions;r++)t[r]/=e.length;this.history.push([...t])}}handleBranching(){const e=[];for(const t of this.walkers)if(t.active&&Math.random()<this.options.branchProbability){const r={position:[...t.position],velocity:t.velocity.map(n=>n+(Math.random()-.5)*this.options.stepSize),branches:[],age:0,active:!0};e.push(r),t.branches.push(r)}this.walkers.push(...e)}handleMerging(){if(this.walkers.length<=1)return;const e=this.walkers.filter(r=>r.active),t=this.options.stepSize*2;for(let r=0;r<e.length;r++)for(let n=r+1;n<e.length;n++)if(Math.random()<this.options.mergeProbability&&this.calculateDistance(e[r].position,e[n].position)<t){for(let s=0;s<this.options.dimensions;s++)e[r].position[s]=(e[r].position[s]+e[n].position[s])/2,e[r].velocity[s]=(e[r].velocity[s]+e[n].velocity[s])/2;e[n].active=!1}this.walkers=this.walkers.filter(r=>r.active)}calculateDistance(e,t){let r=0;for(let n=0;n<e.length;n++)r+=Math.pow(e[n]-t[n],2);return Math.sqrt(r)}getProjection(e=0){return this.history.map(t=>t[e]||0)}mapToScale(e=0,t=[0,2,4,5,7,9,11],r=3){const n=this.getProjection(e);if(n.length===0)return[];const i=Math.min(...n),a=Math.max(...n)-i||1;return n.map(c=>{const u=(c-i)/a,d=Math.floor(u*t.length*r),g=Math.floor(d/t.length),$=d%t.length;return 60+g*12+t[$]})}mapToRhythm(e=0,t=[.25,.5,1,2]){const r=this.getProjection(e);if(r.length===0)return[];const n=Math.min(...r),s=Math.max(...r)-n||1;return r.map(a=>{const c=(a-n)/s,u=Math.floor(c*t.length),d=Math.max(0,Math.min(u,t.length-1));return t[d]})}mapToVelocity(e=0,t=.3,r=1){const n=this.getProjection(e);if(n.length===0)return[];const i=Math.min(...n),a=Math.max(...n)-i||1;return n.map(c=>{const u=(c-i)/a;return t+u*(r-t)})}generateCorrelated(e,t=.5,r=0){if(e.length===0)return[];const n=[];let i=0;for(let s=0;s<e.length;s++){const a=(Math.random()-.5)*2*this.options.stepSize,c=t*(e[s]-i);i+=a+c,i=Math.max(this.options.bounds[0],Math.min(this.options.bounds[1],i)),n.push(i)}return n}analyze(){if(this.history.length<2)return{meanDisplacement:0,meanSquaredDisplacement:0,totalDistance:0,fractalDimension:0};const e=this.getProjection(0),t=e[0],r=e[e.length-1],n=Math.abs(r-t),i=e.map(u=>Math.pow(u-t,2)),s=i.reduce((u,d)=>u+d,0)/i.length;let a=0;for(let u=1;u<e.length;u++)a+=Math.abs(e[u]-e[u-1]);const c=a>0?Math.log(a)/Math.log(e.length):0;return{meanDisplacement:n,meanSquaredDisplacement:s,totalDistance:a,fractalDimension:c}}getWalkerStates(){return this.walkers.map(e=>({...e}))}reset(){this.walkers=[],this.history=[]}}class xo{constructor(e={}){this.width=e.width||100,this.height=e.height||100,this.maxIterations=e.maxIterations||100,this.xMin=e.xMin||-2.5,this.xMax=e.xMax||1.5,this.yMin=e.yMin||-2,this.yMax=e.yMax||2}generate(){const e=[];for(let t=0;t<this.height;t++){const r=[];for(let n=0;n<this.width;n++){const i=this.xMin+n/this.width*(this.xMax-this.xMin),s=this.yMin+t/this.height*(this.yMax-this.yMin),a=this.mandelbrotIterations({real:i,imaginary:s});r.push(a)}e.push(r)}return e}extractSequence(e="diagonal",t=0){const r=this.generate();switch(e){case"diagonal":return this.extractDiagonal(r);case"border":return this.extractBorder(r);case"spiral":return this.extractSpiral(r);case"column":return this.extractColumn(r,t);case"row":return this.extractRow(r,t);default:return this.extractDiagonal(r)}}mandelbrotIterations(e){let t={real:0,imaginary:0};for(let r=0;r<this.maxIterations;r++){const n=t.real*t.real-t.imaginary*t.imaginary+e.real,i=2*t.real*t.imaginary+e.imaginary;if(t.real=n,t.imaginary=i,t.real*t.real+t.imaginary*t.imaginary>4)return r}return this.maxIterations}extractDiagonal(e){const t=[],r=Math.min(e.length,e[0]?.length||0);for(let n=0;n<r;n++)t.push(e[n][n]);return t}extractBorder(e){const t=[],r=e.length,n=e[0]?.length||0;if(r===0||n===0)return t;for(let i=0;i<n;i++)t.push(e[0][i]);for(let i=1;i<r;i++)t.push(e[i][n-1]);if(r>1)for(let i=n-2;i>=0;i--)t.push(e[r-1][i]);if(n>1)for(let i=r-2;i>0;i--)t.push(e[i][0]);return t}extractSpiral(e){const t=[],r=e.length,n=e[0]?.length||0;if(r===0||n===0)return t;let i=0,s=r-1,a=0,c=n-1;for(;i<=s&&a<=c;){for(let u=a;u<=c;u++)t.push(e[i][u]);i++;for(let u=i;u<=s;u++)t.push(e[u][c]);if(c--,i<=s){for(let u=c;u>=a;u--)t.push(e[s][u]);s--}if(a<=c){for(let u=s;u>=i;u--)t.push(e[u][a]);a++}}return t}extractColumn(e,t){const r=[],n=e[0]?.length||0,i=Math.max(0,Math.min(t,n-1));for(const s of e)s[i]!==void 0&&r.push(s[i]);return r}extractRow(e,t){const r=Math.max(0,Math.min(t,e.length-1));return e[r]?[...e[r]]:[]}mapToScale(e,t=[0,2,4,5,7,9,11],r=3){if(e.length===0)return[];const n=Math.min(...e),s=Math.max(...e)-n||1;return e.map(a=>{const c=(a-n)/s,u=Math.floor(c*t.length*r),d=Math.floor(u/t.length),g=u%t.length;return 60+d*12+t[g]})}mapToRhythm(e,t=[1,2,4,8,16]){if(e.length===0)return[];const r=Math.min(...e),i=Math.max(...e)-r||1;return e.map(s=>{const a=(s-r)/i,c=Math.floor(a*t.length),u=Math.max(0,Math.min(c,t.length-1));return 1/t[u]})}}class Ao{constructor(e={}){this.r=e.r||3.8,this.x0=e.x0||.5,this.iterations=e.iterations||1e3,this.skipTransient=e.skipTransient||100}generate(){const e=[];let t=this.x0;for(let r=0;r<this.iterations+this.skipTransient;r++)t=this.r*t*(1-t),r>=this.skipTransient&&e.push(t);return e}bifurcationDiagram(e=2.5,t=4,r=1e3){const n=[],i=[],s=(t-e)/r;for(let a=0;a<r;a++){const c=e+a*s,u=this.r;this.r=c;const d=this.generate();this.r=u;const g=d.slice(-50);for(const $ of g)n.push(c),i.push($)}return{r:n,x:i}}mapToScale(e,t=[0,2,4,5,7,9,11],r=3){return e.length===0?[]:e.map(n=>{const i=Math.floor(n*t.length*r),s=Math.floor(i/t.length),a=i%t.length;return 60+s*12+t[a]})}mapToRhythm(e,t=[.25,.5,1,2]){return e.length===0?[]:e.map(r=>{const n=Math.floor(r*t.length),i=Math.max(0,Math.min(n,t.length-1));return t[i]})}mapToVelocity(e,t=.3,r=1){if(e.length===0)return[];const n=r-t;return e.map(i=>t+i*n)}detectCycles(e,t=.01){const r=[];for(let n=1;n<=Math.floor(e.length/2);n++){let i=!0;for(let s=n;s<Math.min(e.length,n*3);s++)if(Math.abs(e[s]-e[s-n])>t){i=!1;break}i&&r.push(n)}return r}lyapunovExponent(e=1e4){let t=this.x0,r=0;for(let n=0;n<e;n++){const i=this.r*(1-2*t);r+=Math.log(Math.abs(i)),t=this.r*t*(1-t)}return r/e}generateCoupled(e=2,t=.1){const r=Array(e).fill(null).map(()=>[]),n=Array(e).fill(this.x0);for(let i=0;i<this.iterations+this.skipTransient;i++){const s=[...n];for(let a=0;a<e;a++){let c=0;for(let u=0;u<e;u++)u!==a&&(c+=t*(n[u]-n[a]));s[a]=this.r*n[a]*(1-n[a])+c,s[a]=Math.max(0,Math.min(1,s[a]))}if(n.splice(0,e,...s),i>=this.skipTransient)for(let a=0;a<e;a++)r[a].push(n[a])}return r}setRegime(e,t){switch(e){case"periodic":this.r=3.2;break;case"chaotic":this.r=3.9;break;case"edge":this.r=3.57;break;case"custom":t!==void 0&&(this.r=Math.max(0,Math.min(4,t)));break}}getParameters(){return{r:this.r,x0:this.x0,iterations:this.iterations,skipTransient:this.skipTransient}}}class No{operation;direction;repetition;sequence=[];constructor(e){const{operation:t,direction:r,repetition:n}=e;if(!["additive","subtractive"].includes(t))throw new Error("Invalid operation. Choose 'additive' or 'subtractive'.");if(!["forward","backward","inward","outward"].includes(r))throw new Error("Invalid direction. Choose 'forward', 'backward', 'inward' or 'outward'.");if(n<0||!Number.isInteger(n))throw new Error("Invalid repetition value. Must be an integer greater than or equal to 0.");this.operation=t,this.direction=r,this.repetition=n}generate(e){this.sequence=e;let t;if(this.operation==="additive"&&this.direction==="forward")t=this.additiveForward();else if(this.operation==="additive"&&this.direction==="backward")t=this.additiveBackward();else if(this.operation==="additive"&&this.direction==="inward")t=this.additiveInward();else if(this.operation==="additive"&&this.direction==="outward")t=this.additiveOutward();else if(this.operation==="subtractive"&&this.direction==="forward")t=this.subtractiveForward();else if(this.operation==="subtractive"&&this.direction==="backward")t=this.subtractiveBackward();else if(this.operation==="subtractive"&&this.direction==="inward")t=this.subtractiveInward();else if(this.operation==="subtractive"&&this.direction==="outward")t=this.subtractiveOutward();else throw new Error("Invalid operation/direction combination");return this.adjustOffsets(t)}additiveForward(){const e=[];for(let t=0;t<this.sequence.length;t++){const r=this.sequence.slice(0,t+1);for(let n=0;n<=this.repetition;n++)e.push(...r)}return e}additiveBackward(){const e=[];for(let t=this.sequence.length;t>0;t--){const r=this.sequence.slice(t-1);for(let n=0;n<=this.repetition;n++)e.push(...r)}return e}additiveInward(){const e=[],t=this.sequence.length;for(let r=0;r<Math.ceil(t/2);r++){let n;if(r<t-r-1){const i=this.sequence.slice(0,r+1),s=this.sequence.slice(t-r-1);n=[...i,...s]}else n=[...this.sequence];for(let i=0;i<=this.repetition;i++)e.push(...n)}return e}additiveOutward(){const e=[],t=this.sequence.length;if(t%2===0){const r=Math.floor(t/2)-1,n=Math.floor(t/2);for(let i=0;i<t/2;i++){const s=this.sequence.slice(r-i,n+i+1);for(let a=0;a<=this.repetition;a++)e.push(...s)}}else{const r=Math.floor(t/2);for(let n=0;n<=r;n++){const i=this.sequence.slice(r-n,r+n+1);for(let s=0;s<=this.repetition;s++)e.push(...i)}}return e}subtractiveForward(){const e=[];for(let t=0;t<this.sequence.length;t++){const r=this.sequence.slice(t);for(let n=0;n<=this.repetition;n++)e.push(...r)}return e}subtractiveBackward(){const e=[];for(let t=this.sequence.length;t>0;t--){const r=this.sequence.slice(0,t);for(let n=0;n<=this.repetition;n++)e.push(...r)}return e}subtractiveInward(){const e=[],t=this.sequence.length,r=Math.floor(t/2);for(let n=0;n<=this.repetition;n++)e.push(...this.sequence);for(let n=1;n<=r;n++){const i=this.sequence.slice(n,t-n);if(i.length>0)for(let s=0;s<=this.repetition;s++)e.push(...i)}return e}subtractiveOutward(){const e=[];let t=[...this.sequence];for(let r=0;r<=this.repetition;r++)e.push(...t);for(;t.length>2;){t=t.slice(1,-1);for(let r=0;r<=this.repetition;r++)e.push(...t)}return e}adjustOffsets(e){let t=0;return e.map(r=>{const n={...r,offset:t};return t+=r.duration,n})}}class Ro{tChord;direction;rank;isAlternate;currentDirection;constructor(e,t="down",r=0){if(!["up","down","any","alternate"].includes(t))throw new Error("Invalid direction. Choose 'up', 'down', 'any' or 'alternate'.");if(this.tChord=e,this.isAlternate=t==="alternate",this.currentDirection=this.isAlternate?"up":t,this.direction=t,!Number.isInteger(r)||r<0)throw new Error("Rank must be a non-negative integer.");this.rank=Math.min(r,e.length-1),this.rank>=e.length&&console.warn("Rank exceeds the length of the t-chord. Using last note of the t-chord.")}generate(e){const t=[];for(const r of e){if(r.pitch===void 0){t.push({...r,pitch:void 0});continue}const n=r.pitch,s=this.tChord.map(u=>u-n).map((u,d)=>({index:d,value:u})).sort((u,d)=>Math.abs(u.value)-Math.abs(d.value));let a=this.rank,c;if(this.currentDirection==="up"||this.currentDirection==="down"){const u=s.filter(({value:d})=>this.currentDirection==="up"?d>=0:d<=0);if(u.length===0)c=this.currentDirection==="up"?Math.max(...this.tChord):Math.min(...this.tChord);else{a>=u.length&&(a=u.length-1);const d=u[a].index;c=this.tChord[d]}}else{a>=s.length&&(a=s.length-1);const u=s[a].index;c=this.tChord[u]}this.isAlternate&&(this.currentDirection=this.currentDirection==="up"?"down":"up"),t.push({...r,pitch:c})}return t}}const jo=Object.freeze(Object.defineProperty({__proto__:null,MusicalAnalysis:Ln},Symbol.toStringTag,{value:"Module"})),Co={harmony:yo,rhythm:_o,motifs:{MotifBank:Po}},Oo={theory:de},Io={gaussian:{Regressor:Eo},automata:{Cellular:To},loops:jt,genetic:{Algorithm:Mo},walks:{Random:ko},fractals:{Mandelbrot:xo,LogisticMap:Ao},minimalism:{Process:No,Tintinnabuli:Ro}},qo={...jo},Do={...ho},ze={theory:Co,constants:Oo,generative:Io,analysis:qo,utils:Do};class ir{constructor(e={}){this.options=e}static parseBBTToBeats(e,t=4,r=480){if(typeof e=="number")return e;if(typeof e!="string")return 0;const n=e.match(/^(\d+):(\d+(?:\.\d+)?):(\d+)$/);if(!n)return 0;const i=parseInt(n[1],10),s=parseFloat(n[2]),a=parseInt(n[3],10);return i*t+s+a/r}static parseDurationToBeats(e,t=4,r=480){if(typeof e=="number")return e;if(typeof e!="string")return 0;if(/^\d+:\d+(?:\.\d+)?:\d+$/.test(e))return this.parseBBTToBeats(e,t,r);const n=e.match(/^(\d+)(n|t)$/);if(n){const i=parseInt(n[1],10),s=n[2];if(s==="n")return 4/i;if(s==="t")return 4/i*(2/3)}return 0}convert(e){return(e.tracks||[]).map(r=>({label:r.label,type:"PolySynth",part:(r.notes||[]).map(n=>({time:n.time,pitch:n.pitch,duration:n.duration,velocity:n.velocity||.8}))}))}}function Un(o,e={}){try{Nn(o)}catch{}const n=new ir(e).convert(o).map(($,P)=>({originalTrackIndex:P,voiceIndex:0,totalVoices:1,trackInfo:{label:$.label},synthConfig:{type:$.type||"PolySynth"},partEvents:$.part||[]})),i=o.metadata?.tempo||o.bpm||120,[s,a]=(o.timeSignature||"4/4").split("/").map($=>parseInt($,10)),c=isFinite(s)?s:4;let u=0;n.forEach($=>{$.partEvents&&$.partEvents.length>0&&$.partEvents.forEach(P=>{const E=ir.parseBBTToBeats(P.time,c),w=ir.parseDurationToBeats(P.duration,c),p=E+w;p>u&&(u=p)})});const d=60/i,g=u*d;return{tracks:n,metadata:{totalDuration:g,tempo:i}}}function or(o,e={}){if(!o||typeof o!="object")throw console.error("[PLAYER] Invalid composition:",o),new Error("Composition must be a valid JMON object");const{autoplay:t=!1,showDebug:r=!1,customInstruments:n={},autoMultivoice:i=!0,maxVoices:s=4}=e;if(!o.sequences&&!o.tracks)throw console.error("[PLAYER] No sequences or tracks found in composition:",o),new Error("Composition must have sequences or tracks");const a=o.tracks||o.sequences||[];if(!Array.isArray(a))throw console.error("[PLAYER] Tracks/sequences must be an array:",a),new Error("Tracks/sequences must be an array");const c=o.bpm||120,d=Un(o,{autoMultivoice:i,maxVoices:s,showDebug:r}),{tracks:g,metadata:$}=d;let P=$.totalDuration;const E={background:"#FFFFFF",primary:"#333",secondary:"#F0F0F0",text:"#000000",lightText:"#666666",border:"#CCCCCC"},w=document.createElement("div");w.style.cssText=`
        font-family: 'PT Sans', sans-serif;
        background-color: ${E.background};
        color: ${E.text};
        padding: 20px;
        border-radius: 12px;
        width: 400px;
        border: 1px solid ${E.border};
        box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
    `;const p=document.createElement("div");p.style.cssText=`
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        font-family: 'PT Sans', sans-serif;
    `;const h=document.createElement("div");h.style.cssText=`
        display: flex;
        flex-direction: column;
        width: 60%;
    `;const l=document.createElement("div");l.style.cssText=`
        display: flex;
        flex-direction: column;
    `;const f=["Sampler","PolySynth","Synth","AMSynth","DuoSynth","FMSynth","MembraneSynth","MetalSynth","MonoSynth","PluckSynth"],m=o.tracks||o.sequences||[],b=[];m.forEach((S,k)=>{const j=g.find(Z=>Z.originalTrackIndex===k)?.analysis;j?.hasGlissando&&console.warn(`Track ${S.label||S.name||k+1} contient un glissando : la polyphonie sera dsactive pour cette piste.`);const O=document.createElement("div");O.style.cssText=`
            margin-bottom: 8px;
        `;const D=document.createElement("label");D.textContent=S.name||S.label||`Track ${k+1}`,D.style.cssText=`
            font-family: 'PT Sans', sans-serif;
            font-size: 16px;
            color: ${E.text};
            display: block;
            margin-bottom: 8px;
            font-weight: normal;
        `;const U=document.createElement("select");U.style.cssText=`
            padding: 4px;
            border: 1px solid ${E.secondary};
            border-radius: 4px;
            background-color: ${E.background};
            color: ${E.text};
            font-size: 12px;
            width: 100%;
            height: 28px;
            box-sizing: border-box;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            margin: 0;
            outline: none;
        `,f.forEach(Z=>{const te=document.createElement("option");te.value=Z,te.textContent=Z,o.tracks?.[k]?.synthRef&&Z==="Sampler"&&(te.selected=!0),j?.hasGlissando&&(Z==="PolySynth"||Z==="DuoSynth")&&(te.disabled=!0,te.textContent+=" (mono only for glissando)"),U.appendChild(te)}),b.push(U),O.append(D,U),l.appendChild(O)}),h.appendChild(l);const v=document.createElement("div");v.style.cssText=`
        display: flex;
        flex-direction: column;
        width: 35%;
    `;const _=document.createElement("div");_.style.cssText=`
        display: flex;
        flex-direction: column;
        width: 100%;
    `;const M=document.createElement("label");M.textContent="Tempo",M.style.cssText=`
        font-family: 'PT Sans', sans-serif;
        font-size: 16px;
        font-weight: normal;
        margin-bottom: 8px;
        color: ${E.text};
    `;const N=document.createElement("input");N.type="number",N.min=60,N.max=240,N.value=c,N.style.cssText=`
        padding: 4px;
        border: 1px solid ${E.secondary};
        border-radius: 4px;
        background-color: ${E.background};
        color: ${E.text};
        font-size: 12px;
        text-align: center;
        width: 100%;
        height: 28px;
        box-sizing: border-box;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        margin: 0;
        outline: none;
    `,_.append(M,N),v.appendChild(_);const q=document.createElement("div");q.style.cssText=`
        position: relative;
        width: 100%;
        margin: 20px 0;
        display: flex;
        align-items: center;
        gap: 15px;
    `;const z=document.createElement("div");z.textContent="0:00",z.style.cssText=`
        font-family: 'PT Sans', sans-serif;
        font-size: 14px;
        color: ${E.text};
        min-width: 40px;
        text-align: center;
    `;const G=document.createElement("div");G.textContent="0:00",G.style.cssText=`
        font-family: 'PT Sans', sans-serif;
        font-size: 14px;
        color: ${E.text};
        min-width: 40px;
        text-align: center;
    `;const L=document.createElement("input");L.type="range",L.min=0,L.max=100,L.value=0,L.style.cssText=`
        flex-grow: 1;
        -webkit-appearance: none;
        background: ${E.secondary};
        outline: none;
        border-radius: 15px;
        overflow: visible;
        height: 8px;
    `;const H=document.createElement("button");H.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-play"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg>',H.style.cssText=`
        width: 40px;
        height: 40px;
        padding: 10px;
        border: none;
        border-radius: 50%;
        background-color: ${E.primary};
        color: ${E.background};
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0px 10px 0px 10px;
    `;const ce=document.createElement("div");ce.style.cssText=`
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        color: ${E.lightText};
        margin: 0px 0px 0px 10px;
    `,q.append(z,L,G,H);const me=document.createElement("div");me.style.cssText=`
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
    `;const ye=document.createElement("button");ye.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-keyboard-music" style="margin-right: 5px;"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="M6 8h4"/><path d="M14 8h.01"/><path d="M18 8h.01"/><path d="M2 12h20"/><path d="M6 12v4"/><path d="M10 12v4"/><path d="M14 12v4"/><path d="M18 12v4"/></svg><span>MIDI</span>',ye.style.cssText=`
        padding: 15px 30px;
        margin: 0 5px;
        border: none;
        border-radius: 8px;
        background-color: #333333;
        color: white;
        font-family: 'PT Sans', sans-serif;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.3s ease;
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 50px;
    `;const ee=document.createElement("button");ee.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-audio-lines" style="margin-right: 5px;"><path d="M2 10v3"/><path d="M6 6v11"/><path d="M10 3v18"/><path d="M14 8v7"/><path d="M18 5v13"/><path d="M22 10v3"/></svg><span>WAV</span>',ee.style.cssText=`
        padding: 15px 30px;
        margin: 0 5px;
        border: none;
        border-radius: 8px;
        background-color: #333333;
        color: white;
        font-family: 'PT Sans', sans-serif;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.3s ease;
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 50px;
    `,me.append(ye,ee),p.append(h,v),w.append(p,q,ce,me);let V,I=!1,x=[],C=[],A=[],y=null;const T=o.tracks||o.sequences||[],R=()=>{if(!V||!o.audioGraph||!Array.isArray(o.audioGraph))return null;const S={},k=j=>{const O={};return Object.entries(j||{}).forEach(([D,U])=>{let Z=D;if(typeof D=="number"||/^\d+$/.test(String(D)))try{Z=V.Frequency(parseInt(D,10),"midi").toNote()}catch{}O[Z]=U}),O};try{return o.audioGraph.forEach(j=>{const{id:O,type:D,options:U={},target:Z}=j;if(!O||!D)return;let te=null;if(D==="Sampler"){const oe=k(U.urls);let le,se;const ae=new Promise((re,K)=>{le=re,se=K}),ue={urls:oe,onload:()=>le&&le(),onerror:re=>{console.error(`[PLAYER] Sampler load error for ${O}:`,re),se&&se(re)}};U.baseUrl&&(ue.baseUrl=U.baseUrl);try{console.log(`[PLAYER] Building Sampler ${O} with urls:`,oe,"baseUrl:",ue.baseUrl||"(none)"),te=new V.Sampler(ue).toDestination()}catch(re){console.error("[PLAYER] Failed to create Sampler:",re),te=null}A.push(ae),te&&U.envelope&&U.envelope.enabled&&(typeof U.envelope.attack=="number"&&(te.attack=U.envelope.attack),typeof U.envelope.release=="number"&&(te.release=U.envelope.release))}else if(["Synth","PolySynth","MonoSynth","AMSynth","FMSynth","DuoSynth","PluckSynth","NoiseSynth"].includes(D))try{te=new V[D](U).toDestination()}catch(oe){console.warn(`[PLAYER] Failed to create ${D} from audioGraph, using PolySynth:`,oe),te=new V.PolySynth().toDestination()}else D==="Destination"&&(S[O]=V.Destination);te&&(S[O]=te)}),S}catch(j){return console.error("[PLAYER] Failed building audioGraph instruments:",j),null}},F=S=>`${Math.floor(S/60)}:${Math.floor(S%60).toString().padStart(2,"0")}`;G.textContent=F(P);const B=async()=>{if(typeof window<"u"){if(!window.Tone)try{if(typeof require<"u")window.Tone=await require("https://unpkg.com/tone@14.8.49/build/Tone.js");else{const S=await import("https://unpkg.com/tone@14.8.49/build/Tone.js");window.Tone=S.default||S}}catch(S){return console.warn("Could not auto-load Tone.js:",S.message),console.log("To use the player, load Tone.js manually first:"),console.log('Tone = await require("https://unpkg.com/tone@14.8.49/build/Tone.js")'),!1}if(window.Tone){V=window.Tone;try{return(V.context.state==="suspended"||V.context.state==="interrupted")&&await V.context.resume(),V.context.state!=="running"&&(await V.start(),navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&await new Promise(S=>setTimeout(S,100))),V.context.state==="running"}catch(S){return console.error("[PLAYER] Failed to initialize audio context:",S),!1}}}return console.warn("Tone.js not available"),!1},X=()=>{if(V){if(!y&&(y=R(),y)){const S=Object.keys(y).filter(k=>y[k]&&y[k].name==="Sampler");S.length>0&&console.log("[PLAYER] Using audioGraph Samplers for tracks with synthRef:",S)}x.forEach(S=>{if(!y||!Object.values(y).includes(S))try{S.dispose()}catch{}}),C.forEach(S=>{S.stop(),S.dispose()}),x=[],C=[],console.log("[PLAYER] Converted tracks:",g.length),g.forEach(S=>{const{originalTrackIndex:k,voiceIndex:j,totalVoices:O,trackInfo:D,synthConfig:U,partEvents:Z}=S,oe=(T[k]||{}).synthRef,le=60/$.tempo,se=(Z||[]).map(re=>{const K=typeof re.time=="number"?re.time*le:re.time,ie=typeof re.duration=="number"?re.duration*le:re.duration;return{...re,time:K,duration:ie}});let ae=null;if(oe&&y&&y[oe])ae=y[oe];else{const re=b[k]?b[k].value:U.type;try{const K=U.reason==="glissando_compatibility"?U.type:re;ae=new V[K]().toDestination(),U.reason==="glissando_compatibility"&&j===0&&console.warn(`[MULTIVOICE] Using ${K} instead of ${U.original} for glissando in ${D.label}`)}catch(K){console.warn(`Failed to create ${re}, using PolySynth:`,K),ae=new V.PolySynth().toDestination()}}x.push(ae),O>1&&console.log(`[MULTIVOICE] Track "${D.label}" voice ${j+1}: ${Z.length} notes`);const ue=new V.Part((re,K)=>{if(Array.isArray(K.pitch))K.pitch.forEach(ie=>{let fe="C4";typeof ie=="number"?fe=V.Frequency(ie,"midi").toNote():typeof ie=="string"?fe=ie:Array.isArray(ie)&&typeof ie[0]=="string"&&(fe=ie[0]),ae.triggerAttackRelease(fe,K.duration,re)});else if(K.articulation==="glissando"&&K.glissTarget!==void 0){let ie=typeof K.pitch=="number"?V.Frequency(K.pitch,"midi").toNote():K.pitch,fe=typeof K.glissTarget=="number"?V.Frequency(K.glissTarget,"midi").toNote():K.glissTarget;console.log("[PLAYER] Glissando",{fromNote:ie,toNote:fe,duration:K.duration,time:re}),console.log("[PLAYER] Glissando effect starting from",ie,"to",fe),ae.triggerAttack(ie,re,K.velocity||.8);const ve=V.Frequency(ie).toFrequency(),Fe=V.Frequency(fe).toFrequency(),It=1200*Math.log2(Fe/ve);if(ae.detune&&ae.detune.setValueAtTime&&ae.detune.linearRampToValueAtTime)ae.detune.setValueAtTime(0,re),ae.detune.linearRampToValueAtTime(It,re+K.duration),console.log("[PLAYER] Applied detune glissando:",It,"cents over",K.duration,"beats");else{const es=V.Frequency(ie).toMidi(),ts=V.Frequency(fe).toMidi(),qt=Math.max(3,Math.abs(ts-es)),Xn=K.duration/qt;for(let Dt=1;Dt<qt;Dt++){const rs=Dt/(qt-1),ns=ve*Math.pow(Fe/ve,rs),is=V.Frequency(ns).toNote(),os=re+Dt*Xn;ae.triggerAttackRelease(is,Xn*.8,os,(K.velocity||.8)*.7)}console.log("[PLAYER] Applied chromatic glissando with",qt,"steps")}ae.triggerRelease(re+K.duration)}else{let ie="C4";typeof K.pitch=="number"?ie=V.Frequency(K.pitch,"midi").toNote():typeof K.pitch=="string"?ie=K.pitch:Array.isArray(K.pitch)&&typeof K.pitch[0]=="string"&&(ie=K.pitch[0]);let fe=K.duration,ve=K.velocity||.8;K.articulation==="staccato"&&(fe=K.duration*.5),K.articulation==="accent"&&(ve=Math.min(ve*2,1)),K.articulation==="tenuto"&&(fe=K.duration*1.5,ve=Math.min(ve*1.3,1)),ae.triggerAttackRelease(ie,fe,re,ve)}},se);ue.start(0),C.push(ue)}),V.Transport.bpm.value=$.tempo,V.Transport.loopEnd=P,V.Transport.loop=!0,V.Transport.stop(),V.Transport.position=0,G.textContent=F(P)}},Y=()=>{if(V&&I){const S=typeof V.Transport.loopEnd=="number"?V.Transport.loopEnd:V.Time(V.Transport.loopEnd).toSeconds(),k=V.Transport.seconds%S,j=k/S*100;L.value=Math.min(j,100),z.textContent=F(k),G.textContent=F(S),V.Transport.state==="started"&&I?requestAnimationFrame(Y):V.Transport.state==="stopped"&&(V.Transport.seconds=0,L.value=0,z.textContent=F(0),I=!1,H.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-play"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg>')}};if(H.addEventListener("click",async()=>{if(!V)if(await B())X();else{console.error("[PLAYER] Failed to initialize Tone.js");return}if(I)V.Transport.stop(),I=!1,H.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-play"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg>';else{if(V.context.state!=="running"&&(await V.start(),console.log("[PLAYER] Audio context started:",V.context.state)),x.length===0&&(console.log("[PLAYER] No synths found, setting up audio..."),X()),V.Transport.stop(),V.Transport.position=0,console.log("[PLAYER] Transport state before start:",V.Transport.state),console.log("[PLAYER] Transport position reset to:",V.Transport.position),console.log("[PLAYER] Audio context state:",V.context.state),console.log("[PLAYER] Parts count:",C.length),console.log("[PLAYER] Synths count:",x.length),y){const S=Object.values(y).filter(k=>k&&k.name==="Sampler");if(S.length>0&&A.length>0){console.log(`[PLAYER] Waiting for ${S.length} sampler(s) to load...`);try{await Promise.all(A),console.log("[PLAYER] All samplers loaded.")}catch(k){console.warn("[PLAYER] Sampler load wait error:",k);return}}}V.Transport.start(),I=!0,H.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-pause"><circle cx="12" cy="12" r="10"/><line x1="10" x2="10" y1="15" y2="9"/><line x1="14" x2="14" y1="15" y2="9"/></svg>',Y()}}),L.addEventListener("input",()=>{if(V&&P>0){const S=L.value/100*P;V.Transport.seconds=S,z.textContent=F(S)}}),N.addEventListener("change",()=>{const S=parseInt(N.value);V&&S>=60&&S<=240?V.Transport.bpm.value=S:N.value=V?V.Transport.bpm.value:c}),b.forEach(S=>{S.addEventListener("change",()=>{V&&x.length>0&&X()})}),ye.addEventListener("click",()=>{console.log("MIDI download - requires MIDI converter implementation")}),ee.addEventListener("click",()=>{console.log("WAV download - requires WAV generator implementation")}),typeof window<"u"&&window.Tone&&B().then(()=>{X(),t&&setTimeout(()=>{H.click()},500)}),t&&!window.Tone){const S=setInterval(()=>{window.Tone&&(clearInterval(S),setTimeout(()=>{H.click()},500))},100);setTimeout(()=>{clearInterval(S)},1e4)}return w}function sr(o,e=.25,t="nearest"){if(typeof o!="number"||!isFinite(o))return o;const r=o/e;let n;switch(t){case"floor":n=Math.floor(r);break;case"ceil":n=Math.ceil(r);break;case"nearest":default:n=Math.round(r)}return n*e}function Gn(o,{grid:e=.25,fields:t=["time","duration"],mode:r="nearest"}={}){return Array.isArray(o)?o.map(n=>{const i={...n};return t.forEach(s=>{typeof i[s]=="number"&&(i[s]=sr(i[s],e,r))}),i}):o}function Bn(o,{grid:e=.25,mode:t="nearest"}={}){return!o||!Array.isArray(o.notes)?o:{...o,notes:Gn(o.notes,{grid:e,fields:["time","duration"],mode:t})}}function zo(o,{grid:e=.25,mode:t="nearest"}={}){return!o||!Array.isArray(o.tracks)?o:{...o,tracks:o.tracks.map(r=>Bn(r,{grid:e,mode:t}))}}function Kn(o,e=.25){const t=Math.round(1/e),r=Math.round(o/e);return r<=0||r===t?"":r%t===0?String(r/t):`${r}/${t}`}const Ct=Object.freeze(Object.defineProperty({__proto__:null,encodeAbcDuration:Kn,quantize:sr,quantizeComposition:zo,quantizeEvents:Gn,quantizeTrack:Bn},Symbol.toStringTag,{value:"Module"}));class Vo{static fromValidatedJmon(e){const t=new Zt,{valid:r,normalized:n,errors:i}=t.validateAndNormalize(e);if(!r)throw console.warn("JMON non valide pour conversion ABC:",i),new Error("JMON non valide");return this.convertToAbc(n)}static parseTimeString(e,t){if(typeof e=="number")return e;if(typeof e!="string")return 0;try{if(jmonTone&&jmonTone._parseTimeString)return jmonTone._parseTimeString(e,t)}catch{}if(e.includes(":")){const r=e.split(":").map(parseFloat),n=r[0]||0,i=r[1]||0,s=r[2]||0,a=60/t,c=a*4,u=a/480;return n*c+i*a+s*u}if(e.match(/^\d+[nthq]$/)){const r=parseInt(e),n=e.slice(-1),i=60/t;switch(n){case"n":return i*(4/r);case"t":return i*(4/r)*(2/3);case"h":return i*2;case"q":return i;default:return i}}return parseFloat(e)||0}static convertToAbc(e,t={}){let r=`X:1
`;r+=`T:${e.metadata?.title||e.metadata?.name||e.label||"Untitled"}
`,r+=`M:${e.timeSignature||"4/4"}
`,r+=`L:1/4
`,r+=`Q:1/4=${e.bpm||120}
`,r+=`K:${e.keySignature||"C"}
`;const n=e.timeSignature||"4/4",[i,s]=n.split("/").map(Number),a=i*(4/s),c=t.measuresPerLine||4,u=t.lineBreaks||[],d=t.renderMode||"merged",g=t.trackIndex||0,$=!!t.hideRests,P=t.showArticulations!==!1,E=Array.isArray(e.tracks)?e.tracks:Object.values(e.tracks||{});if(E.length===0)return r;const w=(()=>{let h=0;return E.forEach(l=>{const f=l.notes||l;Array.isArray(f)&&f.forEach(m=>{const b=typeof m.time=="number"?m.time:0,v=typeof m.duration=="number"?m.duration:1,_=b+v;_>h&&(h=_)})}),h})(),p=Math.max(1,Math.ceil(w/a));if(d==="tracks"&&E.length>1)r+="%%score {",E.forEach((h,l)=>{l>0&&(r+=" | "),r+=`${l+1}`}),r+=`}
`,E.forEach((h,l)=>{const f=h.notes||h;if(f.length===0)return;const m=l+1,b=h.label||`Track ${l+1}`,v=b.length>12?b.substring(0,10)+"..":b,_=h.instrument?` [${h.instrument}]`:"";r+=`V:${m} name="${b}${_}" snm="${v}"
`;const M=f.filter(q=>q.pitch!==void 0).sort((q,z)=>(q.time||0)-(z.time||0)),{abcNotesStr:N}=this.convertNotesToAbc(M,a,c,u,{hideRests:$,showArticulations:P,padMeasures:p});N.trim()&&(r+=N+`
`)});else if(d==="drums"){r+=`V:1 clef=perc name="Drum Set" snm="Drums"
`;const h=t.percussionMap||{kick:"C,,",snare:"D,",hat:"F","hi-hat":"F",hihat:"F"},l=v=>{const _=(v||"").toLowerCase();for(const M of Object.keys(h))if(_.includes(M))return h[M];return"E"},f=[];E.forEach(v=>{const _=v.notes||v,M=v.label||"",N=l(M);(_||[]).forEach(q=>{q.pitch!==void 0&&f.push({time:typeof q.time=="number"?q.time:0,duration:typeof q.duration=="number"?q.duration:1,pitch:N,articulation:q.articulation})})});const m=f.sort((v,_)=>(v.time||0)-(_.time||0)),{abcNotesStr:b}=this.convertNotesToAbc(m,a,c,u,{hideRests:$,showArticulations:P,padMeasures:p});b.trim()&&(r+=b+`
`)}else if(d==="single"){const h=E[g];if(h){const f=(h.notes||h).filter(b=>b.pitch!==void 0).sort((b,v)=>(b.time||0)-(v.time||0)),{abcNotesStr:m}=this.convertNotesToAbc(f,a,c,u,{hideRests:$,showArticulations:P,padMeasures:p});m.trim()&&(r+=m+`
`)}}else{const h=[];E.forEach(m=>{(m.notes||m).forEach(v=>{v.pitch!==void 0&&h.push(v)})});const l=h.sort((m,b)=>(m.time||0)-(b.time||0)),{abcNotesStr:f}=this.convertNotesToAbc(l,a,c,u,{hideRests:$,showArticulations:P,padMeasures:p});f.trim()&&(r+=f+`
`)}return r}static convertNotesToAbc(e,t,r,n,i={}){let s="",a=0,c=0,u=0,d=0;const g=options?.quantizeBeats||.25,$=1e-6,P=m=>sr(m,g,"nearest"),E=m=>Kn(m,g),w=m=>{s+=m+" "},p=()=>{for(;a>=t-1e-9;)w("|"),a-=t,c++,u++,(n.includes(c)||u>=r)&&(s+=`
`,u=0)},h=(m,{forceVisible:b=!1}={})=>{let v=m;for(;v>0;){const _=t-a,M=P(Math.min(v,_));let N=i.hideRests&&!b?"x":"z";N+=E(M),w(N),a=P(a+M),p(),v=P(v-M)}};for(const m of e){const b=typeof m.time=="number"?P(m.time):0,v=typeof m.duration=="number"?P(m.duration):1,_=P(b-d);_>$&&h(_);let M="z";if(typeof m.pitch=="number"){const q=m.pitch,z=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],G=Math.floor(q/12)-1,L=q%12;M=z[L].replace("#","^"),G>=4?(M=M.toLowerCase(),G>4&&(M+="'".repeat(G-4))):G<4&&(M=M.toUpperCase(),G<3&&(M+=",".repeat(3-G)))}else typeof m.pitch=="string"?M=m.pitch:m.pitch===null&&(M=i.hideRests?"x":"z");let N=M;N+=E(v),i.showArticulations&&(m.articulation==="staccato"&&(N+="."),m.articulation==="accent"&&(N+=">"),m.articulation==="tenuto"&&(N+="-"),m.articulation==="marcato"&&(N+="^")),w(N),a=P(a+v),p(),d=P(b+v)}const l=i.padMeasures||0;for(;c<l;){const m=P(t-a);m>$&&h(m,{forceVisible:!0}),w("|"),a=0,c++}const f=s.trim();return f&&!f.endsWith("|")&&(s+="|"),{abcNotesStr:s}}}function Hn(o,e={}){return Vo.convertToAbc(o,e)}class ar{static midiToNoteName(e){const t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],r=Math.floor(e/12)-1,n=e%12;return t[n]+r}static convert(e){const t=e.bpm||120,r=e.tracks||[];return{header:{bpm:t,timeSignature:e.timeSignature||"4/4"},tracks:r.map(n=>({label:n.label,notes:n.notes.map(i=>({pitch:i.pitch,noteName:typeof i.pitch=="number"?ar.midiToNoteName(i.pitch):i.pitch,time:i.time,duration:i.duration,velocity:i.velocity||.8,articulation:i.articulation||null}))}))}}}function Fo(o){return ar.convert(o)}function Lo(o,e={}){return{sampleRate:e.sampleRate||44100,duration:e.duration||10,channels:e.channels||1,bpm:o.bpm||120,notes:o.tracks?.flatMap(t=>t.notes)||[]}}class Uo{static convert(e){let r=`// SuperCollider script generated from JMON
// Title: ${e.metadata?.name||"Untitled"}
`;return(e.tracks?.[0]?.notes||[]).forEach(i=>{r+=`Synth("default", ["freq", ${i.pitch}, "dur", ${i.duration}]);
`}),r}}function Go(o){return Uo.convert(o)}function Bo(o){return new Zt().validateAndNormalize(o)}function Ko(o,e={}){if(!o||typeof o!="object")throw console.error("[RENDER] Invalid JMON object:",o),new Error("render() requires a valid JMON object");return!o.sequences&&!o.tracks&&!o.format&&console.warn("[RENDER] Object does not appear to be JMON format, attempting normalization"),or(o,e)}function Ho(o,e={}){const t={autoplay:!0,...e};return or(o,t)}function Jo(o,e={}){const{scale:t=.9,staffwidth:r,showAbc:n=!0,responsive:i="resize",abcOptions:s={}}=e,a=Hn(o,s),c=document.createElement("div");c.style.cssText=`
		margin: 15px 0;
		font-family: sans-serif;
	`;const u=document.createElement("div");if(u.id=`rendered-score-${Date.now()}`,u.style.cssText=`
		width: 100%;
		overflow-x: auto;
		margin: 10px 0;
	`,c.appendChild(u),n){const d=document.createElement("details");d.style.marginTop="15px";const g=document.createElement("summary");g.textContent="ABC Notation (click to expand)",g.style.cursor="pointer",d.appendChild(g);const $=document.createElement("pre");$.textContent=a,$.style.cssText=`
			background: #f5f5f5;
			padding: 10px;
			border-radius: 4px;
			overflow-x: auto;
			font-size: 12px;
		`,d.appendChild($),c.appendChild(d)}if(typeof ABCJS<"u")try{const d=r||null,g={responsive:i,scale:t};d&&(g.staffwidth=d),ABCJS.renderAbc(u,a,g),setTimeout(()=>{if(u.children.length===0||u.innerHTML.trim()==="")try{ABCJS.renderAbc(u,a),u.children.length===0&&(u.innerHTML='<p style="color: red;">ABCJS rendering failed - no content generated</p><pre>'+a+"</pre>")}catch{u.innerHTML="<p>Error with alternative rendering</p><pre>"+a+"</pre>"}},200)}catch(d){console.error("Error rendering with ABCJS:",d),u.innerHTML="<p>Error rendering notation</p><pre>"+a+"</pre>"}else u.innerHTML="<p>ABCJS not available - showing text notation only</p><pre>"+a+"</pre>";return c}const cr={render:Ko,play:Ho,score:Jo,validate:Bo,createPlayer:or,converters:{abc:Hn,midi:Fo,tonejs:Un,wav:Lo,supercollider:Go},theory:ze.theory,generative:ze.generative,analysis:ze.analysis,constants:ze.constants,utils:{...ze.utils,JmonValidator:Zt,quantize:(o,e,t)=>Promise.resolve().then(()=>Ct).then(r=>r.quantize(o,e,t)),quantizeEvents:async(o,e)=>(await Promise.resolve().then(()=>Ct)).quantizeEvents(o,e),quantizeTrack:async(o,e)=>(await Promise.resolve().then(()=>Ct)).quantizeTrack(o,e),quantizeComposition:async(o,e)=>(await Promise.resolve().then(()=>Ct)).quantizeComposition(o,e)},VERSION:"1.0.0"},Wo={loops:{async plotLoops(o,e=4,t=1/4,r=null,n={}){const{LoopVisualizer:i}=await Promise.resolve().then(()=>Yn);return i.plotLoops(o,e,t,r,n)}}};cr.visualization=Wo;let je=null,Jn=!1;async function Yo(){if(Jn)return je;Jn=!0;try{if(typeof window<"u"&&window.Plotly)return je=window.Plotly,je;if(typeof window>"u"){const e=await import("plotly.js");return je=e.default||e,je}return null}catch{return console.warn("Plotly.js not available. Visualization methods will return placeholder data."),null}}class Ot{static async line(e,t={},r="plot"){const n=await Yo();if(!n)return{data:e,options:t,type:"line",message:"Plotly.js not available"};const{title:i,width:s=640,height:a=400,color:c="steelblue",xTitle:u="X",yTitle:d="Y"}=t,g={x:e.x,y:e.y,type:"scatter",mode:"lines",line:{color:c,width:2},name:"Line"},$={title:i?{text:i}:void 0,width:s,height:a,xaxis:{title:{text:u}},yaxis:{title:{text:d}}};await n.newPlot(r,[g],$)}static async scatter(e,t={},r="plot"){const{title:n,width:i=640,height:s=400,color:a="steelblue",xTitle:c="X",yTitle:u="Y"}=t,d={x:e.x,y:e.y,type:"scatter",mode:"markers",marker:{color:e.color||a,size:e.size||8},name:"Scatter"},g={title:n?{text:n}:void 0,width:i,height:s,xaxis:{title:{text:c}},yaxis:{title:{text:u}}};await plotly.newPlot(r,[d],g)}static async heatmap(e,t={},r="plot"){const{title:n,width:i=640,height:s=400,colorScale:a="Viridis",xTitle:c="X",yTitle:u="Y"}=t,d={z:e,type:"heatmap",colorscale:a,showscale:!0},g={title:n?{text:n}:void 0,width:i,height:s,xaxis:{title:{text:c}},yaxis:{title:{text:u}}};await plotly.newPlot(r,[d],g)}static async bar(e,t={},r="plot"){const{title:n,width:i=640,height:s=400,color:a="steelblue",xTitle:c="X",yTitle:u="Y"}=t,d={x:e.x.map($=>$.toString()),y:e.y,type:"bar",marker:{color:e.color||a},name:"Bar"},g={title:n?{text:n}:void 0,width:i,height:s,xaxis:{title:{text:c}},yaxis:{title:{text:u}}};await plotly.newPlot(r,[d],g)}static async radar(e,t={},r="plot"){const{title:n,width:i=400,height:s=400,color:a="steelblue"}=t,c=[...e.x,e.x[0]],d={r:[...e.y,e.y[0]],theta:c,type:"scatterpolar",mode:"lines+markers",fill:"toself",line:{color:a},marker:{color:a,size:8},name:"Radar"},g={title:n?{text:n}:void 0,width:i,height:s,polar:{radialaxis:{visible:!0,range:[0,Math.max(...e.y)*1.1]}}};await plotly.newPlot(r,[d],g)}static async timeSeries(e,t={},r="plot"){const{title:n,width:i=640,height:s=400,xTitle:a="Time",yTitle:c="Value"}=t,u={x:e.x,y:e.y,type:"scatter",mode:"lines",line:{width:2},name:"Time Series"},d={title:n?{text:n}:void 0,width:i,height:s,xaxis:{title:{text:a}},yaxis:{title:{text:c}}};await plotly.newPlot(r,[u],d)}static async matrix(e,t={},r="plot"){const{title:n,width:i=640,height:s=400,xTitle:a="Position",yTitle:c="Time Step"}=t,d={z:e.slice().reverse(),type:"heatmap",colorscale:[[0,"white"],[1,"black"]],showscale:!1,hoverinfo:"none"},g={title:n?{text:n}:void 0,width:i,height:s,xaxis:{title:{text:a},showticklabels:!1},yaxis:{title:{text:c},showticklabels:!1}};await plotly.newPlot(r,[d],g)}static async surface(e,t={},r="plot"){const{title:n,width:i=640,height:s=400,colorScale:a="Viridis",xTitle:c="X",yTitle:u="Y",zTitle:d="Z"}=t,g={x:e.x,y:e.y,z:e.z,type:"surface",colorscale:a},$={title:n?{text:n}:void 0,width:i,height:s,scene:{xaxis:{title:{text:c}},yaxis:{title:{text:u}},zaxis:{title:{text:d}}}};await plotly.newPlot(r,[g],$)}static async multiLine(e,t={},r="plot"){const{title:n,width:i=640,height:s=400,xTitle:a="X",yTitle:c="Y"}=t,u=e.map((g,$)=>({x:g.x,y:g.y,type:"scatter",mode:"lines",name:`Series ${$+1}`,line:{width:2}})),d={title:n?{text:n}:void 0,width:i,height:s,xaxis:{title:{text:a}},yaxis:{title:{text:c}}};await plotly.newPlot(r,u,d)}static async histogram(e,t={},r="plot"){const{title:n,width:i=640,height:s=400,color:a="steelblue",xTitle:c="Value",yTitle:u="Frequency"}=t,d={x:e.x,type:"histogram",marker:{color:a},name:"Histogram"},g={title:n?{text:n}:void 0,width:i,height:s,xaxis:{title:{text:c}},yaxis:{title:{text:u}}};await plotly.newPlot(r,[d],g)}static async boxPlot(e,t={},r="plot"){const{title:n,width:i=640,height:s=400,yTitle:a="Value"}=t,c=e.map((d,g)=>({y:d.y,type:"box",name:`Dataset ${g+1}`})),u={title:n?{text:n}:void 0,width:i,height:s,yaxis:{title:{text:a}}};await plotly.newPlot(r,c,u)}static async violin(e,t={},r="plot"){const{title:n,width:i=640,height:s=400,yTitle:a="Value"}=t,c=e.map((d,g)=>({y:d.y,type:"violin",name:`Dataset ${g+1}`,box:{visible:!0},meanline:{visible:!0}})),u={title:n?{text:n}:void 0,width:i,height:s,yaxis:{title:{text:a}}};await plotly.newPlot(r,c,u)}static async contour(e,t={},r="plot"){const{title:n,width:i=640,height:s=400,colorScale:a="Viridis",xTitle:c="X",yTitle:u="Y"}=t,d={x:e.x,y:e.y,z:e.z,type:"contour",colorscale:a,showscale:!0},g={title:n?{text:n}:void 0,width:i,height:s,xaxis:{title:{text:c}},yaxis:{title:{text:u}}};await plotly.newPlot(r,[d],g)}static async scatter3D(e,t={},r="plot"){const{title:n,width:i=640,height:s=400,color:a="steelblue",xTitle:c="X",yTitle:u="Y",zTitle:d="Z"}=t,g={x:e.x,y:e.y,z:e.z,type:"scatter3d",mode:"markers",marker:{color:e.color||a,size:4,opacity:.8},name:"3D Scatter"},$={title:n?{text:n}:void 0,width:i,height:s,scene:{xaxis:{title:{text:c}},yaxis:{title:{text:u}},zaxis:{title:{text:d}}}};await plotly.newPlot(r,[g],$)}static async animate(e,t={},r="plot"){const{title:n,width:i=640,height:s=400,duration:a=500,transition:c=100}=t,u=e[0]?.data||[],d={title:n?{text:n}:void 0,width:i,height:s,updatemenus:[{type:"buttons",showactive:!1,buttons:[{label:"Play",method:"animate",args:[null,{frame:{duration:a,redraw:!0},transition:{duration:c},fromcurrent:!0}]},{label:"Pause",method:"animate",args:[[null],{frame:{duration:0,redraw:!1},mode:"immediate",transition:{duration:0}}]}]}],...e[0]?.layout},g=e.map(($,P)=>({name:P.toString(),data:$.data,layout:$.layout}));await je.newPlot(r,u,d),await plotly.addFrames(r,g)}static async candlestick(e,t={},r="plot"){const{title:n,width:i=640,height:s=400,xTitle:a="Time",yTitle:c="Price"}=t,u={x:e.x,open:e.open,high:e.high,low:e.low,close:e.close,type:"candlestick",name:"OHLC"},d={title:n?{text:n}:void 0,width:i,height:s,xaxis:{title:{text:a}},yaxis:{title:{text:c}}};await plotly.newPlot(r,[u],d)}}class Xo{static plotEvolution(e,t={}){const{title:r="Cellular Automata Evolution",width:n=600,height:i=400,colorScheme:s="binary",showAxis:a=!1}=t,c=[];return e.forEach((u,d)=>{u.forEach((g,$)=>{c.push({x:$,y:e.length-1-d,value:g})})}),Ot.matrix(e,{title:r,width:n,height:i,showAxis:a})}static plotGeneration(e,t={}){const{title:r="CA Generation",width:n=600,height:i=100}=t,s={x:e.map((a,c)=>c),y:e.map(()=>0),color:e.map(a=>a?"black":"white")};return Ot.scatter(s,{title:r,width:n,height:i,showAxis:!1})}static compareRules(e,t={}){const{width:r=300,height:n=200,colorScheme:i="binary"}=t;return e.map(({ruleNumber:s,history:a})=>this.plotEvolution(a,{title:`Rule ${s}`,width:r,height:n,colorScheme:i,showAxis:!1}))}static createAnimationData(e){return e.map((t,r)=>({frame:r,data:t.map((n,i)=>({x:i,y:0,value:n}))}))}static extractPatterns(e){const t=[],r=[],n=[],i=e[0]?.length||0;for(let s=0;s<i;s++){const a=e.map(u=>u[s]),c=this.findPeriod(a.filter(u=>u!==void 0));c>1&&c<10&&t.push({position:s,period:c})}if(e.length>5){const s=e[e.length-1],a=e[e.length-2];if(s&&a)for(let c=0;c<i-3;c++)s.slice(c,c+3).every((d,g)=>d===a[c+g]&&d===1)&&n.push({position:c,width:3})}return{oscillators:t,gliders:r,stillLifes:n}}static findPeriod(e){if(e.length<4)return 1;for(let t=1;t<=Math.floor(e.length/2);t++){let r=!0;for(let n=t;n<e.length;n++)if(e[n]!==e[n-t]){r=!1;break}if(r)return t}return 1}static plotDensity(e,t={}){const{title:r="CA Density Over Time",width:n=600,height:i=300}=t,s=e.map((c,u)=>({time:u,density:c.reduce((d,g)=>d+g,0)/c.length})),a={x:s.map(c=>c.time),y:s.map(c=>c.density)};return Ot.line(a,{title:r,width:n,height:i,color:"steelblue",showAxis:!0})}static plotSpacetime(e,t={}){const{title:r="Spacetime Diagram",width:n=600,height:i=400,showGrid:s=!1}=t,a=[];return e.forEach((c,u)=>{c.forEach((d,g)=>{a.push({x:g,y:e.length-1-u,value:d,border:s})})}),Ot.matrix(e,{title:r,width:n,height:i,showAxis:!1})}}const lr=Object.freeze(Object.defineProperty({__proto__:null,CAVisualizer:Xo},Symbol.toStringTag,{value:"Module"}));let Ve=null,Wn=!1;async function Qo(){if(Wn)return Ve;Wn=!0;try{if(typeof window<"u"&&window.Plotly)return Ve=window.Plotly,Ve;if(typeof window>"u"){const e=await import("plotly.js");return Ve=e.default||e,Ve}return null}catch{return console.warn("Plotly.js not available. Visualization methods will return placeholder data."),null}}class Zo{static async plotLoops(e,t=4,r=1/4,n=null,i={}){const{container:s="loop-plot",title:a="Loop Visualization",showDurationArcs:c=!0,showMarkers:u=!0,showShapes:d=!0,colorScheme:g="colorblind"}=i,$=Object.values(e),P=n||this.generateColors($.length,g),E=[];$.forEach((b,v)=>{if(!b.notes||b.notes.length===0)return;const _=b.notes.filter(M=>M.pitch!==null);if(_.length!==0&&((c||u)&&_.forEach(M=>{const N=M.time/t*360,q=M.duration/t*360;if(c&&q>1){const z=this.generateArcPoints(N,q,50),G=Array(50).fill($.length-v-1);E.push({type:"scatterpolar",r:G,theta:z,mode:"lines",line:{color:"rgba(60, 60, 60, 0.65)",width:8},name:`${b.label} Duration`,showlegend:!1})}u&&[N,(N+q)%360].forEach(z=>{E.push({type:"scatterpolar",r:[$.length-v-.9,$.length-v-1.1],theta:[z,z],mode:"lines",line:{color:"Black",width:3},name:`${b.label} Markers`,showlegend:!1})})}),d)){const M=_.map(N=>N.time/t*360);M.length>1&&(M.push(M[0]),E.push({type:"scatterpolar",r:Array(M.length).fill($.length-v-1),theta:M,mode:"lines",line:{color:"rgba(0, 0, 0, 0.65)",width:1},fill:"toself",fillcolor:P[v%P.length],name:b.label,showlegend:!1}))}});const w=this.generateTickValues(t,r),p=this.generateTickLabels(t,r),h=$.map(b=>b.label).reverse(),l={title:{text:a},polar:{radialaxis:{visible:!0,range:[$.length,-.1],tickvals:Array.from({length:$.length},(b,v)=>v),ticktext:h},angularaxis:{tickvals:w,ticktext:p,direction:"clockwise",rotation:90}},template:"none",showlegend:!1},f={responsive:!0,displayModeBar:!0},m=await Qo();if(!m)throw new Error("Plotly.js not available for visualization");return m.newPlot(s,E,l,f)}static generateColors(e,t="colorblind"){const r=[];switch(t){case"colorblind":const n=["rgba(230, 159, 0, 0.65)","rgba(86, 180, 233, 0.65)","rgba(0, 158, 115, 0.65)","rgba(240, 228, 66, 0.65)","rgba(0, 114, 178, 0.65)","rgba(213, 94, 0, 0.65)","rgba(204, 121, 167, 0.65)"];for(let s=0;s<e;s++)r.push(n[s%n.length]);break;case"viridis":const i=["rgba(68, 1, 84, 0.65)","rgba(59, 82, 139, 0.65)","rgba(33, 144, 140, 0.65)","rgba(94, 201, 98, 0.65)","rgba(253, 231, 37, 0.65)"];for(let s=0;s<e;s++)if(e<=i.length)r.push(i[s]);else{const c=s/(e-1)*(i.length-1),u=Math.floor(c);r.push(i[u])}break;case"classic":default:for(let s=0;s<e;s++){const a=s/e,c=this.hsvToRgb(a,1,1);r.push(`rgba(${Math.round(c.r*255)}, ${Math.round(c.g*255)}, ${Math.round(c.b*255)}, 0.5)`)}break}return r}static hsvToRgb(e,t,r){let n,i,s;const a=Math.floor(e*6),c=e*6-a,u=r*(1-t),d=r*(1-c*t),g=r*(1-(1-c)*t);switch(a%6){case 0:n=r,i=g,s=u;break;case 1:n=d,i=r,s=u;break;case 2:n=u,i=r,s=g;break;case 3:n=u,i=d,s=r;break;case 4:n=g,i=u,s=r;break;case 5:n=r,i=u,s=d;break;default:n=i=s=0}return{r:n,g:i,b:s}}static generateArcPoints(e,t,r){const n=[];for(let i=0;i<r;i++){const s=e+i/(r-1)*t;n.push(s%360)}return n}static generateTickValues(e,t){const r=[],n=Math.floor(e/t);for(let i=0;i<n;i++)r.push(i*360/n);return r}static generateTickLabels(e,t){const r=[],n=Math.floor(e/t);for(let i=0;i<n;i++){const s=i*t%e;r.push(s.toString())}return r}}const Yn=Object.freeze(Object.defineProperty({__proto__:null,LoopVisualizer:Zo},Symbol.toStringTag,{value:"Module"}));Me.default=cr,Me.jm=cr,Object.defineProperties(Me,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
