<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JMON Ornaments Example</title>
  <script src="../node_modules/abcjs/dist/abcjs-basic.js"></script>
  <script src="../node_modules/tone/build/Tone.js"></script>

  <style>
    body { font-family: sans-serif; margin: 2em; }
    #abc { margin-bottom: 2em; }
    #player { margin-top: 2em; }
    .desc { margin-bottom: 1em; color: #444; }
    h2 { margin-top: 2em; }
  </style>
</head>
<body>
  <h1>JMON Ornaments Example</h1>
  <div class="desc">
    <b>Ornaments</b> in JMON are musical decorations that add extra notes to the melody. They are generated using the Ornament API and are rendered as actual notes in the sequence.<br>
    <ul>
      <li><b>Trill</b>: Rapid alternation between the main note and the note above.</li>
      <li><b>Mordent</b>: Main note, lower neighbor, back to main note.</li>
      <li><b>Turn</b>: Upper neighbor, main note, lower neighbor, main note.</li>
      <li><b>Appoggiatura</b>: Grace note before the main note.</li>
      <li><b>Acciaccatura</b>: Very short grace note before the main note.</li>
    </ul>
    All these ornaments are realized as extra notes in the JMON sequence.
  </div>
  <div id="abc"></div>
  <div id="player"></div>
  <script type="module">
    import { dj, JmonTone } from '../dist/jmon-studio.esm.js';

    // Demonstrate multiple algorithms working together
    const scale = new dj.Scale('C', 'major');
    const scaleNotes = scale.getNoteNames();
    
    // Create a polyloop for rhythmic patterns
    const polyloop = new dj.Polyloop(8, 4);
    polyloop.addLayer([1, 0, 1, 0], 0);  // Basic kick pattern
    polyloop.addLayer([0, 1, 0, 1], 1);  // Snare pattern
    
    const polyloopPattern = polyloop.generate();
    
    console.log('Generated scale:', scaleNotes);
    console.log('Generated polyloop pattern:', polyloopPattern);
    
    // Create melody using scale pitches
    const baseMelody = scaleNotes.slice(0, 5).map((note, i) => ({
      note: note,
      duration: 1,
      time: i,
      velocity: 0.8
    }));
    
    const ornamented = baseMelody;

    const jmonComp = {
      format: 'jmonTone',
      version: '1.0',
      bpm: 100,
      keySignature: 'C',
      sequences: [
        {
          label: 'Scale-based Melody',
          notes: ornamented
        }
      ],
      audioGraph: [],
      connections: []
    };
    window.jmonComp = jmonComp;

    // Display the generated algorithms and data
    document.getElementById('abc').innerHTML = `
      <h2>Multi-Algorithm Demo</h2>
      
      <h3>Scale Generator</h3>
      <p>Generated C major scale: <strong>${scaleNotes.join(', ')}</strong></p>
      
      <h3>Polyloop Generator</h3>
      <p>8-step polyloop with 2 layers:</p>
      <pre>${JSON.stringify(polyloopPattern.slice(0, 4), null, 2)}...</pre>
      
      <h3>JMON Composition</h3>
      <pre>${JSON.stringify(jmonComp, null, 2)}</pre>
    `;

    // Validate the composition and show all available algorithms
    if (JmonTone && JmonTone.validateComposition) {
      const validation = JmonTone.validateComposition(jmonComp);
      document.getElementById('player').innerHTML = `
        <h2>Algorithm Results</h2>
        <p>✓ Scale: Generated ${scaleNotes.length} notes from C major scale</p>
        <p>✓ Polyloop: Generated ${polyloopPattern.length}-step rhythmic pattern</p>
        
        <h3>JMON Validation</h3>
        <p>Valid: <strong>${validation.valid}</strong></p>
        ${validation.errors.length > 0 ? `<p>Errors: ${validation.errors.map(e => e.message).join(', ')}</p>` : ''}
        ${validation.warnings.length > 0 ? `<p>Warnings: ${validation.warnings.join(', ')}</p>` : ''}
        
        <h3>Available in ES Module Build</h3>
        <p><strong>Classes:</strong> ${Object.keys(dj).join(', ')}</p>
      `;
    }
  </script>
</body>
</html>
